/*! For license information please see admanagement-sdk-3.6.11.min.js.LICENSE.txt */
var YospaceAdManagement;(()=>{var e={526:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),r=t[0],i=t[1];return 3*(r+i)/4-i},t.toByteArray=function(e){var t,r,a=o(e),s=a[0],l=a[1],h=new n(function(e,t,r){return 3*(t+r)/4-r}(0,s,l)),c=0,u=l>0?s-4:s;for(r=0;r<u;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],h[c++]=t>>16&255,h[c++]=t>>8&255,h[c++]=255&t;return 2===l&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,h[c++]=255&t),1===l&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,h[c++]=t>>8&255,h[c++]=255&t),h},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,a=[],s=16383,o=0,h=i-n;o<h;o+=s)a.push(l(e,o,o+s>h?h:o+s));return 1===n?(t=e[i-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[i-2]<<8)+e[i-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,i){for(var n,a,s=[],o=t;o<i;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(a=n)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},287:(e,t,r)=>{"use strict";var i=r(526),n=r(251),a=r(634);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return h(this,e,t,r)}function h(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t),e}(e,t,r,i):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|g(t,r),n=(e=o(e,i)).write(t,r);return n!==i&&(e=e.slice(0,n)),e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|p(t.length);return 0===(e=o(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?o(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(c(t),e=o(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|p(t.length);e=o(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(i)return V(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return w(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function m(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:E(e,t,r,i,n);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):E(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function E(e,t,r,i,n){var a,s=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,r/=2}function h(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var c=-1;for(a=r;a<o;a++)if(h(e,a)===h(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var u=!0,d=0;d<l;d++)if(h(e,a+d)!==h(t,d)){u=!1;break}if(u)return a}return-1}function y(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var s=0;s<i;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[r+s]=o}return s}function T(e,t,r,i){return H(V(t,e.length-r),e,r,i)}function k(e,t,r,i){return H(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function A(e,t,r,i){return k(e,t,r,i)}function b(e,t,r,i){return H(G(t),e,r,i)}function S(e,t,r,i){return H(function(e,t){for(var r,i,n,a=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n=r%256,a.push(n),a.push(i);return a}(t,e.length-r),e,r,i)}function w(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var a,s,o,l,h=e[n],c=null,u=h>239?4:h>223?3:h>191?2:1;if(n+u<=r)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(a=e[n+1]))&&(l=(31&h)<<6|63&a)>127&&(c=l);break;case 3:a=e[n+1],s=e[n+2],128==(192&a)&&128==(192&s)&&(l=(15&h)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[n+1],s=e[n+2],o=e[n+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),n+=u}return function(e){var t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);for(var r="",i=0;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=D));return r}(i)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==r.g.TYPED_ARRAY_SUPPORT?r.g.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return h(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,i){return c(t),t<=0?o(e,t):void 0!==r?"string"==typeof i?o(e,t).fill(r,i):o(e,t).fill(r):o(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return u(null,e)},l.allocUnsafeSlow=function(e){return u(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,a=Math.min(r,i);n<a;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=l.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):f.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,i,n){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),h=this.slice(i,n),c=e.slice(t,r),u=0;u<o;++u)if(h[u]!==c[u]){a=h[u],s=c[u];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},l.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return T(this,e,t,r);case"ascii":return k(this,e,t,r);case"latin1":case"binary":return A(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var D=4096;function C(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function R(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function P(e,t,r){var i,n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var a="",s=t;s<r;++s)a+=(i=e[s])<16?"0"+i.toString(16):i.toString(16);return a}function _(e,t,r){for(var i=e.slice(t,r),n="",a=0;a<i.length;a+=2)n+=String.fromCharCode(i[a]+256*i[a+1]);return n}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,i,n,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function B(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,a=Math.min(e.length-r,2);n<a;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function M(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,a=Math.min(e.length-r,4);n<a;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function U(e,t,r,i,n,a){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(e,t,r,i,a){return a||U(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function F(e,t,r,i,a){return a||U(e,0,r,8),n.write(e,t,r,i,52,8),r+8}l.prototype.slice=function(e,t){var r,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var n=t-e;r=new l(n,void 0);for(var a=0;a<n;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},l.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var i=t,n=1,a=this[e+--i];i>0&&(n*=256);)a+=this[e+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),n.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),n.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),n.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),n.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,i){e=+e,t|=0,r|=0,i||N(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,a=0;for(this[t]=255&e;++a<r&&(n*=256);)this[t+a]=e/n&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,i){e=+e,t|=0,r|=0,i||N(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,a=1;for(this[t+n]=255&e;--n>=0&&(a*=256);)this[t+n]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+r},l.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return O(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return O(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n,a=i-r;if(this===e&&r<t&&t<i)for(n=a-1;n>=0;--n)e[n+t]=this[n+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=l.isBuffer(e)?e:V(new l(e,i).toString()),o=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var x=/[^+\/0-9A-Za-z-_]/g;function V(e,t){var r;t=t||1/0;for(var i=e.length,n=null,a=[],s=0;s<i;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function G(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}},7:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,a),i(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}f(e,t,a,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,n)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,r,i){var n,a,s,h;if(o(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]),void 0===s)s=a[t]=r,++e._eventsCount;else if("function"==typeof s?s=a[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),(n=l(e))>0&&s.length>n&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,h=c,console&&console.warn&&console.warn(h)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=c.bind(i);return n.listener=r,i.wrapFn=n,n}function d(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):g(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function f(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(a){i.once&&e.removeEventListener(t,n),r(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var h=l.length,c=g(l,h);for(r=0;r<h;++r)i(c[r],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,i,n,a,s;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,n=a;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,a=Object.keys(r);for(i=0;i<a.length;++i)"removeListener"!==(n=a[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},251:(e,t)=>{t.read=function(e,t,r,i,n){var a,s,o=8*n-i-1,l=(1<<o)-1,h=l>>1,c=-7,u=r?n-1:0,d=r?-1:1,p=e[t+u];for(u+=d,a=p&(1<<-c)-1,p>>=-c,c+=o;c>0;a=256*a+e[t+u],u+=d,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=i;c>0;s=256*s+e[t+u],u+=d,c-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),a-=h}return(p?-1:1)*s*Math.pow(2,a-i)},t.write=function(e,t,r,i,n,a){var s,o,l,h=8*a-n-1,c=(1<<h)-1,u=c>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,g=i?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=c?(o=0,s=c):s+u>=1?(o=(t*l-1)*Math.pow(2,n),s+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;e[r+p]=255&o,p+=g,o/=256,n-=8);for(s=s<<n|o,h+=n;h>0;e[r+p]=255&s,p+=g,s/=256,h-=8);e[r+p-g]|=128*f}},698:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},634:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},606:e=>{var t,r,i=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var o,l=[],h=!1,c=-1;function u(){h&&o&&(h=!1,o.length?l=o.concat(l):c=-1,l.length&&d())}function d(){if(!h){var e=s(u);h=!0;for(var t=l.length;t;){for(o=l,l=[];++c<t;)o&&o[c].run();c=-1,t=l.length}o=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new p(e,t)),1!==l.length||h||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},861:(e,t,r)=>{var i=r(287),n=i.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=i:(a(i,t),t.Buffer=s),a(n,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=n(e);return void 0!==t?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},43:(e,t,r)=>{!function(e){e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=s,e.createStream=function(e,t){return new s(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function n(t,r){if(!(this instanceof n))return new n(t,r);var a=this;!function(e){for(var t=0,r=i.length;t<r;t++)e[i[t]]=""}(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=r||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=S.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(u)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),I(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),n.prototype={end:function(){_(this)},write:function(t){var r=this;if(this.error)throw this.error;if(r.closed)return P(r,"Cannot write after close. Assign an onready handler.");if(null===t)return _(r);"object"==typeof t&&(t=t.toString());for(var n=0,a="";a=V(t,n++),r.c=a,a;)switch(r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++),r.state){case S.BEGIN:if(r.state=S.BEGIN_WHITESPACE,"\ufeff"===a)continue;x(r,a);continue;case S.BEGIN_WHITESPACE:x(r,a);continue;case S.TEXT:if(r.sawRoot&&!r.closedRoot){for(var s=n-1;a&&"<"!==a&&"&"!==a;)(a=V(t,n++))&&r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++);r.textNode+=t.substring(s,n-1)}"<"!==a||r.sawRoot&&r.closedRoot&&!r.strict?(v(a)||r.sawRoot&&!r.closedRoot||L(r,"Text data outside of root node."),"&"===a?r.state=S.TEXT_ENTITY:r.textNode+=a):(r.state=S.OPEN_WAKA,r.startTagPosition=r.position);continue;case S.SCRIPT:"<"===a?r.state=S.SCRIPT_ENDING:r.script+=a;continue;case S.SCRIPT_ENDING:"/"===a?r.state=S.CLOSE_TAG:(r.script+="<"+a,r.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===a)r.state=S.SGML_DECL,r.sgmlDecl="";else if(v(a));else if(y(d,a))r.state=S.OPEN_TAG,r.tagName=a;else if("/"===a)r.state=S.CLOSE_TAG,r.tagName="";else if("?"===a)r.state=S.PROC_INST,r.procInstName=r.procInstBody="";else{if(L(r,"Unencoded <"),r.startTagPosition+1<r.position){var h=r.position-r.startTagPosition;a=new Array(h).join(" ")+a}r.textNode+="<"+a,r.state=S.TEXT}continue;case S.SGML_DECL:(r.sgmlDecl+a).toUpperCase()===o?(D(r,"onopencdata"),r.state=S.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+a==="--"?(r.state=S.COMMENT,r.comment="",r.sgmlDecl=""):(r.sgmlDecl+a).toUpperCase()===l?(r.state=S.DOCTYPE,(r.doctype||r.sawRoot)&&L(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===a?(D(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=S.TEXT):m(a)?(r.state=S.SGML_DECL_QUOTED,r.sgmlDecl+=a):r.sgmlDecl+=a;continue;case S.SGML_DECL_QUOTED:a===r.q&&(r.state=S.SGML_DECL,r.q=""),r.sgmlDecl+=a;continue;case S.DOCTYPE:">"===a?(r.state=S.TEXT,D(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=a,"["===a?r.state=S.DOCTYPE_DTD:m(a)&&(r.state=S.DOCTYPE_QUOTED,r.q=a));continue;case S.DOCTYPE_QUOTED:r.doctype+=a,a===r.q&&(r.q="",r.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:r.doctype+=a,"]"===a?r.state=S.DOCTYPE:m(a)&&(r.state=S.DOCTYPE_DTD_QUOTED,r.q=a);continue;case S.DOCTYPE_DTD_QUOTED:r.doctype+=a,a===r.q&&(r.state=S.DOCTYPE_DTD,r.q="");continue;case S.COMMENT:"-"===a?r.state=S.COMMENT_ENDING:r.comment+=a;continue;case S.COMMENT_ENDING:"-"===a?(r.state=S.COMMENT_ENDED,r.comment=R(r.opt,r.comment),r.comment&&D(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+a,r.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==a?(L(r,"Malformed comment"),r.comment+="--"+a,r.state=S.COMMENT):r.state=S.TEXT;continue;case S.CDATA:"]"===a?r.state=S.CDATA_ENDING:r.cdata+=a;continue;case S.CDATA_ENDING:"]"===a?r.state=S.CDATA_ENDING_2:(r.cdata+="]"+a,r.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===a?(r.cdata&&D(r,"oncdata",r.cdata),D(r,"onclosecdata"),r.cdata="",r.state=S.TEXT):"]"===a?r.cdata+="]":(r.cdata+="]]"+a,r.state=S.CDATA);continue;case S.PROC_INST:"?"===a?r.state=S.PROC_INST_ENDING:v(a)?r.state=S.PROC_INST_BODY:r.procInstName+=a;continue;case S.PROC_INST_BODY:if(!r.procInstBody&&v(a))continue;"?"===a?r.state=S.PROC_INST_ENDING:r.procInstBody+=a;continue;case S.PROC_INST_ENDING:">"===a?(D(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=S.TEXT):(r.procInstBody+="?"+a,r.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:y(p,a)?r.tagName+=a:(N(r),">"===a?U(r):"/"===a?r.state=S.OPEN_TAG_SLASH:(v(a)||L(r,"Invalid character in tag name"),r.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===a?(U(r,!0),O(r)):(L(r,"Forward-slash in opening tag not followed by >"),r.state=S.ATTRIB);continue;case S.ATTRIB:if(v(a))continue;">"===a?U(r):"/"===a?r.state=S.OPEN_TAG_SLASH:y(d,a)?(r.attribName=a,r.attribValue="",r.state=S.ATTRIB_NAME):L(r,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===a?r.state=S.ATTRIB_VALUE:">"===a?(L(r,"Attribute without value"),r.attribValue=r.attribName,M(r),U(r)):v(a)?r.state=S.ATTRIB_NAME_SAW_WHITE:y(p,a)?r.attribName+=a:L(r,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===a)r.state=S.ATTRIB_VALUE;else{if(v(a))continue;L(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",D(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===a?U(r):y(d,a)?(r.attribName=a,r.state=S.ATTRIB_NAME):(L(r,"Invalid attribute name"),r.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(v(a))continue;m(a)?(r.q=a,r.state=S.ATTRIB_VALUE_QUOTED):(L(r,"Unquoted attribute value"),r.state=S.ATTRIB_VALUE_UNQUOTED,r.attribValue=a);continue;case S.ATTRIB_VALUE_QUOTED:if(a!==r.q){"&"===a?r.state=S.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=a;continue}M(r),r.q="",r.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:v(a)?r.state=S.ATTRIB:">"===a?U(r):"/"===a?r.state=S.OPEN_TAG_SLASH:y(d,a)?(L(r,"No whitespace between attributes"),r.attribName=a,r.attribValue="",r.state=S.ATTRIB_NAME):L(r,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(!E(a)){"&"===a?r.state=S.ATTRIB_VALUE_ENTITY_U:r.attribValue+=a;continue}M(r),">"===a?U(r):r.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(r.tagName)">"===a?O(r):y(p,a)?r.tagName+=a:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=S.SCRIPT):(v(a)||L(r,"Invalid tagname in closing tag"),r.state=S.CLOSE_TAG_SAW_WHITE);else{if(v(a))continue;T(d,a)?r.script?(r.script+="</"+a,r.state=S.SCRIPT):L(r,"Invalid tagname in closing tag."):r.tagName=a}continue;case S.CLOSE_TAG_SAW_WHITE:if(v(a))continue;">"===a?O(r):L(r,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var c,u;switch(r.state){case S.TEXT_ENTITY:c=S.TEXT,u="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:c=S.ATTRIB_VALUE_QUOTED,u="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:c=S.ATTRIB_VALUE_UNQUOTED,u="attribValue"}if(";"===a)if(r.opt.unparsedEntities){var k=F(r);r.entity="",r.state=c,r.write(k)}else r[u]+=F(r),r.entity="",r.state=c;else y(r.entity.length?f:g,a)?r.entity+=a:(L(r,"Invalid character in entity name"),r[u]+="&"+r.entity+a,r.entity="",r.state=c);continue;default:throw new Error(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&function(t){for(var r=Math.max(e.MAX_BUFFER_LENGTH,10),n=0,a=0,s=i.length;a<s;a++){var o=t[i[a]].length;if(o>r)switch(i[a]){case"textNode":C(t);break;case"cdata":D(t,"oncdata",t.cdata),t.cdata="";break;case"script":D(t,"onscript",t.script),t.script="";break;default:P(t,"Max buffer length exceeded: "+i[a])}n=Math.max(n,o)}var l=e.MAX_BUFFER_LENGTH-n;t.bufferCheckPosition=l+t.position}(r),r},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;C(e=this),""!==e.cdata&&(D(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(D(e,"onscript",e.script),e.script="")}};try{t=r(310).Stream}catch(e){t=function(){}}t||(t=function(){});var a=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function s(e,r){if(!(this instanceof s))return new s(e,r);t.apply(this),this._parser=new n(e,r),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})}))}s.prototype=Object.create(t.prototype,{constructor:{value:s}}),s.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=r(141).I;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,r){var i=this;return i._parser["on"+e]||-1===a.indexOf(e)||(i._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),i.emit.apply(i,t)}),t.prototype.on.call(i,e,r)};var o="[CDATA[",l="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",u={xml:h,xmlns:c},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function v(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function m(e){return'"'===e||"'"===e}function E(e){return">"===e||v(e)}function y(e,t){return e.test(t)}function T(e,t){return!y(e,t)}var k,A,b,S=0;for(var w in e.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var r=e.ENTITIES[t],i="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=i})),e.STATE)e.STATE[e.STATE[w]]=w;function I(e,t,r){e[t]&&e[t](r)}function D(e,t,r){e.textNode&&C(e),I(e,t,r)}function C(e){e.textNode=R(e.opt,e.textNode),e.textNode&&I(e,"ontext",e.textNode),e.textNode=""}function R(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function P(e,t){return C(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,I(e,"onerror",t),e}function _(e){return e.sawRoot&&!e.closedRoot&&L(e,"Unclosed root tag"),e.state!==S.BEGIN&&e.state!==S.BEGIN_WHITESPACE&&e.state!==S.TEXT&&P(e,"Unexpected end"),C(e),e.c="",e.closed=!0,I(e,"onend"),n.call(e,e.strict,e.opt),e}function L(e,t){if("object"!=typeof e||!(e instanceof n))throw new Error("bad call to strictFail");e.strict&&P(e,t)}function N(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,D(e,"onopentagstart",r)}function B(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),i=r[0],n=r[1];return t&&"xmlns"===e&&(i="xmlns",n=""),{prefix:i,local:n}}function M(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=B(e.attribName,!0),r=t.prefix,i=t.local;if("xmlns"===r)if("xml"===i&&e.attribValue!==h)L(e,"xml: prefix must be bound to "+h+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==c)L(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var n=e.tag,a=e.tags[e.tags.length-1]||e;n.ns===a.ns&&(n.ns=Object.create(a.ns)),n.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,D(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function U(e,t){if(e.opt.xmlns){var r=e.tag,i=B(e.tagName);r.prefix=i.prefix,r.local=i.local,r.uri=r.ns[i.prefix]||"",r.prefix&&!r.uri&&(L(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=i.prefix);var n=e.tags[e.tags.length-1]||e;r.ns&&n.ns!==r.ns&&Object.keys(r.ns).forEach((function(t){D(e,"onopennamespace",{prefix:t,uri:r.ns[t]})}));for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],h=o[1],c=B(l,!0),u=c.prefix,d=c.local,p=""===u?"":r.ns[u]||"",g={name:l,value:h,prefix:u,local:d,uri:p};u&&"xmlns"!==u&&!p&&(L(e,"Unbound namespace prefix: "+JSON.stringify(u)),g.uri=u),e.tag.attributes[l]=g,D(e,"onattribute",g)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),D(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=S.TEXT:e.state=S.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function O(e){if(!e.tagName)return L(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=S.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=S.SCRIPT);D(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var i=r;t--&&e.tags[t].name!==i;)L(e,"Unexpected close tag");if(t<0)return L(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=S.TEXT);e.tagName=r;for(var n=e.tags.length;n-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,D(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach((function(t){var r=a.ns[t];D(e,"onclosenamespace",{prefix:t,uri:r})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=S.TEXT}function F(e){var t,r=e.entity,i=r.toLowerCase(),n="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(r=i).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),n=(t=parseInt(r,16)).toString(16)):(r=r.slice(1),n=(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),isNaN(t)||n.toLowerCase()!==r?(L(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function x(e,t){"<"===t?(e.state=S.OPEN_WAKA,e.startTagPosition=e.position):v(t)||(L(e,"Non-whitespace before first tag."),e.textNode=t,e.state=S.TEXT)}function V(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}S=e.STATE,String.fromCodePoint||(k=String.fromCharCode,A=Math.floor,b=function(){var e,t,r=[],i=-1,n=arguments.length;if(!n)return"";for(var a="";++i<n;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||A(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?r.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,r.push(e,t)),(i+1===n||r.length>16384)&&(a+=k.apply(null,r),r.length=0)}return a},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:b,configurable:!0,writable:!0}):String.fromCodePoint=b)}(t)},310:(e,t,r)=>{e.exports=n;var i=r(7).EventEmitter;function n(){i.call(this)}r(698)(n,i),n.Readable=r(891),n.Writable=r(999),n.Duplex=r(101),n.Transform=r(83),n.PassThrough=r(681),n.finished=r(257),n.pipeline=r(267),n.Stream=n,n.prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",o),r.on("close",l));var s=!1;function o(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function h(e){if(c(),0===i.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",n),e.removeListener("drain",a),r.removeListener("end",o),r.removeListener("close",l),r.removeListener("error",h),e.removeListener("error",h),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",h),e.on("error",h),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},463:e=>{"use strict";var t={};function r(e,r,i){i||(i=Error);var n=function(e){var t,i;function n(t,i,n){return e.call(this,function(e,t,i){return"string"==typeof r?r:r(e,t,i)}(t,i,n))||this}return i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,n}(i);n.prototype.name=i.name,n.prototype.code=e,t[e]=n}function i(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,a,s,o,l;if("string"==typeof t&&(a="not ",t.substr(0,4)===a)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-9,r)===t}(e," argument"))s="The ".concat(e," ").concat(n," ").concat(i(t,"type"));else{var h=("number"!=typeof l&&(l=0),l+1>(o=e).length||-1===o.indexOf(".",l)?"argument":"property");s='The "'.concat(e,'" ').concat(h," ").concat(n," ").concat(i(t,"type"))}return s+". Received type ".concat(typeof r)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.F=t},101:(e,t,r)=>{"use strict";var i=r(606),n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=c;var a=r(891),s=r(999);r(698)(c,a);for(var o=n(s.prototype),l=0;l<o.length;l++){var h=o[l];c.prototype[h]||(c.prototype[h]=s.prototype[h])}function c(e){if(!(this instanceof c))return new c(e);a.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||i.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},681:(e,t,r)=>{"use strict";e.exports=n;var i=r(83);function n(e){if(!(this instanceof n))return new n(e);i.call(this,e)}r(698)(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},891:(e,t,r)=>{"use strict";var i,n=r(606);e.exports=w,w.ReadableState=S,r(7).EventEmitter;var a,s=function(e,t){return e.listeners(t).length},o=r(396),l=r(287).Buffer,h=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},c=r(199);a=c&&c.debuglog?c.debuglog("stream"):function(){};var u,d,p,g=r(766),f=r(347),v=r(644).getHighWaterMark,m=r(463).F,E=m.ERR_INVALID_ARG_TYPE,y=m.ERR_STREAM_PUSH_AFTER_EOF,T=m.ERR_METHOD_NOT_IMPLEMENTED,k=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(698)(w,o);var A=f.errorOrDestroy,b=["error","close","destroy","pause","resume"];function S(e,t,n){i=i||r(101),e=e||{},"boolean"!=typeof n&&(n=t instanceof i),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=v(this,e,"readableHighWaterMark",n),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(u||(u=r(141).I),this.decoder=new u(e.encoding),this.encoding=e.encoding)}function w(e){if(i=i||r(101),!(this instanceof w))return new w(e);var t=this instanceof i;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function I(e,t,r,i,n){a("readableAddChunk",t);var s,o=e._readableState;if(null===t)o.reading=!1,function(e,t){if(a("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,_(e)))}}(e,o);else if(n||(s=function(e,t){var r,i;return i=t,l.isBuffer(i)||i instanceof h||"string"==typeof t||void 0===t||e.objectMode||(r=new E("chunk",["string","Buffer","Uint8Array"],t)),r}(o,t)),s)A(e,s);else if(o.objectMode||t&&t.length>0)if("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),i)o.endEmitted?A(e,new k):D(e,o,t,!0);else if(o.ended)A(e,new y);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?D(e,o,t,!1):L(e,o)):D(e,o,t,!1)}else i||(o.reading=!1,L(e,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function D(e,t,r,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&P(e)),L(e,t)}Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),w.prototype.destroy=f.destroy,w.prototype._undestroy=f.undestroy,w.prototype._destroy=function(e,t){t(e)},w.prototype.push=function(e,t){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=l.from(e,t),t=""),r=!0),I(this,e,t,!1,r)},w.prototype.unshift=function(e){return I(this,e,null,!0,!1)},w.prototype.isPaused=function(){return!1===this._readableState.flowing},w.prototype.setEncoding=function(e){u||(u=r(141).I);var t=new u(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,n="";null!==i;)n+=t.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var C=1073741824;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;a("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(a("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(_,e))}function _(e){var t=e._readableState;a("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,O(e)}function L(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(N,e,t))}function N(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(a("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function B(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){a("readable nexttick read 0"),e.read(0)}function U(e,t){a("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(a("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function x(e){var t=e._readableState;a("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(V,t,e))}function V(e,t){if(a("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function G(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}w.prototype.read=function(e){a("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return a("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):P(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&x(this),null;var i,n=t.needReadable;return a("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&a("length less than watermark",n=!0),t.ended||t.reading?a("reading or ended",n=!1):n&&(a("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(r,t))),null===(i=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),null!==i&&this.emit("data",i),i},w.prototype._read=function(e){A(this,new T("_read()"))},w.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,a("pipe count=%d opts=%j",i.pipesCount,t);var o=t&&!1===t.end||e===n.stdout||e===n.stderr?f:l;function l(){a("onend"),e.end()}i.endEmitted?n.nextTick(o):r.once("end",o),e.on("unpipe",(function t(n,s){a("onunpipe"),n===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,a("cleanup"),e.removeListener("close",p),e.removeListener("finish",g),e.removeListener("drain",h),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",l),r.removeListener("end",f),r.removeListener("data",u),c=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}));var h=function(e){return function(){var t=e._readableState;a("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,O(e))}}(r);e.on("drain",h);var c=!1;function u(t){a("ondata");var n=e.write(t);a("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==G(i.pipes,e))&&!c&&(a("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function d(t){a("onerror",t),f(),e.removeListener("error",d),0===s(e,"error")&&A(e,t)}function p(){e.removeListener("finish",g),f()}function g(){a("onfinish"),e.removeListener("close",p),f()}function f(){a("unpipe"),r.unpipe(e)}return r.on("data",u),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",p),e.once("finish",g),e.emit("pipe",r),i.flowing||(a("pipe resume"),r.resume()),e},w.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<n;a++)i[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=G(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},w.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,a("on readable",i.length,i.reading),i.length?P(this):i.reading||n.nextTick(M,this))),r},w.prototype.addListener=w.prototype.on,w.prototype.removeListener=function(e,t){var r=o.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(B,this),r},w.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(B,this),t},w.prototype.resume=function(){var e=this._readableState;return e.flowing||(a("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(U,e,t))}(this,e)),e.paused=!1,this},w.prototype.pause=function(){return a("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(a("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},w.prototype.wrap=function(e){var t=this,r=this._readableState,i=!1;for(var n in e.on("end",(function(){if(a("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(n){a("wrapped data"),r.decoder&&(n=r.decoder.write(n)),r.objectMode&&null==n||(r.objectMode||n&&n.length)&&(t.push(n)||(i=!0,e.pause()))})),e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));for(var s=0;s<b.length;s++)e.on(b[s],this.emit.bind(this,b[s]));return this._read=function(t){a("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(w.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=r(34)),d(this)}),Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(w.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(w.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),w._fromList=F,Object.defineProperty(w.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(w.from=function(e,t){return void 0===p&&(p=r(968)),p(w,e,t)})},83:(e,t,r)=>{"use strict";e.exports=c;var i=r(463).F,n=i.ERR_METHOD_NOT_IMPLEMENTED,a=i.ERR_MULTIPLE_CALLBACK,s=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=i.ERR_TRANSFORM_WITH_LENGTH_0,l=r(101);function h(e,t){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(null===i)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),i(e);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);l.call(this,e),this._transformState={afterTransform:h.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",u)}function u(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new o;if(e._transformState.transforming)throw new s;return e.push(null)}r(698)(c,l),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,r){r(new n("_transform()"))},c.prototype._write=function(e,t,r){var i=this._transformState;if(i.writecb=r,i.writechunk=e,i.writeencoding=t,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},999:(e,t,r)=>{"use strict";var i,n=r(606);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var i=e.entry;for(e.entry=null;i;){var n=i.callback;t.pendingcb--,n(undefined),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=w,w.WritableState=S;var s,o={deprecate:r(643)},l=r(396),h=r(287).Buffer,c=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},u=r(347),d=r(644).getHighWaterMark,p=r(463).F,g=p.ERR_INVALID_ARG_TYPE,f=p.ERR_METHOD_NOT_IMPLEMENTED,v=p.ERR_MULTIPLE_CALLBACK,m=p.ERR_STREAM_CANNOT_PIPE,E=p.ERR_STREAM_DESTROYED,y=p.ERR_STREAM_NULL_VALUES,T=p.ERR_STREAM_WRITE_AFTER_END,k=p.ERR_UNKNOWN_ENCODING,A=u.errorOrDestroy;function b(){}function S(e,t,s){i=i||r(101),e=e||{},"boolean"!=typeof s&&(s=t instanceof i),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,a=r.writecb;if("function"!=typeof a)throw new v;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,a){--t.pendingcb,r?(n.nextTick(a,i),n.nextTick(_,e,t),e._writableState.errorEmitted=!0,A(e,i)):(a(i),e._writableState.errorEmitted=!0,A(e,i),_(e,t))}(e,r,i,t,a);else{var s=R(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||C(e,r),i?n.nextTick(D,e,r,s,a):D(e,r,s,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function w(e){var t=this instanceof(i=i||r(101));if(!t&&!s.call(w,this))return new w(e);this._writableState=new S(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function I(e,t,r,i,n,a,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new E("write")):r?e._writev(n,t.onwrite):e._write(n,a,t.onwrite),t.sync=!1}function D(e,t,r,i){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),_(e,t)}function C(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),s=t.corkedRequestsFree;s.entry=r;for(var o=0,l=!0;r;)n[o]=r,r.isBuf||(l=!1),r=r.next,o+=1;n.allBuffers=l,I(e,t,!0,t.length,n,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var h=r.chunk,c=r.encoding,u=r.callback;if(I(e,t,!1,t.objectMode?1:h.length,h,c,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(r){t.pendingcb--,r&&A(e,r),t.prefinished=!0,e.emit("prefinish"),_(e,t)}))}function _(e,t){var r=R(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return r}r(698)(w,l),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(w,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===w&&e&&e._writableState instanceof S}})):s=function(e){return e instanceof this},w.prototype.pipe=function(){A(this,new m)},w.prototype.write=function(e,t,r){var i,a=this._writableState,s=!1,o=!a.objectMode&&(i=e,h.isBuffer(i)||i instanceof c);return o&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(r=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof r&&(r=b),a.ending?function(e,t){var r=new T;A(e,r),n.nextTick(t,r)}(this,r):(o||function(e,t,r,i){var a;return null===r?a=new y:"string"==typeof r||t.objectMode||(a=new g("chunk",["string","Buffer"],r)),!a||(A(e,a),n.nextTick(i,a),!1)}(this,a,e,r))&&(a.pendingcb++,s=function(e,t,r,i,n,a){if(!r){var s=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,r)),t}(t,i,n);i!==s&&(r=!0,n="buffer",i=s)}var o=t.objectMode?1:i.length;t.length+=o;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,o,i,n,a);return l}(this,a,o,e,t,r)),s},w.prototype.cork=function(){this._writableState.corked++},w.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||C(this,e))},w.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new k(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(w.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),w.prototype._write=function(e,t,r){r(new f("_write()"))},w.prototype._writev=null,w.prototype.end=function(e,t,r){var i=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,r){t.ending=!0,_(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,i,r),this},Object.defineProperty(w.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),w.prototype.destroy=u.destroy,w.prototype._undestroy=u.undestroy,w.prototype._destroy=function(e,t){t(e)}},34:(e,t,r)=>{"use strict";var i,n=r(606);function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=r(257),o=Symbol("lastResolve"),l=Symbol("lastReject"),h=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function g(e,t){return{value:e,done:t}}function f(e){var t=e[o];if(null!==t){var r=e[p].read();null!==r&&(e[u]=null,e[o]=null,e[l]=null,t(g(r,!1)))}}function v(e){n.nextTick(f,e)}var m=Object.getPrototypeOf((function(){})),E=Object.setPrototypeOf((a(i={get stream(){return this[p]},next:function(){var e=this,t=this[h];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(g(void 0,!0));if(this[p].destroyed)return new Promise((function(t,r){n.nextTick((function(){e[h]?r(e[h]):t(g(void 0,!0))}))}));var r,i=this[u];if(i)r=new Promise(function(e,t){return function(r,i){e.then((function(){t[c]?r(g(void 0,!0)):t[d](r,i)}),i)}}(i,this));else{var a=this[p].read();if(null!==a)return Promise.resolve(g(a,!1));r=new Promise(this[d])}return this[u]=r,r}},Symbol.asyncIterator,(function(){return this})),a(i,"return",(function(){var e=this;return new Promise((function(t,r){e[p].destroy(null,(function(e){e?r(e):t(g(void 0,!0))}))}))})),i),m);e.exports=function(e){var t,r=Object.create(E,(a(t={},p,{value:e,writable:!0}),a(t,o,{value:null,writable:!0}),a(t,l,{value:null,writable:!0}),a(t,h,{value:null,writable:!0}),a(t,c,{value:e._readableState.endEmitted,writable:!0}),a(t,d,{value:function(e,t){var i=r[p].read();i?(r[u]=null,r[o]=null,r[l]=null,e(g(i,!1))):(r[o]=e,r[l]=t)},writable:!0}),t));return r[u]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];return null!==t&&(r[u]=null,r[o]=null,r[l]=null,t(e)),void(r[h]=e)}var i=r[o];null!==i&&(r[u]=null,r[o]=null,r[l]=null,i(g(void 0,!0))),r[c]=!0})),e.on("readable",v.bind(null,r)),r}},766:(e,t,r)=>{"use strict";function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var l=r(287).Buffer,h=r(779).inspect,c=h&&h.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r;return t=e,(r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return l.alloc(0);for(var t,r,i,n=l.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=n,i=s,l.prototype.copy.call(t,r,i),s+=a.data.length,a=a.next;return n}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,i=t.data;for(e-=i.length;t=t.next;){var n=t.data,a=e>n.length?n.length:e;if(a===n.length?i+=n:i+=n.slice(0,e),0==(e-=a)){a===n.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=n.slice(a));break}++r}return this.length-=r,i}},{key:"_getBuffer",value:function(e){var t=l.allocUnsafe(e),r=this.head,i=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var n=r.data,a=e>n.length?n.length:e;if(n.copy(t,t.length-e,0,a),0==(e-=a)){a===n.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=n.slice(a));break}++i}return this.length-=i,t}},{key:c,value:function(e,t){return h(this,n(n({},t),{},{depth:0,customInspect:!1}))}}])&&s(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},347:(e,t,r)=>{"use strict";var i=r(606);function n(e,t){s(e,t),a(e)}function a(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return o||l?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(s,this,e)):i.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?r._writableState?r._writableState.errorEmitted?i.nextTick(a,r):(r._writableState.errorEmitted=!0,i.nextTick(n,r,e)):i.nextTick(n,r,e):t?(i.nextTick(a,r),t(e)):i.nextTick(a,r)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,i=e._writableState;r&&r.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}},257:(e,t,r)=>{"use strict";var i=r(463).F.ERR_STREAM_PREMATURE_CLOSE;function n(){}e.exports=function e(t,r,a){if("function"==typeof r)return e(t,null,r);r||(r={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];e.apply(this,i)}}}(a||n);var s=r.readable||!1!==r.readable&&t.readable,o=r.writable||!1!==r.writable&&t.writable,l=function(){t.writable||c()},h=t._writableState&&t._writableState.finished,c=function(){o=!1,h=!0,s||a.call(t)},u=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,u=!0,o||a.call(t)},p=function(e){a.call(t,e)},g=function(){var e;return s&&!u?(t._readableState&&t._readableState.ended||(e=new i),a.call(t,e)):o&&!h?(t._writableState&&t._writableState.ended||(e=new i),a.call(t,e)):void 0},f=function(){t.req.on("finish",c)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",c),t.on("abort",g),t.req?f():t.on("request",f)):o&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",d),t.on("finish",c),!1!==r.error&&t.on("error",p),t.on("close",g),function(){t.removeListener("complete",c),t.removeListener("abort",g),t.removeListener("request",f),t.req&&t.req.removeListener("finish",c),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",c),t.removeListener("end",d),t.removeListener("error",p),t.removeListener("close",g)}}},968:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},267:(e,t,r)=>{"use strict";var i,n=r(463).F,a=n.ERR_MISSING_ARGS,s=n.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function l(e){e()}function h(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var c,u=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var d=t.map((function(e,n){var a=n<t.length-1;return function(e,t,n,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;e.on("close",(function(){o=!0})),void 0===i&&(i=r(257)),i(e,{readable:t,writable:n},(function(e){if(e)return a(e);o=!0,a()}));var l=!1;return function(t){if(!o&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new s("pipe"))}}(e,a,n>0,(function(e){c||(c=e),e&&d.forEach(l),a||(d.forEach(l),u(c))}))}));return t.reduce(h)}},644:(e,t,r)=>{"use strict";var i=r(463).F.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,n){var a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,n,r);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new i(n?r:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}},396:(e,t,r)=>{e.exports=r(7).EventEmitter},141:(e,t,r)=>{"use strict";var i=r(861).Buffer,n=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===n||!n(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=h,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=u,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function h(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.I=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var r=function(e,t,r){var i=t.length-1;if(i<r)return 0;var n=s(t[i]);return n>=0?(n>0&&(e.lastNeed=n-1),n):--i<r||-2===n?0:(n=s(t[i]))>=0?(n>0&&(e.lastNeed=n-2),n):--i<r||-2===n?0:(n=s(t[i]))>=0?(n>0&&(2===n?n=0:e.lastNeed=n-3),n):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var i=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},643:(e,t,r)=>{function i(e){try{if(!r.g.localStorage)return!1}catch(e){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}},779:()=>{},199:()=>{},330:e=>{"use strict";e.exports=JSON.parse('{"name":"@yospace/admanagement-sdk","version":"3.6.11","description":"Yospace AdManagement SDK","homepage":"https://yospace.com","main":"lib/index.js","types":"types/index.d.ts","private":false,"dependencies":{"sax":"1.3.0"},"devDependencies":{"@babel/core":"^7.22.9","@babel/plugin-transform-modules-commonjs":"^7.22.5","@babel/preset-env":"^7.22.9","babel-jest":"^29.6.2","babel-loader":"^9.1.3","babel-plugin-transform-es2015-modules-simple-commonjs":"^0.3.0","documentation":"^13.2.5","jest":"^29.6.2","jest-jasmine2":"^29.6.2","jest-junit":"^16.0.0","jest-sonar-reporter":"^2.0.0","jsdoc":"^4.0.2","jshint":"^2.13.6","msw":"^2.0.4","node-fetch":"^3.3.2","nodemon":"^3.0.1","npm-check-updates":"^16.10.17","nwb":"^0.25.2","process":"0.11.10","sinon":"^15.2.0","stream-browserify":"3.0.0","typescript":"5.1.x","webpack":"^5.88.2","webpack-cli":"^5.1.4","ws":"^8.13.0"},"scripts":{"build":"webpack","build-es5":"webpack --config webpack.config-es5.js","build-unminified":"webpack --config webpack.config-unminified.js","build:npm":"nwb build --no-demo","doc":"documentation build src/** -f html -o Documentation/html --theme src-docs/apidoctemplate","lint":"jshint --config .jshintrc ./src/ || true","test":"jest --coverage --bail","testUnit":"jest --coverage -t UNIT","testStateMachine":"jest --coverage -t STATE_MACHINE","testIntegration":"jest --coverage --bail -t INTEGRATION","tsdefs":"npx -p typescript tsc src/index.js --stripInternal --declaration --allowJs --emitDeclarationOnly --outDir types","tsdefsHosting":"npx -p typescript tsc src/index.js --stripInternal --declaration --allowJs --emitDeclarationOnly --outDir types-${npm_package_version}"},"author":{"name":"Yospace Technologies Ltd","email":"sdk-team@yospace.com"},"license":"SEE LICENSE IN LICENCE","files":["lib/","docs/","types/"]}')}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";r.r(i),r.d(i,{AdBreak:()=>ze,AdBreakEventHandler:()=>P,AdVerification:()=>xe,Advert:()=>qe,AdvertEventHandler:()=>Ue,AdvertWrapper:()=>Ve,AnalyticEventObserver:()=>ae,BreakType:()=>We,CAT_AD_BREAK_EVENTS:()=>f,CAT_TIMELINE_EVENTS:()=>v,CONNECTION_ERROR:()=>Ee,CONNECTION_TIMEOUT:()=>ye,CompanionCreative:()=>Ne,Creative:()=>oe,CreativeEventHandler:()=>se,DEBUG_ALL:()=>D,DEBUG_HTTP_REQUESTS:()=>S,DEBUG_LIFECYCLE:()=>T,DEBUG_PARSING:()=>w,DEBUG_PLAYBACK:()=>y,DEBUG_POLLING:()=>k,DEBUG_REPORTS:()=>A,DEBUG_STATE_MACHINE:()=>b,DEBUG_VALIDATION:()=>I,DebugFlags:()=>E,Event:()=>Oe,FALLBACK_URL:()=>be,INVALID_WINDOW:()=>we,IconClickFallbackImage:()=>Ge,IndustryIcon:()=>He,InteractiveCreative:()=>je,LinearCreative:()=>de,Loggable:()=>e,MALFORMED_URL:()=>Te,NO_DVRLIVE:()=>ke,NonLinearCreative:()=>Ye,PARTIAL_VMAP:()=>Se,PlaybackEventHandler:()=>J,PlaybackMode:()=>fe,PlaybackPolicy:()=>K,PlaybackPolicyHandler:()=>ee,PlayerEvent:()=>Q,Resource:()=>_e,ResourceType:()=>Pe,Session:()=>Ie,SessionDVRLive:()=>Wt,SessionErrorCode:()=>me,SessionLive:()=>zt,SessionProperties:()=>De,SessionState:()=>ve,SessionVOD:()=>Qt,TimedMetadata:()=>z,UNKNOWN_FORMAT:()=>Ae,VASTProperty:()=>st,VerificationEventHandler:()=>Fe,ViewSize:()=>$,ViewableEvent:()=>Me,YoLog:()=>C});class e{static debug(e){}static error(e){}static info(e){}static warn(e){}}var t=r(606);const n=t.env.HTTP_AGENT?t.env.HTTP_AGENT:"Yospace SDK/3.0",a=["mute","unmute","pause","resume","rewind","playerExpand","playerCollapse","closeLinear","skip"],s=["creativeView"],o=["interactiveStart"],l=["loaded","start","firstQuartile","midpoint","thirdQuartile","complete","progress","mute","unmute","pause","resume","rewind","playerExpand","playerCollapse","closeLinear","skip","otherAdInteraction"],h=["creativeView","mute","unmute","pause","resume","rewind","skip","playerExpand","playerCollapse","adExpand","adCollapse","minimize","overlayViewDuration","acceptInvitation","close","otherAdInteraction"],c=["creativeView","close","interactiveStart"],u=["verificationNotExecuted"],d=["loaded","start","firstQuartile","midpoint","thirdQuartile","complete","progress"],p=["breakStart","breakEnd"],g=Object.freeze({ADVERT_START_TIMESLOT:5,DEFAULT_POLLING_DELAY:11e3,EVENT_CUEPOINT_TOL:10,EXPECTED_POLL_COMPLETE_TIME:250,INTERSEGMENT_TIMEOUT:2700,REQUEST_TIMEOUT:5e3,MAX_CADENCE:250,MIN_INTRASEGMENT_TIMEOUT:2500,MIN_SEGMENT_LENGTH:2e3,USER_AGENT:n}),f=1,v=2,m=Object.freeze({IDENTIFIER:"SESSIONIDENTIFIER",LOCATION:"LOCATION",HOSTNODE:"HOST",PORT:"PORT",ANALYTICURL:"ANALYTICURL",PAUSEURL:"PAUSEURL",SCHEME:"SCHEME",QS:"QUERYSTRING",AVAILABILITYSTART:"AVAILABILITYSTARTTIME"}),E=Object.freeze({DEBUG_PLAYBACK:1,DEBUG_LIFECYCLE:2,DEBUG_POLLING:4,DEBUG_REPORTS:8,DEBUG_STATE_MACHINE:16,DEBUG_HTTP_REQUESTS:32,DEBUG_PARSING:64,DEBUG_VALIDATION:128,DEBUG_ALL:Number.MAX_SAFE_INTEGER}),y=E.DEBUG_PLAYBACK,T=E.DEBUG_LIFECYCLE,k=E.DEBUG_POLLING,A=E.DEBUG_REPORTS,b=E.DEBUG_STATE_MACHINE,S=E.DEBUG_HTTP_REQUESTS,w=E.DEBUG_PARSING,I=E.DEBUG_VALIDATION,D=E.DEBUG_ALL;class C{static setLogger(e){C.logger=e}static setDebugFlags(e){C.debugflags=e}static getDebugFlags(){return C.debugflags}static d(e,t){C.debugflags&e&&C.logger.debug("YoAdManagement: "+t)}static e(e){C.logger.error("YoAdManagement: "+e)}static i(e,t){C.debugflags&e&&C.logger.info("YoAdManagement: "+t)}static w(e){C.logger.warn("YoAdManagement: "+e)}static trace(e){C.d(E.DEBUG_VALIDATION,"["+Date.now()+"][YoSDK:"+e+"]")}}C.debugflags=0,C.logger=class extends e{static debug(e){console.log(e)}static error(e){console.error(e)}static info(e){console.info(e)}static warn(e){console.warn(e)}};class R{constructor(){if(new.target===R)throw new TypeError("Cannot construct abstract class XmlValidation directly")}isValid(){return!0}}class P extends R{onNonLinearTrackingEvent(e){throw new Error("Function must be overridden")}}function _(e,t){return null===e?null===t:void 0===e?void 0===t:!(!L(e)||!L(t))&&e.toUpperCase()===t.toUpperCase()}function L(e){return"string"==typeof e||e instanceof String}function N(e){return e?"    "+e.toString().replace("\n","\n    "):"null"}function B(e){return!e||""===e}function M(e,t,r){let i=e;if(0===t||">"===t){i+="\n";for(let e=0;e<4*r;++e)i+=" "}return i}function U(e,t){if(!e||0===e.length||-1===e.indexOf("T"))return t;let r=e.substring(e.indexOf("T"),e.length-1);-1===r.indexOf("+")&&-1===r.indexOf("-")&&Number.isInteger(Number.parseInt(e.charAt(e.length-1)))&&(e+="Z");let i=Date.parse(e);return Number.isNaN(i)?t:i}function O(e,t){let r=void 0!==t?t:-1;if(!("string"==typeof e&&e.length>0))return r;let i=e.split(":");if(3!==i.length)return r;let n=parseInt(i[0]),a=parseInt(i[1]);if(Number.isNaN(n)||Number.isNaN(a))return r;let s=0,o=0,l=i[2].split(".");return 2!==l.length?s=parseInt(i[2]):(s=parseInt(l[0]),o=parseInt(l[1])),Number.isNaN(s)||Number.isNaN(o)||n>23||a>59||s>59?r:36e5*n+6e4*a+1e3*s+o}function F(e){return new Date(e).toISOString()}function x(e){let t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),i=Math.floor(e/36e5%24);return`${i<10?0:""}${i}:${r<10?0:""}${r}:${t<10?0:""}${t}.${(e=Math.round(e%1e3))<10?"00":e<100?"0":""}${e}`}class V{static categoryForEvent(e){return V.isValidAdBreakEvent(e)?f:V.isTimelineEvent(e)?v:0}static isValidPlayerOperationEvent(e){return-1!==a.indexOf(e)}static isValidCompanionEvent(e){return-1!==s.indexOf(e)}static isValidInteractiveEvent(e){return-1!==o.indexOf(e)}static isValidLinearEvent(e){return-1!==l.indexOf(e)}static isValidNonLinearEvent(e){return-1!==h.indexOf(e)}static isValidVerificationEvent(e){return-1!==u.indexOf(e)}static isTimelineEvent(e){return-1!==d.indexOf(e)}static isValidAdBreakEvent(e){return-1!==p.indexOf(e)}static isValidVisibleEvent(e){return-1!==c.indexOf(e)}constructor(e,t,r,i){this.trackingEvent=e,this.trackingUrls=JSON.parse(JSON.stringify(t||[])),this.adBreakIdentifier=r||"",this.mediaIdentifier=i||""}copy(){return new V(this.trackingEvent,this.trackingUrls,this.adBreakIdentifier,this.mediaIdentifier)}addTrackingUrl(e){e?this.trackingUrls.push(e):C.e("addTrackingUrl: url was null")}getAdBreakIdentifier(){return this.adBreakIdentifier}getEventType(){return this.trackingEvent}getMediaIdentifier(){return this.mediaIdentifier}getTrackingUrls(){return Object.assign([],this.trackingUrls)}removeTrackingUrls(){this.trackingUrls=[]}toString(){let e="";e+="Event:",e+=this.trackingEvent;for(let t of this.trackingUrls)e+="\n - Url:",e+=t;return e}}function G(e,t,...r){e&&(t=t.bind(e));let i=null;try{i=t(...r)}catch(e){let r=t.toString(),i=/function ([^\(]*)/.exec(r);i&&i.length>0?C.e("Exception thrown from callback function "+i[1]+": "+e):C.e("Exception thrown from callback function.")}return i}function H(e,t){if(!e)return C.e(`${t.name} has not been implemented`),!1;let r=!0,i=new t,n=Object.getOwnPropertyNames(t.prototype);for(const a of n)"constructor"!==a&&(e[a]&&e[a]!==i[a]||(C.e(`${t.name} does not implement ${a}`),r=!1));return r}class Y{constructor(e){this.utcTimestamp=e}toJsonString(){return JSON.stringify(this)}getUtcTimestamp(){return this.utcTimestamp}}class j extends Y{constructor(e,t,r,i,n){super(F(Date.now())),this.adBreakIdentifier=i,this.url=e,this.errorCode=t,this.event=r,this.mediaIdentifier=n||""}getAdBreakIdentifier(){return this.adBreakIdentifier}getMediaIdentifier(){return this.mediaIdentifier}getUrl(){return this.url}getErrorCode(){return this.errorCode}getEvent(){return this.event}}class q{constructor(e,t){this.properties=e,this.suppress=!1,this.observers=[],this.addTrackingError=t}addAnalyticObserver(e){e?this.observers.push(e):C.e("addAnalyticObserver: listener was null")}applyEncryptedTracking(e){return this.properties.getApplyEncryptedTracking()&&(e=e.replace("http:","https:")),e}fire(e,t){let r={method:"GET"};this.properties.getAllowCorsForAnalytics()?B(this.properties.getUserAgent())||(r.headers=function(e){let t=new Headers;return t.append("User-Agent",e),t}(this.properties.getUserAgent())):r.mode="no-cors";for(let i of e.getTrackingUrls())if(this.performMacroSubstitutionForUrl(i,t),this.applyEncryptedTracking(i),Ce(i))C.d(E.DEBUG_REPORTS,"Firing report url: "+i),Re.get(i,r,this.properties.getResourceTimeout()).then((t=>{if(!t.ok&&0!==t.status){const r=new j(i,t.status,e.trackingEvent,e.getAdBreakIdentifier(),e.getMediaIdentifier());this.addTrackingError(r)}}));else{C.e("Invalid report URL: "+i);const t=new j(i,Te,e.trackingEvent,e.getAdBreakIdentifier(),e.getMediaIdentifier());this.addTrackingError(t)}}fireBeacon(e,t){if(e&&e.getTrackingUrls().length>0&&!this.shouldSuppress(e.event))try{this.fire(e,t)}catch(e){throw C.e("Unable to fire tracking URLs for report: "+e),e}}fireBeacons(e,t){let r=[];for(let t of e)for(let e of t.getTrackingUrls())r.push(e);this.fireBeacon(new V("",r),t)}performMacroSubstitutionForUrl(e,t){let r="",i=F(Date.now()),n=x(t.getPlayhead()),a=-1===t.getAdvertStart()?"-1":x(t.getAdvertStart());r=encodeURIComponent(t.getAssetUri()),i=encodeURIComponent(i),n=encodeURIComponent(n),a=encodeURIComponent(a);let s=1e7+Math.round(1e8*Math.random());e=e.replace("[ASSETURI]",r).replace("%5BASSETURI%5D",r).replace("[CACHEBUSTING]",s).replace("%5BCACHEBUSTING%5D",s).replace("[TIMESTAMP]",i).replace("%5BTIMESTAMP%5D",i).replace("[CONTENTPLAYHEAD]",n).replace("%5BCONTENTPLAYHEAD%5D",n).replace("[MEDIAPLAYHEAD]",n).replace("%5BMEDIAPLAYHEAD%5D",n).replace("[ADPLAYHEAD]",a).replace("%5BADPLAYHEAD%5D",a);for(let[r,i]of t.getMacroSubstitutions())e=e.replace(`[${r}]`,i).replace(`%5B${r}%5D`,i);return(e=e.replace(/\[(.*?)]/g,"-1")).replace(/%5B(.*)%5D/g,"-1")}raiseAdBreakEarlyReturn(e,t){C.trace("earlyreturn");for(let r of this.observers)G(r,r.onAdvertBreakEarlyReturn,e,t)}raiseAdBreakCallback(e,t,r){if("start"===e)for(let e of this.observers)G(e,e.onAdvertBreakStart,t,r);else if("end"===e)for(let e of this.observers)G(e,e.onAdvertBreakEnd,r)}raiseAdvertCallback(e,t,r){if("start"===e)for(let e of this.observers)G(e,e.onAdvertStart,t,r);else if("end"===e)for(let e of this.observers)G(e,e.onAdvertEnd,r)}raiseAnalyticUpdateCallback(e){if(!this.suppress)for(let t of this.observers)G(t,t.onAnalyticUpdate,e)}raiseSessionErrorCallback(e,t){for(const r of this.observers)G(r,r.onSessionError,e,t)}raiseTrackingCallback(e,t){if(!this.shouldSuppress(e))for(let r of this.observers)G(r,r.onTrackingEvent,e,t)}raiseTrackingErrorCallback(e,t){for(const r of this.observers)G(r,r.onTrackingError,e,t)}removeAnalyticObserver(e){this.observers.splice(this.observers.indexOf(e))}reportsSuppressed(){return this.suppress}shouldSuppress(e){let t=V.categoryForEvent(e);return!(this.properties.getExcludedCategories()&t)&&this.suppress}suppressReports(e){this.suppress!==e&&(this.suppress=e,C.d(E.DEBUG_REPORTS,e?"Suppress reports":"Unsuppress reports"))}}class W{constructor(e,t,r,i){this.playhead=e,this.advertStart=t&&t>=0?e-t:-1,this.assetUri=r||"",this.macroSubstitutions=i||new Map}getAdvertStart(){return this.advertStart}getAssetUri(){return this.assetUri}getMacroSubstitutions(){return this.macroSubstitutions}getPlayhead(){return this.playhead}}class K extends R{canStop(){throw new Error("Function must be overridden")}canPause(){throw new Error("Function must be overridden")}canSkip(){throw new Error("Function must be overridden")}willSeekTo(e){throw new Error("Function must be overridden")}canChangeVolume(e){throw new Error("Function must be overridden")}canResize(e){throw new Error("Function must be overridden")}canResizeCreative(e){throw new Error("Function must be overridden")}canClickThrough(e){throw new Error("Function must be overridden")}}class z{constructor(e,t,r,i,n,a){this.mediaId=z.decodeString(e),this.offset=n,this.segmentCount=r,this.segmentNumber=t,this.playhead=a,this.timestamp=Date.now(),this.typeWithinSegment=i}static createFromMetadata(e,t,r,i,n){if(!e)return C.e("Failed to interpret ymid"),null;r=z.decodeString(r);let a=X.getForKey(r);if(null==a)return C.e("Failed to interpret ytyp"),null;let s=z.decodeString(t).split(":");if(2!==s.length)return C.e("Failed to interpret yseq"),null;let o=parseInt(s[0]),l=parseInt(s[1]);if(isNaN(o)||0===o||isNaN(l)||0===l)return C.e("Failed to interpret yseq"),null;let h=parseFloat(this.decodeString(i)),c=Number.isNaN(h)?0:Math.round(1e3*h);return n<0?(C.w("Invalid playhead provided:"+n),null):new z(e,o,l,a,c,n)}static decodeString(e){return e&&e.length>0&&3===e[0]?e.substring(1):e}getMediaId(){return this.mediaId}getOffset(){return this.offset}getPlayhead(){return this.playhead}getSegmentCount(){return this.segmentCount}getSegmentNumber(){return this.segmentNumber}getTimestamp(){return this.timestamp}getTypeWithinSegment(){return this.typeWithinSegment}isDuplicate(e){return!!e&&this.mediaId===e.mediaId&&this.segmentNumber===e.segmentNumber&&this.segmentCount===e.segmentCount&&this.typeWithinSegment===e.typeWithinSegment&&this.offset===e.offset}isFirstInSequence(){return this.isFirstInSegment()&&1===this.segmentNumber}isFirstInSegment(){return this.typeWithinSegment===X.START}isInSequence(e){if(!e)return!0;if(this.mediaId!==e.mediaId)return this.isFirstInSequence();let t=this.segmentNumber-e.segmentNumber;return 0===t?this.typeWithinSegment.isInSequence(e.typeWithinSegment)||this.typeWithinSegment.isEqualMidType(e.typeWithinSegment)&&this.offset>e.offset:t>0}isLastInSegment(){return this.typeWithinSegment===X.END}isLastInSequence(){return this.isLastInSegment()&&this.isLastSegment()}isLastSegment(){return this.segmentNumber===this.segmentCount}toString(){return"Metadata [ @"+this.playhead+" / "+this.mediaId+" / "+this.segmentNumber+":"+this.segmentCount+" / "+this.typeWithinSegment.key+" : "+this.offset+" ]"}}class X{constructor(e,t){this.key=e,this.order=t}static getForKey(e){if(!X.initialised){let e=X.END,t=X.MID,r=X.START;X.KEY_MAP.set(e.key,e),X.KEY_MAP.set(t.key,t),X.KEY_MAP.set(r.key,r),X.initialised=!0}return X.KEY_MAP.get(e)}isEqualMidType(e){return!!e&&1===this.order&&1===e.order}isInSequence(e){return!e||this.order>e.order}}X.END=new X("E",2),X.MID=new X("M",1),X.START=new X("S",0),X.KEY_MAP=new Map,X.initialised=!1;const Q=Object.freeze({START:0,STOP:1,PAUSE:2,RESUME:3,STALL:4,CONTINUE:5,ADVERT_REWIND:6,ADVERT_SKIP:7,SEEK:8,PLAYBACK_READY:9}),$=Object.freeze({COLLAPSED:0,EXPANDED:1});class J extends K{onPlayerEvent(e,t){throw new Error("Function must be overridden")}onPlayheadUpdate(e){throw new Error("Function must be overridden")}onTimedMetadata(e){throw new Error("Function must be overridden")}onViewSizeChange(e){throw new Error("Function must be overridden")}onVolumeChange(e){throw new Error("Function must be overridden")}}class Z extends J{addParsingError(e){throw new Error("Function must be overridden")}clearParsingErrors(){throw new Error("Function must be overridden")}fireTrackingReport(e){throw new Error("Function must be overridden")}fireTrackingReportForCreative(e,t){throw new Error("Function must be overridden")}fireTrackingReportForIcon(e,t){throw new Error("Function must be overridden")}raiseTrackingCallbackForCreative(e,t){throw new Error("Function must be overridden")}getSessionProperties(){throw new Error("Function must be overridden")}normaliseAdBreakStart(e,t){throw new Error("Function must be overridden")}}class ee{canStop(e,t){throw new Error("Must be overridden")}canPause(e,t){throw new Error("Must be overridden")}canSkip(e,t,r){throw new Error("Must be overridden")}willSeekTo(e,t,r){throw new Error("Must be overridden")}canChangeVolume(e,t,r){throw new Error("Must be overridden")}canResize(e,t,r){throw new Error("Must be overridden")}canResizeCreative(e,t,r){throw new Error("Must be overridden")}canClickThrough(e,t,r){throw new Error("Must be overridden")}setPlaybackMode(e){throw new Error("Must be overridden")}didSkip(e,t,r){throw new Error("Must be overridden")}didSeek(e,t,r){throw new Error("Must be overridden")}}class te extends ee{constructor(e){super(),this.playbackMode=e}canStop(e,t){switch(this.playbackMode){case fe.LIVE:case fe.DVRLIVE:case fe.VOD:}return!0}canPause(e,t){switch(this.playbackMode){case fe.LIVE:return!1;case fe.DVRLIVE:case fe.VOD:default:return!0}}canSkip(e,t,r){switch(this.playbackMode){case fe.LIVE:return-1;case fe.DVRLIVE:case fe.VOD:default:return 0}}willSeekTo(e,t,r){switch(this.playbackMode){case fe.LIVE:return r;case fe.DVRLIVE:case fe.VOD:default:return e}}canChangeVolume(e,t,r){switch(this.playbackMode){case fe.LIVE:case fe.DVRLIVE:case fe.VOD:}return!0}canResize(e,t,r){switch(this.playbackMode){case fe.LIVE:case fe.DVRLIVE:case fe.VOD:}return!0}canResizeCreative(e,t,r){switch(this.playbackMode){case fe.LIVE:case fe.DVRLIVE:case fe.VOD:}return!0}canClickThrough(e,t,r){switch(this.playbackMode){case fe.LIVE:case fe.DVRLIVE:case fe.VOD:}return!0}setPlaybackMode(e){this.playbackMode=e}didSkip(e,t,r){}didSeek(e,t,r){}}function re(e){let t=new Map;if(e)for(let r in e)t.set(r,e[r]);return t}function ie(e){return e?"{"+Array.from(e,(([e,t])=>e+": "+t)).join(", ")+"}":"{}"}function ne(e,t){if(!t)return C.e("getKeyFromValue: obj is null"),null;for(let[r,i]of Object.entries(t))if(e===i)return r;return null}class ae{onAdvertBreakStart(e,t){throw new Error("Function must be overridden")}onAdvertBreakEnd(e){throw new Error("Function must be overridden")}onAdvertBreakEarlyReturn(e,t){throw new Error("Function must be overridden")}onAdvertEnd(e){throw new Error("Function must be overridden")}onAdvertStart(e,t){throw new Error("Function must be overridden")}onAnalyticUpdate(e){throw new Error("Function must be overridden")}onTrackingEvent(e,t){throw new Error("Function must be overridden")}onSessionError(e,t){throw new Error("Function must be overridden")}onTrackingError(e,t){throw new Error("Function must be overridden")}}class se extends R{onClickThrough(){throw new Error("Function must be overridden")}onTrackingEvent(e){throw new Error("Function must be overridden")}setVisible(e){throw new Error("Function must be overridden")}}class oe extends se{constructor(e){super(),this.advertId=e.advertId?e.advertId:"",this.creativeId=e.id?e.id:"",this.universalAdIds=e.universalAdIds,this.sequence=e.sequence,this.adParameters=e.adParameters,this.extensions=null,this.nonLinear=!1}postParse(e){if(this.extensions=e,this.companionExtensions)for(let e of this.companionExtensions.getChildren())this.extensions.addChild(e)}getAdvertIdentifier(){return this.advertId}getAdParameters(){return this.adParameters}getExtensions(){return this.extensions}getCreativeIdentifier(){return this.creativeId}getSequence(){return this.sequence}getUniversalAdIds(){return this.universalAdIds}isNonLinear(){return this.nonLinear}setNonLinear(e){this.nonLinear=e}setVisible(e){}toString(){let e="";if(e+=`\n - Id:${this.creativeId} AdId:${this.advertId} Sequence:${this.sequence}`,this.adParameters&&(e+="\n - AdParameters:",e+="\n"+N(this.adParameters)),this.universalAdIds){e+="\n - UniversalAdIds:";for(let t of this.universalAdIds)e+="\n"+N(t)}return this.extensions&&(e+="\n - CreativeExtensions:",e+="\n"+N(this.extensions)),e}}class le{constructor(e,t,r){this.clickThroughUrl=e||"",this.clickTrackingUrls=t||[],this.customClicks=r||[]}getClickThroughUrl(){return this.clickThroughUrl}getClickTrackingUrls(){return this.clickTrackingUrls}getCustomClicks(){return this.customClicks}toString(){let e="";if(B(this.clickThroughUrl)||(e+="\n* Click-through Url: ",e+=this.clickThroughUrl),this.clickTrackingUrls.length>0)for(let t of this.clickTrackingUrls)e+="\n* Click tracking Url: ",e+=t;if(this.customClicks.length>0)for(let t of this.customClicks)e+="\n* Custom click Url: ",e+=t;return e}}function he(e,t){return e.length>0?new V(t,e):null}function ce(e){if(!e)return!1;let t=null,r=null;for(let i of e){let e=i.getName(),n=i.getValue();"width"!==e||B(n)?"height"!==e||B(n)||(r=i):t=i}return!(!t||!r)}function ue(e,t){for(let[,r]of e)r.prefetch(t)}class de extends oe{constructor(e,t,r,i){super(e),this.duration=O(e.duration,0),this.trackingMap=e.trackingMap?e.trackingMap:new Map,this.videoClicks=t||new le("",null,null),this.icons=e.icons,this.assetUri=e.currentAssetUri?e.currentAssetUri:"",this.interactiveCreative=r,this.skipOffset=e.skipOffset,this.broker=i}getAssetUri(){return this.assetUri}getClickThroughUrl(){return this.videoClicks.getClickThroughUrl()}getClickTrackingUrls(){return this.videoClicks.getClickTrackingUrls()}getCustomClickUrls(){return this.videoClicks.getCustomClicks()}getDuration(){return this.duration}getIndustryIcons(){return Object.assign([],this.icons)}getInteractiveCreative(){return this.interactiveCreative}getSkipOffset(){if(!this.skipOffset||""===this.skipOffset)return-1;if(-1!==this.skipOffset.indexOf("%")){let e=parseFloat(this.skipOffset.substring(0,this.skipOffset.length-1));return e?Math.round(e*this.duration/100):(C.w("Invalid skipoffset string: "+this.skipOffset),-1)}return O(this.skipOffset,-1)}getTrackingMap(){return this.trackingMap}getTrackingReport(e){return this.trackingMap.has(e)?this.trackingMap.get(e):null}initialiseInteractiveCreative(e){this.interactiveCreative&&this.interactiveCreative.initialise(this.getAdParameters(),this.duration,e)}isNonLinear(){return!1}isValid(){return this.duration>0}onClickThrough(){let e=this.videoClicks.getClickTrackingUrls();if(e.length>0){let t=he(e,"ClickTracking");this.broker.fireTrackingReportForCreative(t,this)}this.broker.raiseTrackingCallbackForCreative("ClickTracking",this)}onTrackingEvent(e){if("customClick"===e){let t=this.videoClicks.getCustomClicks();if(t.length){let r=new V(e,t);this.broker.fireTrackingReportForCreative(r,this)}}else{if(V.isValidPlayerOperationEvent(e))return void C.w("Use PlaybackEventHandler functions to signal event "+e);if(V.isTimelineEvent(e))return void C.w("Invalid event: "+e+". Timeline events are signalled by position updates");let t=this.trackingMap.get(e);t&&this.broker.fireTrackingReportForCreative(t,this)}}setDuration(e){this.duration=e}toString(){let e="";if(this.trackingMap.size>0){e+="\n ** Tracking events - ";for(let[t,r]of this.trackingMap)e+=N("\n "+t+":"+r)}let t="";if(this.icons.length>0){t+="\n  ** Industry Icon(s) - ";for(let e of this.icons)t+=e}let r="\n--- Linear Creative:\n - assetUri:";return r+=this.assetUri,this.interactiveCreative&&(r+=this.interactiveCreative),r+=super.toString(),B(this.skipOffset)||(r+="\n - SkipOffset:",r+=this.skipOffset),r+=e,r+=N(this.videoClicks),r+=t,r}}class pe extends Y{constructor(e,t,r){super(F(Date.now())),this.message=t;let i=B(r)?t:r;i+=B(e)?"":" (breakId: "+e+")",this.errorDetail=i}getMessage(){return this.message}getErrorDetail(){return this.errorDetail}}pe.Message=Object.freeze({BAD_XML:"XML is not well-formed",NO_VMAP:"Document is not VMAP",INCORRECT_VAST_VERSION:"Incorrect VAST version",INVALID_DURATION:"Invalid duration",INVALID_START_TIME:"Invalid start time",EMPTY_ADVERT_AND_TRACKING:"No adverts or tracking",INVALID_MEDIAID:"Yospace media id not found",MISSING_CREATIVE:"Missing Linear Creative",INVALID_TRACKING_URL:"Invalid tracking URL"});const ge=r(330),fe=Object.freeze({LIVE:0,DVRLIVE:1,VOD:2}),ve=Object.freeze({NONE:0,INITIALISED:1,FAILED:2,NO_ANALYTICS:3,SHUTDOWN:4}),me=Object.freeze({TIMEOUT:0,UNRESOLVED_BREAK:1,PARSING_ERROR:2,TRACKING_ERROR:3}),Ee=-1,ye=-2,Te=-3,ke=-11,Ae=-20,be=-21,Se=-22,we=-1;class Ie extends Z{constructor(e){super(),this.sessionProperties=e?Object.assign(Object.create(Object.getPrototypeOf(e)),e):new De,this.trackingErrors=[],this.reportsManager=new q(e,this.addTrackingError.bind(this)),this.linearAdBreaks=[],this.nonLinearAdBreaks=[],this.displayAdBreaks=[],this.playbackBuffering=!1,this.playing=!1,this.currentAdBreak=null,this.currentAdvert=null,this.identifier="",this.playbackUrl=null,this.analyticsUrl=null,this.lastAnalyticUpdate=null,this.playhead=0,this.lastPlayed=0,this.lastTraced=0,this.sessionState=ve.NONE,this.resultCode=0,this.policyHandler=null,this.parsingErrors=[],this.defaultPolicyHandler=new te(this.getPlaybackMode()),this.analyticPoller=null,C.trace("sdk javascript "+Ie.getVersion()+" "+ne(this.getPlaybackMode(),fe)),this.logSessionInfo()}logSessionInfo(){if(C.logger.debug("Yospace AdManagement SDK for JavaScript v"+Ie.getVersion()+" ("+ne(this.getPlaybackMode(),fe)+")"),C.logger.debug("Debug flags:"),C.getDebugFlags()===E.DEBUG_ALL)C.logger.debug("  DEBUG_ALL is set");else for(const e in E)E[e]!==E.DEBUG_ALL&&E[e]&C.getDebugFlags()&&C.logger.debug(`  ${e} is set`);C.logger.debug(this.getSessionProperties().toString())}addAnalyticObserver(e){if(!H(e,ae))throw new Error("addAnalyticObserver: invalid observer");this.reportsManager.addAnalyticObserver(e),this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this)}addParsingError(e){this.parsingErrors.push(e)}addTrackingError(e){this.trackingErrors.push(e),this.reportsManager.raiseTrackingErrorCallback(e,this)}clearTrackingErrors(){this.trackingErrors=[]}analyticsSuppressed(){return this.reportsManager.reportsSuppressed()}adjustForEarlyReturn(e){let t=this.getAdBreakForPlayhead(e);t&&t.adjustForEarlyReturn(e)&&(this.getReportsManager().raiseAdBreakEarlyReturn(t,this),t.isValid()||this.linearAdBreaks.splice(this.linearAdBreaks.indexOf(t)))}canChangeVolume(e){let t=G(this.policyHandler,this.policyHandler.canChangeVolume,e,this.playhead,this.linearAdBreaks);return null===t&&(t=this.defaultPolicyHandler.canChangeVolume(e,this.playhead,this.linearAdBreaks)),t}canClickThrough(e){let t=G(this.policyHandler,this.policyHandler.canClickThrough,e,this.playhead,this.linearAdBreaks);return null===t&&(t=this.defaultPolicyHandler.canClickThrough(e,this.playhead,this.linearAdBreaks)),t}canPause(){let e=G(this.policyHandler,this.policyHandler.canPause,this.playhead,this.linearAdBreaks);return null===e&&(e=this.defaultPolicyHandler.canPause(this.playhead,this.linearAdBreaks)),e}canResize(e){let t=G(this.policyHandler,this.policyHandler.canResize,e,this.playhead,this.linearAdBreaks);return null===t&&(t=this.defaultPolicyHandler.canResize(e,this.playhead,this.linearAdBreaks)),t}canResizeCreative(e){let t=G(this.policyHandler,this.policyHandler.canResizeCreative,e,this.playhead,this.linearAdBreaks);return null===t&&(t=this.defaultPolicyHandler.canResizeCreative(e,this.playhead,this.linearAdBreaks)),t}canSkip(){let e=G(this.policyHandler,this.policyHandler.canSkip,this.playhead,this.linearAdBreaks,0);return null===e&&(e=this.defaultPolicyHandler.canSkip(this.playhead,this.linearAdBreaks,0)),e}canStop(){let e=G(this.policyHandler,this.policyHandler.canStop,this.playhead,this.linearAdBreaks);return null===e&&(e=this.defaultPolicyHandler.canStop(this.playhead,this.linearAdBreaks)),e}clearParsingErrors(){this.parsingErrors=[]}completeWithStatus(e,t){this.setState(e),this.setResultCode(t),e===ve.INITIALISED&&C.trace("sessionStart")}fireImpressionReport(){let e=this.currentAdvert;if(e&&e.isActive()){let t=e.getImpressions(!0);if(t){C.trace("impression");let r=t.copy(),i=new W(this.getPlayhead(),e.getStart(),e.getLinearCreative().getAssetUri(),e.getMacroSubstitutions());this.reportsManager.fireBeacon(r,i),t.removeTrackingUrls()}}}fireTrackingReport(e){let t=null,r=null,i=null,n=this.getCurrentAdvert();n&&(t=n.getStart(),n.getLinearCreative()&&(r=n.getLinearCreative().getAssetUri()),i=n.getMacroSubstitutions()),C.trace("trackingEvent "+e.getEventType());let a=new W(this.getPlayhead(),t,r,i);this.reportsManager.fireBeacon(e,a)}fireTrackingReportForCreative(e,t){let r=null,i=this.getAdvertForCreative(t);if(i){i.getLinearCreative()&&(r=i.getLinearCreative().getAssetUri()),C.trace("trackingEvent "+e.getEventType());let t=new W(this.getPlayhead(),i.getStart(),r,i.getMacroSubstitutions());this.reportsManager.fireBeacon(e,t)}}fireTrackingReportForIcon(e,t){let r=null,i=this.currentAdvert;if(i&&i.isActive()&&i.containsIcon(t)){i.getLinearCreative()&&(r=i.getLinearCreative().getAssetUri()),C.trace("trackingEvent "+e.getEventType());let t=new W(this.getPlayhead(),i.getStart(),r,i.getMacroSubstitutions());this.reportsManager.fireBeacon(e,t)}}getAdBreakForPlayhead(e){for(let t of this.linearAdBreaks)if(t.getStart()<=e&&e<t.getStart()+t.getDuration())return t;return null}getAdBreaksByType(e){switch(e){case We.LINEAR:return Object.assign([],this.linearAdBreaks);case We.NONLINEAR:return Object.assign([],this.nonLinearAdBreaks);case We.DISPLAY:return Object.assign([],this.displayAdBreaks);default:return null}}getAnalyticsUrl(){return this.analyticsUrl}getAdvertForCreative(e){let t=this.currentAdvert;if(t&&t.isActive()&&t.getLinearCreative()===e)return t;if(e.isNonLinear()){for(let r of this.nonLinearAdBreaks)if(t=r.getAdvertForCreative(e),t)return t;for(let r of this.displayAdBreaks)if(t=r.getAdvertForCreative(e),t)return t}else if(!(e instanceof de))for(let r of this.linearAdBreaks)if(t=r.getAdvertForCreative(e),t)return t;return null}getCurrentAdBreak(){return this.currentAdBreak}getCurrentAdvert(){return this.currentAdvert}getIdentifier(){return this.identifier}getJsonResponseUrl(e){try{return JSON.parse(e).url}catch(e){return null}}getPlaybackMode(){throw new Error("This must be overridden")}getPlaybackUrl(){return this.playbackUrl}getPlayhead(){return this.playhead}getResultCode(){return this.resultCode}getLastAnalyticUpdate(){return this.lastAnalyticUpdate}getLastPlayed(){return this.lastPlayed}getReportsManager(){return this.reportsManager}getParsingErrors(){return Object.assign([],this.parsingErrors)}getTrackingErrors(){return Object.assign([],this.trackingErrors)}getSessionProperties(){return Object.freeze(this.sessionProperties)}getSessionState(){return this.sessionState}getToken(){return this.sessionProperties.getToken()}static getVersion(){return ge.version}handleFallbackUrl(e){let t=this.getJsonResponseUrl(e);return t&&Ce(t)?(this.setPlaybackUrl(t),this.completeWithStatus(ve.NO_ANALYTICS,be),!0):(this.completeWithStatus(ve.FAILED,be),!1)}isNotPlaying(){return!this.playing}isPlaybackBuffering(){return this.playbackBuffering}normaliseAdBreakStart(e,t){let r=this.linearAdBreaks.length;if(r){let i=this.linearAdBreaks[r-1],n=Ke(t,e,We.LINEAR);if(i.getPosition().toLowerCase()===n.toLowerCase()){let t=i.getStart()+i.getDuration(),r=this.analyticPoller?this.analyticPoller.getFrequency():g.DEFAULT_POLLING_DELAY,n=Math.min(this.sessionProperties.getConsecutiveBreakTolerance(),r);if(t>e||e-t<n)return t}}return e}onAdvertStart(e,t){e&&C.d(E.DEBUG_REPORTS,"onAdvertStart: "+(e.isActive()?"active ":"inactive ")+(e.isFiller()?"filler":"advert")+", duration: "+e.getDuration()+", trackingSchedule: "+ie(e.getTrackingSchedule()))}onAdvertSkip(e){this.signalActionTrackingEvent("skip"),this.policyHandler&&G(this.policyHandler,this.policyHandler.didSkip,this.playhead,e,this.linearAdBreaks),this.playhead=e}onPlaybackContinue(){this.playbackBuffering?(this.playbackBuffering=!1,C.trace("playbackEvent continue")):C.d(E.DEBUG_PLAYBACK,"Reporting CONTINUE when not buffering")}onPlayerEvent(e,t){switch(C.d(E.DEBUG_PLAYBACK,"New playback event: "+ne(e,Q)+", playhead: "+t),e){case Q.START:this.onPlaybackStart(t);break;case Q.STOP:this.onPlaybackStop();break;case Q.PAUSE:this.onPlaybackPause();break;case Q.RESUME:this.onPlaybackResume();break;case Q.STALL:this.onPlaybackStall();break;case Q.CONTINUE:this.onPlaybackContinue();break;case Q.ADVERT_REWIND:this.onPlaybackRewind(t);break;case Q.ADVERT_SKIP:this.onAdvertSkip(t);break;case Q.SEEK:this.onPlaybackSeek(t);break;case Q.PLAYBACK_READY:this.onPlaybackReady();break;default:C.w("Unknown playback event: "+e)}C.d(E.DEBUG_PLAYBACK,"Playing: "+this.playing+", Buffering: "+this.playbackBuffering)}onPlaybackPause(){this.playing?(this.playing=!1,this.signalActionTrackingEvent("pause")):C.d(E.DEBUG_PLAYBACK,"Reporting PAUSE when already paused")}onPlaybackResume(){this.playing?C.d(E.DEBUG_PLAYBACK,"Reporting RESUME when already paying"):(this.playing=!0,this.signalActionTrackingEvent("resume"))}onPlaybackReady(){C.trace("playbackevent ready"),this.getSessionState()!==ve.INITIALISED?C.d(E.DEBUG_PLAYBACK,"Reporting PLAYBACKREADY when the session is not initialised"):!0===this.playing&&C.d(E.DEBUG_PLAYBACK,"Reporting PLAYBACKREADY when playback has already begun")}onPlaybackRewind(e){this.signalActionTrackingEvent("rewind"),this.playhead=e}onPlaybackSeek(e){this.policyHandler&&G(this.policyHandler,this.policyHandler.didSeek,this.playhead,e,this.linearAdBreaks),C.trace("playbackEvent seek: "+e),this.playhead=e}onPlaybackStall(){this.playing&&!this.playbackBuffering?(this.playbackBuffering=!0,C.trace("playbackEvent stall")):C.d(E.DEBUG_PLAYBACK,"Reporting STALL when not buffering")}onPlaybackStart(e){this.playing?C.d(E.DEBUG_PLAYBACK,"Reporting START when already playing"):(this.playing=!0,C.trace("playbackEvent start"))}onPlaybackStop(){if(this.playing){this.playing=!1,this.playbackBuffering=!1,C.trace("playbackEvent stop");let e=this.currentAdvert;if(e){let t=e.getLinearCreative();if(t){let e=t.getTrackingReport("closeLinear");e&&this.fireTrackingReport(e)}}}}onPlayheadSeek(e){this.policyHandler&&G(this.policyHandler,this.policyHandler.didSeek,this.playhead,e,this.linearAdBreaks),C.trace("playbackEvent seek: "+e),this.playhead=e}onPlayheadUpdate(e){(0===this.lastTraced||e<this.lastTraced||e-this.lastTraced>=5e3)&&(C.trace("sdk playhead "+e),this.lastTraced=e),this.lastPlayed=this.playhead,this.playhead=e}onSessionError(e){C.trace("sessionerror "+e),C.e("Yospace session has expired"),e===me.TIMEOUT&&this.setState(ve.SHUTDOWN),this.getReportsManager().raiseSessionErrorCallback(e,this)}onTimedMetadata(e){}onViewSizeChange(e){switch(e){case $.EXPANDED:this.signalActionTrackingEvent("playerExpand");break;case $.COLLAPSED:this.signalActionTrackingEvent("playerCollapse");break;default:C.w("Unknown ViewSize: "+ne(e,$))}}onVolumeChange(e){let t=e?"mute":"unmute";this.signalActionTrackingEvent(t)}raiseTrackingCallbackForCreative(e,t){this.getAdvertForCreative(t)&&(C.trace("trackingEvent "+e),this.getReportsManager().raiseTrackingCallback(e,this))}removeAllNonLinearAdBreaks(){this.nonLinearAdBreaks=[],this.displayAdBreaks=[]}removeAnalyticObserver(e){this.reportsManager.removeAnalyticObserver(e)}removeNonLinearAdBreak(e){for(let t=0;t<this.nonLinearAdBreaks.length;++t)if(this.nonLinearAdBreaks[t]===e)return void this.nonLinearAdBreaks.splice(t,1);for(let t=0;t<this.displayAdBreaks.length;++t)if(this.displayAdBreaks[t]===e)return void this.displayAdBreaks.splice(t,1)}removeKeysFromTrackingSchedule(e){for(let t of e)this.currentAdvert.removeFromTrackingSchedule(t)}setAnalyticsUrl(e){this.analyticsUrl=e}setCurrentAdBreak(e){this.currentAdBreak=e}setCurrentAdvert(e){this.currentAdvert=e}setIdentifier(e){this.identifier=e}setLastAnalyticUpdate(e){this.lastAnalyticUpdate=e}setPlaybackPolicyHandler(e){if(e){if(!H(e,ee))throw new Error("setPlaybackPolicyHandler: invalid playback handler");this.policyHandler=e}else this.policyHandler=this.defaultPolicyHandler;G(this.policyHandler,this.policyHandler.setPlaybackMode,this.getPlaybackMode())}setPlaybackUrl(e){this.playbackUrl=e}setPlayhead(e){this.playhead=e}setReportsManager(e){this.reportsManager=e}setResultCode(e){this.resultCode=e}setState(e){this.sessionState=e}shutdown(){C.d(E.DEBUG_LIFECYCLE,"Session shutdown"),this.setState(ve.SHUTDOWN),this.onPlaybackStop(),C.trace("sessionEnd")}signalActionTrackingEvent(e){let t=this.currentAdvert;if(t&&t.isActive()&&!t.isFiller()&&!B(e)){C.trace("actionEvent "+e);let r=t.getTrackingReports(e),i=new W(this.getPlayhead(),t.getStart(),t.getLinearCreative().getAssetUri(),t.getMacroSubstitutions());r.length>0&&this.reportsManager.fireBeacons(r,i),"closeLinear"!==e&&this.reportsManager.raiseTrackingCallback(e,this)}}signalNonLinearTrackingEvent(e){let t=this.currentAdvert;if(t&&t.isActive()&&!t.isFiller()&&!B(e)){C.trace("nonlinearTrackingEvent "+e);let r=t.getTrackingReportLinear(e);if(r){let e=new W(this.getPlayhead(),t.getStart(),t.getLinearCreative().getAssetUri(),t.getMacroSubstitutions());this.reportsManager.fireBeacon(r,e)}this.reportsManager.raiseTrackingCallback(e,this)}}signalTimelineTrackingEvents(e){let t=this.currentAdvert;if(t&&t.isActive()&&!t.isFiller()){let r=new W(this.getPlayhead(),t.getStart(),t.getLinearCreative().getAssetUri(),t.getMacroSubstitutions()),i=[];for(let[n,a]of t.getTrackingSchedule())if(e+g.EVENT_CUEPOINT_TOL>=n){C.d(E.DEBUG_REPORTS,"Tracking schedule entry retrieved: "+a),i.push(n);let e=t.getTrackingReportLinear(a);e&&this.reportsManager.fireBeacon(e,r);let s=-1!==a.indexOf("progress")?"progress":a;C.trace("timelineEvent "+s),this.reportsManager.raiseTrackingCallback(s,this)}this.removeKeysFromTrackingSchedule(i)}}signalTrackingEvent(e,t){let r=this.currentAdvert;if(r&&r.isActive()&&!r.isFiller()&&!B(e)){if(C.trace("trackingEvent"+e),t){let e=new W(this.getPlayhead(),r.getStart(),r.getLinearCreative().getAssetUri(),r.getMacroSubstitutions());this.reportsManager.fireBeacon(t,e)}this.reportsManager.raiseTrackingCallback(e,this)}}suppressAnalytics(e){if(this.reportsManager.suppressReports(e),!e&&this.currentAdBreak){let e=this.currentAdBreak.getTrackingReport("breakStart",!0);this.getReportsManager().fireBeacon(e,new W(this.getPlayhead()))}}willSeekTo(e){let t=this.policyHandler?G(this.policyHandler,this.policyHandler.willSeekTo,e,this.linearAdBreaks,this.getPlayhead()):e;return null===t&&(t=this.defaultPolicyHandler.willSeekTo(e,this.linearAdBreaks,this.getPlayhead())),t}}class De{constructor(e){this.requestTimeout=e&&e.requestTimeout?e.requestTimeout:g.REQUEST_TIMEOUT,this.resourceTimeout=e&&e.resourceTimeout?e.resourceTimeout:g.REQUEST_TIMEOUT,this.userAgent=e?e.userAgent:"",this.prefetchResources=!!e&&e.prefetchResources,this.fireHistoricalBeacons=!e||e.fireHistoricalBeacons,this.eventCategories=e?e.eventCategories:0,this.allowCorsForAnalytics=!!e&&e.allowCorsForAnalytics,this.setCustomHttpHeaders(e?e.customHttpHeaders:new Map),this.useHttps=!!e&&e.useHttps,this.consecutiveBreakTolerance=e?e.consecutiveBreakTolerance:0,this.token=e?e.token:Math.floor(1e8*Math.random())}excludeFromSuppression(e){this.eventCategories=e}getCustomHttpHeaders(){return this.customHttpHeaders}getExcludedCategories(){return this.eventCategories}getFireHistoricalBeacons(){return this.fireHistoricalBeacons}getPrefetchResources(){return this.prefetchResources}getRequestTimeout(){return this.requestTimeout}getResourceTimeout(){return this.resourceTimeout}getUserAgent(){return this.userAgent}getToken(){return this.token}getAllowCorsForAnalytics(){return this.allowCorsForAnalytics}getApplyEncryptedTracking(){return this.useHttps}getConsecutiveBreakTolerance(){return this.consecutiveBreakTolerance}setAllowCorsForAnalytics(e){this.allowCorsForAnalytics=e}setApplyEncryptedTracking(e){this.useHttps=e}setConsecutiveBreakTolerance(e){this.consecutiveBreakTolerance=e}setCustomHttpHeaders(e){if(e)for(let[t]of e)"USER-AGENT"===t.toUpperCase()&&(C.w("SessionProperties: 'User-Agent' ignored"),e.delete(t));else e=new Map;this.customHttpHeaders=e}setFireHistoricalBeacons(e){this.fireHistoricalBeacons=e}setPrefetchResources(e){this.prefetchResources=e}setRequestTimeout(e){this.requestTimeout=e}setResourceTimeout(e){this.resourceTimeout=e}setToken(e){this.token=e}setUserAgent(e){this.userAgent=e}toString(){return"Session Properties:\n  allowCorsForAnalytics: "+this.allowCorsForAnalytics+"\n  applyEncryptedTracking: "+this.useHttps+"\n  consecutiveBreakTolerance: "+this.consecutiveBreakTolerance+"\n  customHttpHeaders: "+ie(this.customHttpHeaders)+"\n  eventCategories: "+this.eventCategories+"\n  fireHistoricalBeacons: "+this.fireHistoricalBeacons+"\n  prefetchResources: "+this.prefetchResources+"\n  requestTimeout: "+this.requestTimeout+"\n  resourceTimeout: "+this.resourceTimeout+"\n  userAgent: "+this.userAgent+"\n  token: "+this.token}}function Ce(e){if(B(e))return null;let t=null;try{t=new URL(e)}catch(e){return null}if(!t)return null;try{decodeURI(t.pathname)}catch(e){return null}return t}class Re{constructor(e,t,r){this.url=e,this.opts=t,this.requestTimeout=r||g.REQUEST_TIMEOUT}static get(e,t,r,i,n){return Re.handleGet(e,t,r,i,n)}static handleGet(e,t,r,i,n){if(C.d(E.DEBUG_HTTP_REQUESTS,"Requesting "+e),n instanceof Map){let t=Ce(e);if(t){for(let[e,r]of n)t.searchParams.set(e,r);e=t.toString()}}if(i){let e=new Headers;for(let[t,r]of i)e.set(t,r);t.headers=e}return new Re(e,t,r).executeGet()}async executeGet(){let e={},t=await function(e,t,r){let i=null;const n=new Promise((e=>{i=setTimeout(e,r,{timeout:!0,error:"timeout",statusText:"Connection timeout",status:ye})}));return Promise.race([n,fetch(e,t)]).then((t=>(t.timeout?C.d(E.DEBUG_HTTP_REQUESTS,"Request for "+e+" timed out"):!t.ok&&t.status&&C.d(E.DEBUG_HTTP_REQUESTS,"Request for "+e+" failed. Status: "+t.status+". Message: "+t.statusText),t))).catch((t=>{C.d(E.DEBUG_HTTP_REQUESTS,"Request for "+e+" failed. Exception: "+t);let r=Ee;return("ERR_INVALID_URL"===t.code||t.cause&&"ERR_INVALID_URL"===t.cause.code)&&(r=Te),{error:t,statusText:t.message,status:r}})).finally((()=>{clearTimeout(i)}))}(this.url,this.opts,this.requestTimeout);if(e.ok=t.ok,e.headers=t.headers,e.status=t.status,e.statusText=t.statusText,e.timeout=t.timeout,e.url=t.url,e.error=t.error,e.type=t.type,e.timeout&&C.w("Request to "+(e.url||this.url)+" timed out"),e.error&&C.w("Request to "+(e.url||this.url)+" failed: "+e.error),t.ok)try{e.body=await t.text()}catch(t){return e.ok=!1,e.status=Ee,e.statusText=t.message,e.error=t,e}return e.status&&C.d(E.DEBUG_HTTP_REQUESTS,"HTTP response: "+e.status+" ("+this.url+")"),e}}const Pe={STATIC:0,HTML:1,IFRAME:2,UNKNOWN:3};class _e extends R{constructor(e,t,r,i){switch(super(),e){case Pe.STATIC:this.stringData=t,this.creativeType=r,this.encoded=!1,this.type=e;break;case Pe.IFRAME:this.stringData=t,this.creativeType=null,this.type=e,this.encoded=!1;break;case Pe.HTML:this.stringData=t,this.creativeType=null,this.type=e,this.encoded=i}this.byteData=null}getByteData(){return this.byteData}getCreativeType(){return this.creativeType}getResourceType(){return this.type}getStringData(){return this.stringData}isEncoded(){return this.encoded}isValid(){switch(this.type){case Pe.STATIC:if(!this.creativeType||""===this.creativeType)return!1;break;case Pe.HTML:if(!this.stringData||""===this.stringData)return!1;break;case Pe.IFRAME:try{new URL(this.stringData)}catch(e){return!1}break;default:return!1}return!0}prefetch(e){this.byteData||this.type===Pe.HTML||this.type===Pe.UNKNOWN||Re.get(this.stringData,{},e).then((e=>{e.ok?this.byteData=e.body:C.e("Resource prefetch request failed: "+this.stringData+", status: "+e.status+", error:"+e.statusText)}))}toString(){let e="";switch(this.type){case Pe.STATIC:e+="\nStatic resource (",e+=this.creativeType,e+="): ",e+=this.stringData;break;case Pe.HTML:e+="\nHTML resource (",e+=this.encoded?"encoded): ":"unencoded): ",e+=function(e){if(!e)return"";try{let t=0,r="",i=null,n=0;for(let a=0;a<e.length;++a){if(i=e[a],"<"===i){let i=e[a+1];"/"===i&&t--,r=M(r,n,t),"/"!==i&&"!"!==i&&t++}r+=i,n=i}if(0===t)return r}catch(e){}return e}(this.stringData);break;case Pe.IFRAME:e+="\niFrame resource: ",e+=this.stringData}return e}}class Le{constructor(e,t){this.required=e,this.companions=t||[]}containsCreative(e){return-1!==this.companions.indexOf(e)}getCompanions(){return Object.assign([],this.companions)}getCompanionsByType(e){let t=[];for(let r of this.companions)(r.getResource(e)||e===Pe.UNKNOWN&&0===r.getResources().size)&&t.push(r);return t}getRequired(){return this.required}prefetchResources(e){for(let t of this.companions)t.prefetchResources(e)}toString(){let e="";if(this.companions.length>0){e="\n--- Companion Ads required:",e+=this.required;for(let t of this.companions)e+=N(t)}return e}}class Ne extends oe{constructor(e,t,r,i,n){super(e),this.resources=new Map,this.visible=!1,this.properties=e.properties?e.properties:[],this.altText=e.altText,this.trackingMap=i||new Map,this.videoClicks=t||new le,this.broker=n,this.companionExtensions=e.companionExtensions;for(let e of r)this.resources.set(e.getResourceType(),e)}getAltText(){return this.altText}getClickThroughUrl(){return this.videoClicks.getClickThroughUrl()}getClickTrackingUrls(){return this.videoClicks.getClickTrackingUrls()}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t;return null}getResource(e){return this.resources.has(e)?this.resources.get(e):null}getResources(){return this.resources}getTrackingMap(){return this.trackingMap}isValid(){return ce(this.properties)&&this.resources.size>0||this.trackingMap.size>0}isVisible(){return this.visible}onClickThrough(){if(!this.isVisible())return void C.w("Companion is not visible");let e=he(this.videoClicks.getClickTrackingUrls(),"CompanionClickTracking");e&&this.broker.fireTrackingReportForCreative(e,this)}onTrackingEvent(e){}prefetchResources(e){ue(this.resources,e)}setVisible(e){if(this.visible!==e&&(this.visible=e,e)){let e="creativeView",t=this.trackingMap.get(e);t&&this.broker.fireTrackingReportForCreative(t,this)}}toString(){let e="\n--- Companion ---\n";for(let t of this.properties)e+="\n"+N(t);e+=N("\nAlt Text: "+this.altText),e+=N(this.videoClicks);for(let[t,r]of this.resources)e+=N(t+":"+r);return e+=super.toString(),e}}class Be{constructor(e,t){this.trackingMap=e||new Map,this.nonLinearCreatives=t||[]}allNonLinearsAreInactive(){for(let e of this.nonLinearCreatives)if(e.isVisible())return!1;return!0}containsCreative(e){return-1!==this.nonLinearCreatives.indexOf(e)}getNonLinearCreatives(){return Object.assign([],this.nonLinearCreatives)}getNonLinearCreativesByType(e){let t=[];for(let r of this.nonLinearCreatives)r.getResource(e)&&t.push(r);return t}getTrackingMap(){return this.trackingMap}getTrackingReport(e){if(!this.allNonLinearsAreInactive())return this.trackingMap.get(e)}postParse(){for(let e of this.nonLinearCreatives)e.setTrackingReports(this.trackingMap)}prefetchResources(e){for(let t of this.nonLinearCreatives)t.prefetchResources(e)}toString(){if(this.nonLinearCreatives.length>0){let e="\n--- NonLinear Ads:";if(this.trackingMap.size>0){e+="\n  ** Tracking events - ";for(let[t,r]of this.trackingMap)e+=N("\n "+t+":"+r)}for(let t of this.nonLinearCreatives)e+=N(t);return e}return""}}const Me=Object.freeze({VIEWABLE:0,NOT_VIEWABLE:1,VIEW_UNDETERMINED:2});class Ue extends R{onViewableEvent(e){throw new Error("Function must be overridden")}onErrorEvent(e){throw new Error("Function must be overridden")}onImpressionEvent(){throw new Error("Function must be overridden")}}class Oe{constructor(e,t){this.payload=e,this.source=t||null}getPayload(){return this.payload}getSource(){return this.source}}class Fe extends R{onVerificationEvent(e,t){throw new Error("Function must be overridden")}}class xe extends Fe{constructor(e){super(),this.vendor=e.verificationVendor,this.resources=e.verificationResources,this.verificationEvents=e.verificationEvents,this.parameters=e.verificationParameters,this.listeners=[],this.broker=null}getAdVerificationEvents(){return this.verificationEvents}getParameters(){return this.parameters}getResources(){return Object.assign([],this.resources)}getVendor(){return this.vendor}isValid(){return!!(this.vendor&&this.resources&&this.resources.length>0)}onVerificationEvent(e,t){if(0===this.listeners.length)return void C.w("No event listeners - can't signal VerificationEvent");let r=Number.isInteger(t);t&&!r&&C.w("onVerificationEvent: reason should be an integer.");let i=this.verificationEvents.get(e);if(i){if(r&&t)for(let e of this.listeners)e(new Oe(t));this.broker.fireTrackingReport(i)}}postParse(e,t){this.broker=e,t?this.listeners.push(t):C.e("postParse: callback was null")}toString(){let e="";if(this.verificationEvents.size>0){e+="\n - Verification events:";for(let[t,r]of this.verificationEvents)e+="\n "+t+"="+r}let t="\n--- Ad Verification:\n - Vendor:";t+=this.vendor,t+="\n - Resources:";for(let e of this.resources)t+="\n"+N(e);return t+=e,t+="\n - VerificationParameters:",t+=this.parameters,t}}class Ve extends R{constructor(e,t,r){super(),this.identifier=e,this.creativeIdentifier=t,this.adSystem=r,this.child=null}getAdSystem(){return this.adSystem}getCreativeIdentifier(){return this.creativeIdentifier}getIdentifier(){return this.identifier}getLineage(){return this.child}isValid(){let e=this;do{if(!e.identifier||""===e.identifier)return!1;e=e.getLineage()}while(e);return!0}setChild(e){this.child=e}}class Ge extends R{constructor(e,t,r){super(),this.properties=e||[],this.altText=t,this.resource=r}getAltText(){return this.altText}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t;return null}getResource(){return this.resource}isValid(){return!(!ce(this.properties)||B(this.altText)&&!this.resource)}}class He extends se{constructor(e,t,r,i,n){super(),this.resources=new Map,this.visible=!1,this.properties=e||[],this.videoClicks=r||new le,this.clickFallbackImages=i||[],this.broker=n;for(let e of t)this.resources.set(e.getResourceType(),e)}getClickFallbackImages(){return Object.assign([],this.clickFallbackImages)}getClickThroughUrl(){return this.videoClicks.getClickThroughUrl()}getClickTrackingUrls(){return this.videoClicks.getClickTrackingUrls()}isVisible(){return this.visible}getViewTrackingUrls(){return this.videoClicks.getCustomClicks()}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t}getResource(e){return this.resources.get(e)}getResources(){return this.resources}isValid(){let e=null,t=null,r=null,i=null,n=null;for(let a of this.properties)B(a.getValue())||("program"===a.getName()&&(e=a),"width"===a.getName()&&(t=a),"height"===a.getName()&&(r=a),"xPosition"===a.getName()&&(i=a),"yPosition"===a.getName()&&(n=a));return null!==t&&null!==r&&null!==e&&null!==i&&null!==n&&this.resources.size>0}onClickThrough(){if(this.isVisible()){let e=this.videoClicks.getClickTrackingUrls();if(e.length>0){let t=he(e,"IconClickTracking");t&&this.broker.fireTrackingReportForIcon(t,this)}}}onTrackingEvent(e){}setVisible(e){if(this.visible!==e&&(this.visible=e,this.visible&&this.videoClicks.getCustomClicks().length>0)){let e=new V("IconViewTracking",this.videoClicks.getCustomClicks());e&&this.broker.fireTrackingReportForIcon(e,this)}}toString(){let e="";e+=this.videoClicks.toString(),this.properties.length>0&&(e+="\nIcon Properties: ");for(let t of this.properties)e+="\n"+N(t);this.resources.length>0&&(e+="\nIcon Resource(s): ");for(let[t,r]of this.resources)e+=N(t+":"+r);this.clickFallbackImages.length>0&&(e+="\nIcon Click Fallback Images: ");for(let t of this.clickFallbackImages)e+="\n"+N(t);return e}}class Ye extends oe{constructor(e,t,r,i){if(super(e),this.resources=new Map,this.visible=!1,this.videoClicks=t||new le("",null,null),this.properties=e.properties?e.properties:[],this.broker=i,this.trackingMap=new Map,r)for(let e of r)this.resources.set(e.getResourceType(),e)}getApiFramework(){let e=this.getProperty("apiFramework");return e?e.getValue():null}getClickThroughUrl(){return this.videoClicks.getClickThroughUrl()}getClickTrackingUrls(){return this.videoClicks.getClickTrackingUrls()}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t;return null}getResource(e){return this.resources.get(e)}getResources(){return this.resources}getTrackingReports(){return this.trackingMap}isValid(){return ce(this.properties)&&this.resources.size>0}isVisible(){return this.visible}onClickThrough(){if(!this.visible)return void C.w("Nonlinear creative is not visible");let e=this.videoClicks.getClickTrackingUrls();if(e.length>0){let t=he(e,"NonLinearClickTracking");t&&this.broker.fireTrackingReportForCreative(t,this)}}onTrackingEvent(e){if(!this.visible)return void C.w("Nonlinear creative is not visible");if(V.isValidVisibleEvent(e))return void C.w("Use method setVisible() to signal event: "+e);if(V.isValidPlayerOperationEvent(e)&&!this.isNonLinear)return void C.w("Use PlaybackEventHandler functions to signal event: "+e);if(!V.isValidNonLinearEvent(e))return void C.w("Invalid tracking event: "+e);let t=this.trackingMap.get(e);t&&this.broker.fireTrackingReportForCreative(t,this),"acceptInvitation"===e&&this.broker.raiseTrackingCallbackForCreative(e,this)}prefetchResources(e){ue(this.resources,e)}setTrackingReports(e){this.trackingMap=e}setVisible(e){if(this.visible!==e){this.visible=e;let t=null;t=e?this.trackingMap.get("creativeView"):this.trackingMap.get("close"),t&&this.broker.fireTrackingReportForCreative(t,this)}}toString(){let e="\n--- NonLinear Creative:";e+=N(this.videoClicks),this.properties.length>0&&(e+="\n - NonLinear Properties: ");for(let t of this.properties)e+="\n"+N(t);this.resources.size>0&&(e+="\n - NonLinear Resource(s): ");for(let[t,r]of this.resources)e+=N(t+":"+r);return e+=super.toString(),e}}class je extends se{constructor(e,t,r,i){super(),this.source=e,this.properties=t||[],this.broker=r,this.adParameters=null,this.advertDuration=0,this.tracking=null,this.offset=0,this.visible=!1,this.nonLinearCreatives=[],this.isSIMID()&&(this.tracking=i)}getAdParameters(){return this.adParameters}getAdvertDuration(){return this.advertDuration}getNonLinearCreatives(){return this.nonLinearCreatives}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t;return null}getSource(){return this.source}getTracking(){return this.tracking}initialise(e,t,r){this.adParameters=e,this.advertDuration=t,this.nonLinearCreatives=[];let i=this.getProperty("apiFramework");if(i){let e=i.getValue();for(let t of r){let r=t.getProperty("apiFramework");r&&r.getValue()===e&&this.nonLinearCreatives.push(t)}}}isSIMID(){for(const e of this.properties)if("apiFramework"===e.getName()&&"SIMID"===e.getValue())return!0;return!1}isValid(){return!B(this.source)}isVisible(){return this.visible}onClickThrough(){}onTrackingEvent(e){this.isVisible()?Ce(e)?this.isSIMID()&&this.broker.fireTrackingReport(new V("custom",[e])):C.w("Invalid custom tracker URL"):C.w("Warning: InteractiveCreative is not visible")}setTracking(e){this.tracking=e}setVisible(e){this.visible!==e&&(this.visible=e,this.visible&&this.isSIMID()&&this.tracking&&this.broker.fireTrackingReport(this.tracking))}toString(){let e="InteractiveCreative source: "+this.source;if(this.properties.length>0){e+="\nProperties:";for(let t of this.properties)e+=N(t)}return this.tracking&&(e+="\nTracking event:",e+=N("\n "+this.tracking)),e}}class qe extends Ue{static buildMapString(e){let t="";if(e.size>0)for(let[r,i]of e)t+="\n "+r+"="+i}constructor(e){super(),this.startMillis=0,this.active=!1,this.identifier=e.identifier,this.mediaIdentifier=e.mediaIdentifier,this.properties=e.properties?e.properties:[],this.linearCreative=e.linearCreative,this.nonLinearAds=e.nonLinearAds?e.nonLinearAds:new Be,this.companionAds=e.companionAds?e.companionAds:new Le,this.impressions=e.impressions,this.errors=e.errors,this.viewableImpressions=e.viewableImpressions?e.viewableImpressions:new Map,this.adVerifications=e.adVerifications?e.adVerifications:[],this.sequence=e.sequence,this.adType=e.adType,this.nonLinear=e.nonLinear,this.filler=e.filler,this.trackingSchedule=new Map,e.topLevelWrapper&&e.topLevelWrapper.isValid()?this.wrapper=e.topLevelWrapper:this.wrapper=null,this.extensions=e.extensions,this.broker=null,this.macroSubstitutions=new Map,this.earlyReturn=!1}addMacroSubstitution(e,t){this.macroSubstitutions.set(e,t)}addTrackingScheduleEntry(e,t){let r=t*this.linearCreative.getDuration();for(;this.trackingSchedule.has(r);)++r;this.trackingSchedule.set(r,e)}adjustForEarlyReturn(e){let t=e-this.startMillis;this.setDuration(t);let r=this.getTrackingSchedule();for(let e of r.keys())e>t&&this.removeFromTrackingSchedule(e);this.earlyReturn=!0}clearTrackingSchedule(){this.trackingSchedule.clear()}containsCreative(e){return e instanceof de?e===this.linearCreative:e instanceof Ye?this.nonLinearAds.containsCreative(e):e instanceof Ne&&this.companionAds.containsCreative(e)}containsIcon(e){for(let t of this.linearCreative.getIndustryIcons())if(t===e)return!0;return!1}getAdVerifications(){return Object.assign([],this.adVerifications)}getAdType(){return this.adType}getCompanionAds(){return this.companionAds}getCompanionAdsByType(e){return this.companionAds.getCompanionsByType(e)}getCompanionRequired(){return this.companionAds.getRequired()}getDuration(){return this.nonLinear?0:this.linearCreative.getDuration()}getEnd(){return this.startMillis+this.linearCreative.getDuration()}getExtensions(){return this.extensions}getIdentifier(){return this.identifier}getImpressions(e){if(!this.impressions)return null;let t=this.impressions.copy();return e&&(this.impressions=null),t}getIndustryIcons(){return this.linearCreative.getIndustryIcons()}getInteractiveCreative(){return this.linearCreative.getInteractiveCreative()}isTruncated(){return this.earlyReturn}getLineage(){return this.wrapper}getLinearCreative(){return this.linearCreative}getMacroSubstitutions(){return this.macroSubstitutions}getMediaIdentifier(){return this.mediaIdentifier}getNonLinearAds(){return this.nonLinearAds}getNonLinearCreativesByType(e){return this.nonLinearAds.getNonLinearCreativesByType(e)}getProperties(){return Object.assign([],this.properties)}getProperty(e){for(let t of this.properties)if(t.getName()===e)return t;return null}getProportion(e){let t=0,r=e.split("-");if(2!==r.length)C.w("Badly formed progress event in VAST/VMAP: "+e),t=-1;else if(-1!==r[1].indexOf("%")){let e=parseFloat(r[1].substring(0,r[1].length-1));t=e?e/100:-1,t<0&&C.w("Badly formed percentage string in VAST/VMAP: "+r[1])}else t=parseFloat(O(r[1],-1)/this.linearCreative.getDuration());return t}getRemainingTime(e){let t=this.startMillis+this.linearCreative.getDuration(),r=Math.min(t-e,this.linearCreative.getDuration());return Math.max(0,r)}getSequence(){return this.sequence}getSkipOffset(){return this.linearCreative.getSkipOffset()}getStart(){return this.startMillis}getTrackingReports(e){let t=[],r=this.linearCreative.getTrackingReport(e);return r&&t.push(r),r=this.nonLinearAds.getTrackingReport(e),r&&t.push(r),t}getTrackingReportLinear(e){if(this.linearCreative)return this.linearCreative.getTrackingReport(e)}getTrackingReportNonLinear(e){if(this.nonLinearAds)return this.nonLinearAds.getTrackingReport(e)}getTrackingSchedule(){return this.trackingSchedule}getViewableImpressions(){return this.viewableImpressions}isActive(){return this.active}isFiller(){return this.filler}isNonLinear(){return this.nonLinear}isValid(){return this.nonLinear?!this.linearCreative:!B(this.mediaIdentifier)&&null!==this.linearCreative}onErrorEvent(e){this.errors&&(e&&this.addMacroSubstitution("ERRORCODE",e.toString()),this.broker.fireTrackingReport(this.errors))}onImpressionEvent(){if(!this.nonLinear)return void C.w("Warning: Advert is not nonlinear - can't signal ImpressionEvent");let e=this.getImpressions(!1);e&&this.broker.fireTrackingReport(e)}onViewableEvent(e){let t=qe.viewableEventMap.get(e),r=this.viewableImpressions.get(t);r&&this.broker.fireTrackingReport(r)}postParse(e){if(this.broker=e,!this.nonLinear){this.addTrackingScheduleEntry("loaded",0),this.addTrackingScheduleEntry("start",0),this.addTrackingScheduleEntry("firstQuartile",.25),this.addTrackingScheduleEntry("midpoint",.5),this.addTrackingScheduleEntry("thirdQuartile",.75),this.addTrackingScheduleEntry("complete",1);for(let[e,t]of this.linearCreative.getTrackingMap())if(-1!==e.indexOf("progress")){let r=this.getProportion(e,t);r>=0&&this.addTrackingScheduleEntry(e,r)}this.trackingSchedule=new Map(Array.from(this.trackingSchedule).sort(((e,t)=>e[0]-t[0])))}for(let e of this.adVerifications)e.postParse(this.broker,(e=>{this.addMacroSubstitution("REASON",e.getPayload())}));this.nonLinearAds.postParse(),this.linearCreative&&this.linearCreative.initialiseInteractiveCreative(this.nonLinearAds.getNonLinearCreatives()),this.prefetchResources(e.getSessionProperties()),this.active=!0}prefetchResources(e){e.getPrefetchResources()&&(this.nonLinearAds.prefetchResources(e.getResourceTimeout()),this.companionAds.prefetchResources(e.getResourceTimeout()))}removeFromTrackingSchedule(e){this.trackingSchedule.delete(e)}removeMacroSubstitution(e){this.macroSubstitutions.delete(e)}removeTrackingSchedule(){this.trackingSchedule.clear()}setDuration(e){this.linearCreative&&this.linearCreative.setDuration(e)}setInactive(){this.active=!1}setStart(e){this.startMillis=e}toString(){if(this.isFiller())return"\n--- Advert ---\n - Filler duration: "+this.getDuration();let e="\n* Impression(s):";if(this.impressions)for(let t of this.impressions.getTrackingUrls())e+=t;else e+="NONE";let t="\n* Viewable Impression(s):";t+=qe.buildMapString(this.viewableImpressions);let r="\n * Ad Verification(s):";r+=N(this.adVerifications);let i="\n Error(s):";if(this.errors)for(let e of this.errors.getTrackingUrls())i+=N("\n - "+e);else i+="NONE";let n="\n--- Advert ---\n ID:";n+=this.mediaIdentifier,n+="(",n+=this.identifier,n+=")",n+=" duration:",n+=this.getDuration(),n+=" sequence:",n+=this.sequence,n+=" adtype:",n+=this.adType;for(let e of this.properties)n+="\n"+N(e);return this.extensions&&(n+="\n * Extensions:",n+="\n"+N(this.getExtensions())),this.wrapper&&(n+="\n * Lineage -\n",n+=N(this.wrapper)),n+=N(e),n+=N(t),n+=N(r),n+=N(i),this.nonLinear||(n+=N(this.linearCreative)),n+=N(this.nonLinearAds),n+=N(this.companionAds),n}}qe.viewableEventMap=new Map,qe.viewableEventMap.set(Me.VIEWABLE,"Viewable"),qe.viewableEventMap.set(Me.NOT_VIEWABLE,"NotViewable"),qe.viewableEventMap.set(Me.VIEW_UNDETERMINED,"ViewUndetermined");const We=Object.freeze({LINEAR:0,NONLINEAR:1,DISPLAY:2});function Ke(e,t,r){let i=e?e.toLowerCase():"";return"preroll"===i||"midroll"===i||"postroll"===i?i:0===t?"preroll":r===We.LINEAR?"midroll":"unknown"}class ze extends P{constructor(e,t,r,i,n,a,s,o){super(),this.startMillis=e,this.duration=t,this.trackingMap=i||new Map,this.breakType=ze.getBreakTypeFromString(n),this.position=Ke(r,e,this.breakType),this.identifier=a,this.extensions=s,this.broker=null,this.adverts=[],this.adTagUri=o||null,this.breakType!==We.LINEAR&&-1===this.startMillis&&(this.startMillis=0)}static getBreakTypeFromString(e){return _(e,"nonlinear")?We.NONLINEAR:_(e,"display")?We.DISPLAY:We.LINEAR}adjustForEarlyReturn(e){let t=this.getAdvertFromPlayhead(e);if(t){let r=t.getStart()===e;return r||t.adjustForEarlyReturn(e),this.removeAdvertsFrom(t,r),this.setDuration(e-this.startMillis),!0}return!1}getAdvertForCreative(e){for(let t of this.adverts)if(t.containsCreative(e))return t;return null}getAdvertFromPlayhead(e){for(let t of this.adverts)if(t.getStart()<=e&&e<t.getEnd())return t;return null}getAdvertFromIdentifier(e){for(let t of this.adverts)if(t.getMediaIdentifier()===e)return t;return null}getAdverts(){return Object.assign([],this.adverts)}getAdTagUri(){return this.adTagUri}getBreakTypeAsString(){switch(this.breakType){case We.NONLINEAR:return"nonlinear";case We.DISPLAY:return"display";default:return"linear"}}getType(){return this.breakType}getDuration(){return this.duration}getExtensions(){return this.extensions}getIdentifier(){return this.identifier}isPlaceholder(){return null!==this.adTagUri}getPosition(){return this.position}getRemainingTime(e){let t=0;if(this.adverts.length>0){let r=this.adverts[0].getStart()+this.getDuration();t=Math.min(r-e,this.getDuration())}return Math.max(0,t)}getStart(){return this.startMillis}getTrackingMap(){return this.trackingMap}getTrackingReport(e,t){let r=this.trackingMap.get(e);return r&&t&&this.trackingMap.delete(e),r}isActive(){if(!this.adverts)return!1;for(let e of this.adverts)if(e.isActive())return!0;return!1}isNonLinear(){return this.breakType!==We.LINEAR}isValid(){return this.breakType===We.LINEAR&&-1===this.startMillis?(C.e("Linear AdBreak is invalid - start position is unknown"),!1):this.adverts.length>0||this.trackingMap.size>0||this.isPlaceholder()}mergePlaceholderAdverts(e){this.setAdverts(e.getAdverts()),this.adTagUri=null}onNonLinearTrackingEvent(e){if(!this.isNonLinear())return void C.w("Warning: AdBreak is not nonlinear - can't signal NonLinearTrackingEvent");let t=this.getTrackingReport(e,!1);t&&this.broker.fireTrackingReport(t)}postParse(e){this.broker=e;let t=this.startMillis;for(let r of this.adverts)r.setStart(t),t+=r.getDuration(),r.postParse(e)}removeAdvertsFrom(e,t){for(let r=0;r<this.adverts.length;++r)if(this.adverts[r]===e){let e=!0===t?r:r+1;return void this.adverts.splice(e,this.adverts.length-e)}}setAdverts(e){Array.prototype.push.apply(this.adverts,e);let t=this.startMillis;for(let e of this.adverts)e.setStart(t),t+=e.getDuration()}setAdvertsInactivePriorTo(e){for(let t of this.adverts){if(!(t.getEnd()<e))return!1;t.setInactive()}return!0}setDuration(e){this.duration=e}setInactive(){if(!this.isNonLinear()){for(let e of this.adverts)e.setInactive();this.trackingMap.clear()}}toString(){return`\n--- AdBreak ---\n breakType:${this.getBreakTypeAsString()} start:${this.startMillis} milliseconds, duration:${this.duration}, position:${this.position}\nNumber of adverts:${this.adverts.length}`}}const Xe=2*g.MAX_CADENCE;class Qe extends Ie{constructor(e){super(e),this.didSeek=!1,this.duration=0}getDuration(){return this.duration}initialiseFromAnalyticData(e,t){this.setPlaybackUrl(t+e.getHostNode()+e.getHostSuffix()),this.setDuration(e.getStreamDuration()),this.setIdentifier(e.getSessionIdentifier()),Array.prototype.push.apply(this.linearAdBreaks,e.getLinearAdBreaks()),Array.prototype.push.apply(this.nonLinearAdBreaks,e.getNonLinearAdBreaks()),Array.prototype.push.apply(this.displayAdBreaks,e.getDisplayAdBreaks())}mergePlaceholderBreaks(e){let t=!0;for(const r of this.linearAdBreaks){if(r.isPlaceholder())for(let t of e.getLinearAdBreaks())r.getIdentifier()===t.getIdentifier()&&r.getStart()===t.getStart()&&r.mergePlaceholderAdverts(t);r.isPlaceholder()&&(C.e("Placeholder AdBreak with id "+r.getIdentifier()+" not found"),t=!1)}return t}onAdvertBreakStart(e){if(!this.getCurrentAdBreak()&&(this.clearTrackingErrors(),this.setCurrentAdBreak(e),C.trace("adbreakStart"),this.getReportsManager().raiseAdBreakCallback("start",this.getCurrentAdBreak(),this),e&&!this.reportsManager.shouldSuppress("breakStart"))){let t=e.getTrackingReport("breakStart",!0);this.getReportsManager().fireBeacon(t,new W(this.getPlayhead()))}}onAdvertBreakEnd(){let e=this.getCurrentAdBreak();if(e&&!this.reportsManager.shouldSuppress("breakEnd")){let t=e.getTrackingReport("breakEnd",!0);this.getReportsManager().fireBeacon(t,new W(this.getPlayhead()))}C.trace("adbreakEnd"),this.getReportsManager().raiseAdBreakCallback("end",null,this),this.trackingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.TRACKING_ERROR,this),this.setCurrentAdBreak(null)}onAdvertEnd(){let e=this.getCurrentAdvert();e&&(e.isActive()&&this.signalTimelineTrackingEvents(e.getStart()+e.getDuration()),e.setInactive(),C.trace("advertEnd"),this.getReportsManager().raiseAdvertCallback("end",null,this),this.setCurrentAdvert(null))}onAdvertStart(e){e&&!this.getCurrentAdvert()&&(this.setCurrentAdvert(e),super.onAdvertStart(e),this.getReportsManager().reportsSuppressed()&&e.removeTrackingSchedule(),C.trace("advertStart"),this.getReportsManager().raiseAdvertCallback("start",e,this),e&&e.isActive()&&(this.fireImpressionReport(),this.signalTimelineTrackingEvents(g.ADVERT_START_TIMESLOT)))}handlePostSeek(e){let t=this.getLastPlayed();C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: "+t+" -> "+e);let r=e-t;r>=0&&r<=Xe?C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: ignoring interval "+r+"ms"):this.getCurrentAdBreak()?this.handlePostSeekForAdBreak(t,e):this.handlePostSeekForContent(e)}handlePostSeekForContent(e){let t=this.adBreakForPlayhead(e);if(t){C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: CONTENT -> BREAK");let r=t.getAdvertFromPlayhead(e);r&&e-r.getStart()>Xe&&r.setInactive()}else C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: within content")}handlePostSeekForAdBreak(e,t){let r=this.adBreakForPlayhead(t);if(r)if(r!==this.getCurrentAdBreak()){C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: BREAK -> BREAK");let i=this.getCurrentAdBreak().getAdvertFromPlayhead(e);i&&i.setInactive();let n=r.getAdvertFromPlayhead(t);n&&t-n.getStart()>Xe&&n.setInactive()}else this.handlePostSeekForAdvertToAdvert(t);else{C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: BREAK -> CONTENT");let t=this.getCurrentAdBreak().getAdvertFromPlayhead(e);t&&t.setInactive()}}handlePostSeekForAdvertToAdvert(e){let t=this.getCurrentAdBreak().getAdvertFromPlayhead(e);t&&(this.getCurrentAdvert().setInactive(),t!==this.getCurrentAdvert()?(C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: ADVERT -> ADVERT"),e-t.getStart()>Xe&&t.setInactive()):C.d(E.DEBUG_STATE_MACHINE,"handlePostSeek: with advert"))}handleHeartbeat(e){C.d(E.DEBUG_STATE_MACHINE,"handleHeartbeat (playhead: "+e+")"),this.didSeek&&(this.handlePostSeek(e),this.didSeek=!1);let t=this.getLastPlayed();this.setPlayhead(e),this.getCurrentAdBreak()?this.handleHeartbeatForAdbreak(e):this.handleHeartbeatForContent(t,e)}handleHeartbeatForContent(e,t){let r=this.missedOpportunityBreak(e,t);if(r){let e=new W(this.getPlayhead());this.getReportsManager().fireBeacon(r.getTrackingReport("breakStart",!0),e),this.getReportsManager().fireBeacon(r.getTrackingReport("breakEnd",!0),e),-1!==this.linearAdBreaks.indexOf(r)&&this.linearAdBreaks.splice(this.linearAdBreaks.indexOf(r),1)}let i=this.adBreakForPlayhead(t);if(i){C.d(E.DEBUG_STATE_MACHINE,"CONTENT -> BREAK (playhead: "+t+")"),this.onAdvertBreakStart(i);let e=i.getAdvertFromPlayhead(t);this.onAdvertStart(e)}}handleHeartbeatForAdbreak(e){let t=this.adBreakForPlayhead(e);if(t)if(t!==this.getCurrentAdBreak()){C.d(E.DEBUG_STATE_MACHINE,"BREAK -> BREAK"),this.onAdvertEnd(),this.onAdvertBreakEnd(),this.onAdvertBreakStart(t);let r=t.getAdvertFromPlayhead(e);this.onAdvertStart(r)}else this.handleHeartbeatForAdvertToAdvert(e);else C.d(E.DEBUG_STATE_MACHINE,"BREAK -> CONTENT"),this.onAdvertEnd(),this.onAdvertBreakEnd()}handleHeartbeatForAdvertToAdvert(e){let t=this.getCurrentAdBreak().getAdvertFromPlayhead(e);if(t)if(t!==this.getCurrentAdvert())C.d(E.DEBUG_STATE_MACHINE,"ADVERT -> ADVERT"),this.getCurrentAdvert()&&this.onAdvertEnd(),this.onAdvertStart(t);else{let t=Math.max(e-this.getCurrentAdvert().getStart(),0);this.signalTimelineTrackingEvents(t)}}adBreakForPlayhead(e){for(let t of this.linearAdBreaks)if(t.getStart()<=e&&e<t.getStart()+t.getDuration())return t;return null}missedOpportunityBreak(e,t){for(let r of this.linearAdBreaks)if(0===r.getDuration()){let i=r.getStart();if(e<=i&&t>=i)return r}return null}onPlaybackStart(e){super.onPlaybackStart(e),this.handleHeartbeat(e)}setAdBreaksInactivePriorTo(e){for(let t of this.linearAdBreaks)if(!t.setAdvertsInactivePriorTo(e))break}}class $e{constructor(e,t){this.sessionIdentifier=e.get(m.IDENTIFIER),this.location=e.get(m.LOCATION),this.analyticUrl=e.get(m.ANALYTICURL),this.pauseUrl=e.get(m.PAUSEURL),this.availabilityStartTime=e.get(m.AVAILABILITYSTART)||null,this.interSegmentTimeout=t}getAnalyticUrl(){return this.analyticUrl}getIntersegmentTimeout(){return this.interSegmentTimeout}getPlaybackUrl(){return this.location}getPauseUrl(){return this.pauseUrl}getSessionIdentifier(){return this.sessionIdentifier}getAvailabilityStartTime(){return this.availabilityStartTime}}var Je=r(43),Ze=r.n(Je);class et{constructor(){this.data=new Map,this.s="",this.error=null,this.onError=this.onError.bind(this),this.onText=this.onText.bind(this),this.onOpenTag=this.onOpenTag.bind(this),this.onCloseTag=this.onCloseTag.bind(this),this.onCdata=this.onCdata.bind(this)}static parse(e){return e&&0!==e.length?(new et).parse(e):(C.e("Yospace DASH manifest is empty"),null)}parse(e){const t=Ze().parser(!0);return t.onerror=this.onError,t.ontext=this.onText,t.onopentag=this.onOpenTag,t.onclosetag=this.onCloseTag,t.oncdata=this.onCdata,t.write(e),this.error?null:new $e(this.data,1600)}onCdata(e){this.s+=e}onError(e){C.e("Parsing error: "+e),this.error=!0}onCloseTag(e){if("LOCATION"===e.toUpperCase()){let e=this.s.trim();this.data.set(m.LOCATION,e);let t=e.split(/\?/);try{let r=new URL(t[0]);this.data.set(m.SCHEME,r.protocol.substring(0,r.protocol.length-1)),this.data.set(m.HOSTNODE,r.hostname),this.data.set(m.PORT,r.port),this.data.set(m.QS,2===t.length?t[1]:null);let i=t[0].match(";jsessionid=([^?\\s]+)");if(i)this.data.set(m.IDENTIFIER,i[1]);else if(-1!==e.indexOf("yo.js")){let t=e.match("yo.js=([^&]+)");t&&this.data.set(m.IDENTIFIER,t[1])}void 0===this.data.get(m.IDENTIFIER)&&(this.error=!0)}catch(e){C.e("Failed to parse Location element: "+e),this.error=!0}}}onOpenTag(e){this.s="","MPD"===e.name.toUpperCase()&&(this.data.set(m.ANALYTICURL,e.attributes.analytics),this.data.set(m.PAUSEURL,e.attributes.livePause),this.data.set(m.AVAILABILITYSTART,new Date(e.attributes.availabilityStartTime)))}onText(e){this.s=e}}const tt=/;jsessionid=([^?]+)/,rt=/yo\.js=([^?]+)/,it="FIRSTLEVELPLAYLIST";class nt{constructor(){this.data=new Map,this.nextLineStreamInf=!1}buildPlaybackUrl(){let e=this.data.get(m.LOCATION);e&&!Ce(e)&&(C.w("Master URL invalid in HSL manifest: "+e),this.data.delete(m.LOCATION));let t=!1,r=this.data.get(m.LOCATION);if(r||(r=this.data.get(it)),!r)return C.e("No location or first level URL available"),!1;let i=Ce(r),n=r.match(rt),a=r.match(tt);if(i&&(n?(t=!0,this.data.set(m.IDENTIFIER,n[1])):a&&this.data.set(m.IDENTIFIER,a[1])),!i||void 0===this.data.get(m.IDENTIFIER))return C.e("Unable to build Location from components"),!1;let s=i.port;return this.data.set(m.PORT,""===s?"":s),this.data.set(m.SCHEME,i.protocol.substring(0,i.protocol.length-1)),this.data.set(m.HOSTNODE,i.hostname),this.data.set(m.QS,i.search?i.search.replace("?",""):""),this.updateLocationPath(i,t),!0}updateLocationPath(e,t){if(!this.data.get(m.LOCATION)){let r=e.pathname,i=r.substring(0,r.lastIndexOf("/"))+".m3u8",n=this.data.get(m.SCHEME);n+="://",n+=this.data.get(m.HOSTNODE),n+=""!==this.data.get(m.PORT)?":"+this.data.get(m.PORT):"",n+=i,t||(n+=";jsessionid="+this.data.get(m.IDENTIFIER)),B(this.data.get(m.QS))||(n+="?"+this.data.get(m.QS)),this.data.set(m.LOCATION,n)}}static checkParameters(e){return B(e)?(C.e("Yospace HLS manifest is empty"),!1):-1!==e.indexOf("#EXT-X-STREAM-INF:")||(C.e("No stream info found in HLS manifest"),!1)}static isHlsManifest(e){return e.length>=7&&-1!==e.toUpperCase().indexOf("#EXTM3U")}parseManifestLines(e){let t=e.split(/\r?\n/);for(let e of t)0!==e.length&&(e.startsWith("#")?this.processManifestDirective(e):this.nextLineStreamInf&&!this.data.has(it)&&this.data.set(it,e))}processManifestDirective(e){let t=e.indexOf(":");if(-1===t)return;let r=e.substring(t+1),i=e.substring(0,t);i.includes("#EXT-X-YOSPACE-ANALYTICS-URL")?this.data.set(m.ANALYTICURL,r.replace(/"/g,"")):i.includes("#EXT-X-STREAM-INF")?this.data.has(it)||(this.nextLineStreamInf=!0):i.includes("#EXT-X-YOSPACE-PAUSE")?this.data.set(m.PAUSEURL,r.replace(/"/g,"")):i.includes("#EXT-X-YOSPACE-SDK-MASTER-URL")&&this.data.set(m.LOCATION,r.replace(/"/g,""))}static parse(e){let t=new nt;return nt.checkParameters(e)?(t.parseManifestLines(e),t.buildPlaybackUrl(),new $e(t.data,g.INTERSEGMENT_TIMEOUT)):null}}class at{constructor(e,t,r,i){this.url=e,this.timeout=t,this.handler=r,this.frequency=i||g.DEFAULT_POLLING_DELAY,this.requestInProgress=!1,this.intervalID=null,this.lastPollTime=0,this.lastPollTimeMetric=0,this.queryParams=new Map,this.queryParams.set("ysdk",Ie.getVersion())}async handleRequest(){let e=await Re.get(this.url,{},this.timeout,null,this.queryParams);if(e.error&&C.w("Poll failed: "+e.error),this.checkResponse(e)){C.trace("sdk poll");let t=this.getRetryFromResponse(e);t!==this.frequency&&(C.d(E.DEBUG_POLLING,"Poll interval changed to "+t+" millis"),this.frequency=t,this.isRunning()&&this._start(!1))}return e}checkResponse(e){return!!e.ok||(400===e.status||410===e.status?(this.stop(),410===e.status&&C.d(E.DEBUG_POLLING,"Stream is resolved.  Stopping "+(this.handler?"analytic":"pause")+" poller")):C.w("Unexpected poll response "+e.status+", intervalID: "+this.frequency+" ms"),!1)}getRetryFromResponse(e){let t=e.headers.get("Retry-After");return t=1e3*Number.parseFloat(t),!Number.isNaN(t)&&t>0?t:this.frequency}getFrequency(){return this.frequency}isRunning(){return null!==this.intervalID}request(){C.d(E.DEBUG_POLLING,"Request poll"),this._poll(!0)}async _poll(e){if(!this.shouldPoll(e))return;this.requestInProgress=!0;let t=Date.now();0!==this.lastPollTime&&e||(this.lastPollTime=t),this.lastPollTimeMetric=t;let r=await this.handleRequest();this.handler&&this.handler(r,this.frequency),this.requestInProgress=!1}shouldPoll(e){if(this.requestInProgress)return C.d(E.DEBUG_POLLING,"Last poll still in flight. Ignoring."),!1;if(e)return!0;let t=Date.now()-this.lastPollTime;return!(t<this.frequency/2&&(C.d(E.DEBUG_POLLING,"Last poll too recent ("+t/1e3+"s). Ignoring."),1))}start(){this._start(!0)}_start(e){this.stop();let t=at.computeTimeToNextInterval(Date.now(),this.lastPollTime,this.frequency);this.intervalID=setTimeout((()=>{this.intervalID=setInterval((()=>{this._poll()}),this.frequency),this._poll()}),e?0:t)}static computeTimeToNextInterval(e,t,r){return t+r*(Math.floor(Math.abs(e-t)/r)+1)-e}stop(){clearInterval(this.intervalID),this.intervalID=null}shutdown(){this.stop(),this.handler=()=>{},C.d(E.DEBUG_LIFECYCLE,"Poller shutdown")}}class st{constructor(e,t,r,i){this.name=e,this.value=t||"",this.attributes=new Map,r&&i&&this.addAttribute(r,i)}addAttribute(e,t){this.attributes.set(e,t)}getName(){return this.name}getValue(){return this.value}getAttributes(){return this.attributes}setValue(e){this.value=e}toString(){let e="";if(e+="Property Name: ",e+=this.name,B(this.value)||(e+=", Value: ",e+=this.value),this.attributes.size>0){e+=", Attributes:{";for(let[t,r]of this.attributes)e+=t+":"+r+" ";e+="}"}return e}}class ot{constructor(e,t){this.name=e,this.attributes=t||new Map,this.text="",this.children=[]}static attributeToString(e,t){return" "+e+'="'+t+'"'}getAttributes(){return this.attributes}getAttribute(e){return this.attributes.get(e)}getChildren(){return this.children}getInnerText(){return this.text}getName(){return this.name}addChild(e){this.children.push(e)}setInnerText(e){this.text=e}toString(){let e="<";e+=this.name;for(let[t,r]of this.attributes)e+=ot.attributeToString(t,r);if(0===this.children.length&&B(this.text))e+="/>";else{e+=">",B(this.text)||(e+=this.text);for(let t of this.children)e+=N("\n"+t);B(this.text)||0!==this.children.length?e+=(t="\n</"+this.name+">")?""+t.toString().replace("\n    ","\n"):"null":(e+="</",e+=this.name,e+=">")}var t;return e}}class lt{constructor(e,t){if(e){this.linearAdBreaks=e.linearAdBreaks?e.linearAdBreaks:[],this.nonLinearAdBreaks=e.nonLinearAdBreaks?e.nonLinearAdBreaks:[],this.displayAdBreaks=e.displayAdBreaks?e.displayAdBreaks:[];let t=e.getStreamData();this.processStreamData(t)}this.setHash(t)}getDisplayAdBreaks(){return this.displayAdBreaks}getEarlyReturn(){return this.earlyReturn}getLinearAdBreaks(){return this.linearAdBreaks}getHasPlaceholder(){return this.hasPlaceholder}getHostNode(){return this.hostNode}getHostSuffix(){return this.hostSuffix}getNonLinearAdBreaks(){return this.nonLinearAdBreaks}getPdtInitial(){return this.pdtInitial}getPdtStart(){return this.pdtStart}getPdtEnd(){return this.pdtEnd}getSessionIdentifier(){return this.sessionIdentifier}getStreamDuration(){return this.streamDuration}hasAdBreaks(){return this.linearAdBreaks.length>0||this.nonLinearAdBreaks.length>0||this.displayAdBreaks.length>0}isEqualTo(e){return this.hashCode===e.hashCode}processStreamData(e){this.sessionIdentifier=e.getSessionIdentifier(),this.streamDuration=e.getDuration(),this.hostNode=e.getHostNode(),this.hostSuffix=e.getHostSuffix(),this.pdtInitial=e.getPdtInitial(),this.pdtStart=e.getPdtStart(),this.pdtEnd=e.getPdtEnd(),this.earlyReturn=e.getEarlyReturn(),this.hasPlaceholder=e.getHasPlaceholder()}setHash(e){if(!e)return;let t,r,i=0;for(t=0;t<e.length;t++)r=e.charCodeAt(t),i=(i<<5)-i+r,i|=0;this.hashCode=i}toString(){let e="Linear AdBreaks:";for(let t of this.linearAdBreaks)e+="\n"+t;e+="\n\nNonLinear AdBreaks:";for(let t of this.nonLinearAdBreaks)e+="\n"+t;e+="\n\nDisplay AdBreaks:";for(let t of this.displayAdBreaks)e+="\n"+t;return e+="\n\nHostNode:",e+="\n"+this.hostNode,e+="\n\nHostSuffix:",e+="\n"+this.hostSuffix,e+="\n\nSessionIdentifier:",e+="\n"+this.sessionIdentifier,e+="\n\nStreamDuration:",e+="\n"+this.streamDuration,e+="\n\npdtInitial:",e+="\n"+this.pdtInitial,e+="\n\npdtStart:",e+="\n"+this.pdtStart,e+="\n\npdtEnd:",e+="\n"+this.pdtEnd,e+="mmearlyReturn:",e+="\n"+this.earlyReturn,e}}const ht="AdServingId",ct="Description",ut="vmap:AdBreak",dt="vmap:Tracking",pt="Category",gt="AdSystem",ft="Advertiser",vt="Survey",mt="Pricing",Et="UniversalAdId",yt="Extensions",Tt="Creative",kt="Linear",At="Icon",bt="IconClickFallbackImage",St="AdParameters",wt="InteractiveCreativeFile",It="NonLinearAds",Dt="NonLinear",Ct="CompanionAds",Rt="Companion",Pt="StaticResource",_t="HTMLResource",Lt="Tracking",Nt="Verification",Bt="JavaScriptResource",Mt="ExecutableResource",Ut="CreativeExtensions";class Ot{constructor(){this.clear()}clear(){this.adverts=[],this.timelineTrackingMap=new Map,this.trackingEvent=null,this.start=0,this.duration=0,this.position=null,this.breakType=null,this.identifier=null,this.earlyReturn=null,this.adTagUri=null,this.timeOffset=null,this.vastVersion=null}}class Ft{constructor(){this.clear()}clear(){this.id=null,this.sequence=null,this.adType=null,this.properties=[],this.linearCreative=null,this.companionAds=null,this.impressions=null,this.errors=null,this.viewableImpressions=new Map,this.adVerifications=[],this.filler=!1,this.nonLinear=!1,this.topLevelWrapper=null,this.extensions=null,this.processingCompanionCreative=!1,this.currentCreativeType=0,this.nonLinearAds=null,this.adSystemVersion=null,this.advertiserId=null,this.categoryAuthority=null,this.pricingModel=null,this.pricingCurrency=null,this.surveyType=null,this.verificationVendor=null,this.verificationEvents=new Map,this.verificationResources=[],this.verificationApiFramework=null,this.verificationBrowserOptional=null,this.verificationParameters=null,this.verificationResourceType=null,this.extensionStack=[],this.identifier="",this.mediaIdentifier=""}parseId(e){if(this.id=e,this.identifier="",this.mediaIdentifier="",e){let t=e.split("_YO_");2===t.length&&(this.identifier=t[0],this.mediaIdentifier=t[1])}}}class xt{constructor(){this.clear()}clear(){this.required=null,this.companions=[]}}class Vt{constructor(){this.clearAll()}clear(){this.clickThroughUrl="",this.clickThroughTrackings=[],this.clickThroughCustoms=[],this.nonLinearResources=[],this.duration=null,this.trackingMap=new Map,this.interactiveTracking=null,this.icons=[],this.currentAssetUri=null,this.skipOffset=null,this.adParameters=null,this.staticResourceCreativeType=null,this.trackingEvent=null,this.htmlResourceEncoded=!1,this.altText=null,this.companionExtensionStack=[],this.companionExtensions=null,this.icSource=null,this.properties=[]}clearAll(){this.advertId=null,this.id=null,this.sequence=null,this.universalAdIds=[],this.universalAdIdRegistry=null,this.extensions=null,this.extensionStack=[],this.clickThroughTrackings=[],this.clickThroughUrl="",this.adParameters=null,this.trackingEvent=null,this.duration=null,this.trackingMap=new Map,this.interactiveTracking=null,this.icons=[],this.currentAssetUri=null,this.skipOffset=null,this.clickThroughCustoms=[],this.nonLinearResources=[],this.staticResourceCreativeType=null,this.htmlResourceEncoded=null,this.altText=null,this.companionExtensions=null,this.companionExtensionStack=[],this.properties=[],this.icSource=null}}class Gt{constructor(){this.clear()}clear(){this.resources=[],this.properties=[],this.clickThroughUrl=null,this.staticResourceCreativeType=null,this.clickTrackings=[],this.clickFallbackImages=[],this.viewTrackings=[],this.htmlResourceEncoded=!1}}class Ht{constructor(){this.clear()}clear(){this.properties=[],this.resource=null,this.staticResourceCreativeType=null,this.altText=null}}class Yt{constructor(){this.clear()}clear(){this.nonLinearCreatives=[],this.trackingMap=new Map}}class jt{constructor(){this.sessionIdentifier=null,this.duration=0,this.hostNode=null,this.hostSuffix=null,this.pdtInitial=null,this.pdtStart=null,this.pdtEnd=null,this.earlyReturn=null,this.hasPlaceholder=!1}getSessionIdentifier(){return this.sessionIdentifier}getDuration(){return this.duration}getHasPlaceholder(){return this.hasPlaceholder}getHostNode(){return this.hostNode}getHostSuffix(){return this.hostSuffix}getPdtInitial(){return this.pdtInitial}getPdtStart(){return this.pdtStart}getPdtEnd(){return this.pdtEnd}getEarlyReturn(){return this.earlyReturn}}class qt{constructor(e){this.broker=e,this.skipNormalisation=!1,this.linearAdBreaks=[],this.nonLinearAdBreaks=[],this.displayAdBreaks=[],this.isVmap=!1,this.isValidVAST=!0,this.processingAdvertExtensions=!1,this.processingCreativeExtensions=!1,this.characters="",this.adBreakData=new Ot,this.advertData=new Ft,this.companionAdsData=new xt,this.creativeData=new Vt,this.iconClickFallbackImageData=new Ht,this.iconData=new Gt,this.iconFallbackImageData=new Ht,this.nonLinearAdsData=new Yt,this.streamData=new jt,this.onCdata=this.onCdata.bind(this),this.onOpenTag=this.onOpenTag.bind(this),this.onCloseTag=this.onCloseTag.bind(this),this.onText=this.onText.bind(this)}addToCreativeExtensionStack(e){this.advertData.processingCompanionCreative?this.creativeData.companionExtensionStack.push(e):this.creativeData.extensionStack.push(e)}checkAdBreakForParsingErrors(e){if(e.getType()===We.LINEAR){if(-1===e.getStart()){let e=new pe(this.adBreakData.identifier,pe.Message.INVALID_START_TIME,pe.Message.INVALID_START_TIME+": "+this.adBreakData.timeOffset);this.broker.addParsingError(e)}if(0===e.getAdverts().length&&0===e.getTrackingMap().size){let e=new pe(this.adBreakData.identifier,pe.Message.EMPTY_ADVERT_AND_TRACKING,"Empty ad break at offset: "+this.adBreakData.timeOffset);this.broker.addParsingError(e)}}}checkValidVersion(e){let t=parseFloat(e);return!Number.isNaN(t)&&t>=4.2}getStreamData(){return this.streamData}handleCreativeExtensionsForOnEndDefault(e){let t=this.advertData.processingCompanionCreative?this.creativeData.companionExtensionStack:this.creativeData.extensionStack,r=t.length;2===r?(this.pop(!1,!0),this.processingCreativeExtensions=!1):r>0&&e===t[r-1].getName()&&this.pop(!1,!0)}handleStartAd(e){this.advertData.parseId(e.id);let t=parseInt(e.sequence);this.advertData.sequence=Number.isNaN(t)?0:t,Number.isNaN(t)||(this.advertData.sequence=t),this.advertData.adType=e.adType,ze.getBreakTypeFromString(this.adBreakData.breakType)!==We.LINEAR&&(this.advertData.nonLinear=!0)}handleStartAdWrapper(e){let t=e.id?e.id:"",r=e.creativeId?e.creativeId:"",i=e.AdSystem?e.AdSystem:"",n=new Ve(t,r,i);this.advertData.topLevelWrapper&&n.setChild(this.advertData.topLevelWrapper),this.advertData.topLevelWrapper=n}handleStartCreative(e){this.creativeData.advertId=e.adId,this.creativeData.id=e.id;let t=parseInt(e.sequence);this.creativeData.sequence=isNaN(t)?0:t}handleStartCreativeExtension(e,t){let r=e.type;r=r||"",-1===r.indexOf("com.yospace")&&-1===r.indexOf("AdVerifications")&&(this.processingCreativeExtensions=!0,this.addToCreativeExtensionStack(new ot(t.name,re(e))))}handleStartExtension(e,t){let r=e.type;r=r||"",-1===r.indexOf("com.yospace")&&-1===r.indexOf("AdVerifications")&&(this.processingAdvertExtensions=!0,this.advertData.extensionStack.push(new ot(t.name,re(e))))}handleStartExtensionElement(e,t){this.processingAdvertExtensions?this.advertData.extensionStack.push(new ot(t.name,re(e))):this.processingCreativeExtensions&&this.addToCreativeExtensionStack(new ot(t.name,re(e)))}handleStartHtmlResource(e){let t=e.xmlEncoded,r=!!t&&("TRUE"===t.toUpperCase()||"1"===t);this.iconData.properties.length>0?this.iconData.htmlResourceEncoded=r:this.creativeData.htmlResourceEncoded=r}handleStartPricing(e){let t=e.model;this.advertData.pricingModel=t?t.toUpperCase():"",this.advertData.pricingCurrency=e.currency}handleStartStaticResource(e){this.iconClickFallbackImageData.properties.length>0?this.iconClickFallbackImageData.staticResourceCreativeType=e.creativeType:this.iconData.properties.length>0?this.iconData.staticResourceCreativeType=e.creativeType:this.creativeData.staticResourceCreativeType=e.creativeType}handleStartTracking(e){if(this.creativeData.trackingEvent=e.event,"progress"===this.creativeData.trackingEvent){let t=e.offset;B(t)||(this.creativeData.trackingEvent=this.creativeData.trackingEvent+"-"+t)}}handleEndAd(){let e=new qe(this.advertData);if(e.isValid())this.adBreakData.adverts.push(e);else if(this.advertData.nonLinear||this.advertData.linearCreative){if(B(e.mediaIdentifier)){let e=new pe(null,pe.Message.INVALID_MEDIAID,"Yospace media identifier could not be parsed (advert id: "+this.advertData.id+")");this.broker.addParsingError(e)}}else{let e=new pe(null,pe.Message.MISSING_CREATIVE,"No creative for advert: "+this.advertData.id);this.broker.addParsingError(e)}e.isValid()||C.w("Invalid advert.  Discarding ("+this.advertData.id+")"),this.advertData.clear()}handleAdvertExtensionsForOnEndDefault(e){let t=this.advertData.extensionStack.length;2===t?(this.pop(!0,!0),this.processingAdvertExtensions=!1):t>0&&e===this.advertData.extensionStack[t-1].getName()&&this.pop(!0,!0)}handleEndAdTitle(){let e=this.characters.trim();this.advertData.properties.push(new st("AdTitle",e)),"filler"===e&&(this.advertData.filler=!0)}handleEndClickTracking(){let e=this.characters.trim();Ce(e)?this.creativeData.clickThroughTrackings.push(e):C.w("Discarding click tracking URL:"+e)}handleEndCompanion(){let e=null;B(this.creativeData.clickThroughUrl)||(e=new le(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,null));let t=new Ne(this.creativeData,e,this.creativeData.nonLinearResources,this.creativeData.trackingMap,this.broker);t.isValid()?(t.setNonLinear(this.advertData.nonLinear),this.companionAdsData.companions.push(t)):C.w("Discarding invalid Companion"),this.creativeData.clear()}handleEndCompanionClickTracking(){let e=this.characters.trim();Ce(e)?this.creativeData.clickThroughTrackings.push(e):C.w("Discarding empty Companion click tracking URL")}handleEndCreative(){switch(this.advertData.currentCreativeType){case 1:for(let e of this.advertData.companionAds.companions)e.postParse(this.creativeData.extensions);break;case 2:this.advertData.linearCreative&&this.advertData.linearCreative.postParse(this.creativeData.extensions);break;case 3:for(let e of this.advertData.nonLinearAds.nonLinearCreatives)e.postParse(this.creativeData.extensions)}this.creativeData.clearAll()}handleEndCustomClick(){let e=this.characters.trim();""!==e?this.creativeData.clickThroughCustoms.push(e):C.w("Discarding empty custom click URL")}handleEndError(e){let t=this.characters.trim();Ce(t)?this.advertData.errors?this.advertData.errors.addTrackingUrl(t):this.advertData.errors=new V(e,[t],this.adBreakData.identifier,this.advertData.mediaIdentifier):C.w("Discarding empty Error")}handleEndExecutableResource(){if(this.advertData.verificationApiFramework&&this.advertData.verificationResourceType){let e=new st("ExecutableResource",this.characters.trim(),"apiFramework",this.advertData.verificationApiFramework);e.addAttribute("type",this.advertData.verificationResourceType),this.advertData.verificationResources.push(e)}this.advertData.verificationApiFramework=null,this.advertData.verificationResourceType=null}handleEndIcon(){let e=null;(!B(this.iconData.clickThroughUrl)||this.iconData.viewTrackings.length>0)&&(e=B(this.iconData.clickThroughUrl)?new le(null,null,this.iconData.viewTrackings):new le(this.iconData.clickThroughUrl,this.iconData.clickTrackings,this.iconData.viewTrackings));let t=new He(this.iconData.properties,this.iconData.resources,e,this.iconData.clickFallbackImages,this.broker);t.isValid()?this.creativeData.icons.push(t):C.w("Discarding invalid Icon"),this.iconData.clear()}handleEndIFrameResource(){let e=this.characters.trim();this.iconData.properties.length>0?this.iconData.resources.push(new _e(Pe.IFRAME,e)):this.creativeData.nonLinearResources.push(new _e(Pe.IFRAME,e))}handleEndExtensionElement(e){this.processingAdvertExtensions?this.handleAdvertExtensionsForOnEndDefault(e):this.handleCreativeExtensionsForOnEndDefault(e)}handleEndHtmlResource(){if(this.iconData.properties.length>0){let e=this.characters.trim();this.iconData.resources.push(new _e(Pe.HTML,e,null,this.iconData.htmlResourceEncoded))}else this.creativeData.nonLinearResources.push(new _e(Pe.HTML,this.characters,null,this.creativeData.htmlResourceEncoded))}handleEndIconClickFallbackImage(){let e=new Ge(this.iconClickFallbackImageData.properties,this.iconClickFallbackImageData.altText,this.iconClickFallbackImageData.resource);e.isValid()?this.iconData.clickFallbackImages.push(e):C.w("Discarding invalid IconClickFallbackImage"),this.iconClickFallbackImageData.clear()}handleEndIconClickTracking(){let e=this.characters.trim();Ce(e)?this.iconData.clickTrackings.push(e):C.w("Discarding empty Icon click tracking URL")}handleEndIconViewTracking(){let e=this.characters.trim();Ce(e)?this.iconData.viewTrackings.push(e):C.w("Discarding empty Icon view tracking URL")}handleEndInteractiveTracking(){this.creativeData.interactiveTracking?this.creativeData.interactiveTracking.addTrackingUrl(this.characters.trim()):this.creativeData.interactiveTracking=new V(this.creativeData.trackingEvent,[this.characters.trim()],this.adBreakData.identifier,this.advertData.mediaIdentifier)}handleEndLinear(){let e=null;(!B(this.creativeData.clickThroughUrl)||this.creativeData.clickThroughCustoms.length>0)&&(e=B(this.creativeData.clickThroughUrl)?new le(null,null,this.creativeData.clickThroughCustoms):new le(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,this.creativeData.clickThroughCustoms));let t=null;this.creativeData.properties.length>0&&(t=new je(this.creativeData.icSource,this.creativeData.properties,this.broker,this.creativeData.interactiveTracking),t.isValid()||(C.w("Discarding invalid InteractiveCreative"),t=null));let r=new de(this.creativeData,e,t,this.broker);r.isValid()?this.advertData.linearCreative=r:C.w("Discarding invalid LinearCreative"),this.creativeData.clear()}handleEndImpression(e){let t=this.characters.trim();B(t)?C.w("Discarding empty Impression"):this.advertData.impressions?this.advertData.impressions.addTrackingUrl(t):this.advertData.impressions=new V(e,[t],this.adBreakData.identifier,this.advertData.mediaIdentifier)}handleEndInteractiveCreativeFile(){this.creativeData.icSource=this.characters.trim()}handleEndJavaScriptResource(){if(this.advertData.verificationApiFramework&&this.advertData.verificationBrowserOptional){let e=new st(Bt,this.characters.trim(),"apiFramework",this.advertData.verificationApiFramework);e.addAttribute("browserOptional",this.advertData.verificationBrowserOptional),this.advertData.verificationResources.push(e)}this.advertData.verificationApiFramework=null,this.advertData.verificationBrowserOptional=null}handleEndMediaFile(){0!==this.creativeData.properties.length?this.creativeData.icSource=this.characters.trim():this.creativeData.currentAssetUri=this.characters.trim()}handleEndNonLinearClickTracking(){let e=this.characters.trim();Ce(e)?this.creativeData.clickThroughTrackings.push(e):C.w("Discarding empty Nonlinear click tracking URL")}handleEndPricing(){let e=this.characters.trim();if(""!==e){let t=new st(mt,e,"currency",this.advertData.pricingCurrency);t.addAttribute("model",this.advertData.pricingModel),B(this.advertData.pricingCurrency)||B(this.advertData.pricingModel)?C.w("Discarding invalid Pricing property"):this.advertData.properties.push(t)}else C.w("Discarding invalid Pricing property")}handleEndUniversalAdId(){let e=this.characters.trim();""!==e?this.creativeData.universalAdIds.push(new st(Et,e,"idRegistry",this.creativeData.universalAdIdRegistry)):C.w("Discarding empty UniversalAdId URL")}handleEndVerification(){let e=new xe(this.advertData);e.isValid()?this.advertData.adVerifications.push(e):C.w("Discarding invalid AdVerification"),this.advertData.verificationEvents=new Map,this.advertData.verificationResources=[],this.advertData.verificationParameters=null}handleEndVmapTracking(){let e=this.characters.trim();if(V.isValidAdBreakEvent(this.adBreakData.trackingEvent))if(B(e))C.w("Discarding empty VMAP");else{let t=this.adBreakData.timelineTrackingMap.get(this.adBreakData.trackingEvent);t?t.addTrackingUrl(e):(t=new V(this.adBreakData.trackingEvent,[e],this.adBreakData.identifier,this.advertData.mediaIdentifier),this.adBreakData.timelineTrackingMap.set(this.adBreakData.trackingEvent,t))}else C.d(E.DEBUG_PARSING,"Discarding invalid vmap:Tracking event")}handleEndNonLinear(){let e=null;this.creativeData.clickThroughUrl&&""!==this.creativeData.clickThroughUrl&&(e=new le(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,null));let t=new Ye(this.creativeData,e,this.creativeData.nonLinearResources,this.broker);t.isValid()?(t.setNonLinear(this.advertData.nonLinear),this.nonLinearAdsData.nonLinearCreatives.push(t)):C.w("Discarding invalid NonLinear"),this.creativeData.clear()}handleEndStaticResource(){let e=this.characters.trim();if(this.iconClickFallbackImageData.properties.length>0){let t=new _e(Pe.STATIC,e,this.iconClickFallbackImageData.staticResourceCreativeType);if(t.isValid())return void(this.iconClickFallbackImageData.resource=t)}else if(this.iconData.properties.length>0){let t=new _e(Pe.STATIC,e,this.iconData.staticResourceCreativeType);if(t.isValid())return void this.iconData.resources.push(t)}else{let t=new _e(Pe.STATIC,e,this.creativeData.staticResourceCreativeType);if(t.isValid())return void this.creativeData.nonLinearResources.push(t)}C.w("Discarding invalid StaticResource")}handleEndTracking(){let e=this.characters.trim();if(B(Ce(e))){C.w("Discarding empty tracking URL");let t=new pe(null,pe.Message.INVALID_TRACKING_URL,"Bad tracking url:"+e+" event: "+this.creativeData.trackingEvent);this.broker.addParsingError(t)}else{let e=null;V.isValidVerificationEvent(this.creativeData.trackingEvent)?e=this.advertData.verificationEvents:2===this.advertData.currentCreativeType&&V.isValidLinearEvent(this.creativeData.trackingEvent)||0===this.creativeData.trackingEvent.indexOf("progress")?e=this.creativeData.trackingMap:2===this.advertData.currentCreativeType&&V.isValidInteractiveEvent(this.creativeData.trackingEvent)?this.handleEndInteractiveTracking():1===this.advertData.currentCreativeType&&V.isValidCompanionEvent(this.creativeData.trackingEvent)?e=this.creativeData.trackingMap:3===this.advertData.currentCreativeType&&V.isValidNonLinearEvent(this.creativeData.trackingEvent)&&(e=this.nonLinearAdsData.trackingMap),e&&this.parseMapForOnEndTracking(e)}}handleEndViewableImpression(e){let t=this.characters.trim();if(B(Ce(t)))C.w("Discarding empty ViewableImpression URL");else{let r=this.advertData.viewableImpressions.get(e);r?r.addTrackingUrl(t):(r=new V(e,[t],this.adBreakData.identifier,this.advertData.mediaIdentifier),this.advertData.viewableImpressions.set(e,r))}}handleTextDataForExtensions(){let e=this.characters.trim();if(""!==e){let t=[];t=this.processingAdvertExtensions?this.advertData.extensionStack:this.advertData.processingCompanionCreative?this.creativeData.companionExtensionStack:this.creativeData.extensionStack,t.length>0&&t[t.length-1].setInnerText(e)}}handleVmapAdBreak(){if(null!==this.adBreakData.earlyReturn)return this.streamData.earlyReturn=this.adBreakData.earlyReturn,void this.adBreakData.clear();ze.getBreakTypeFromString(this.adBreakData.breakType)!==We.LINEAR||this.skipNormalisation||(this.adBreakData.start=this.broker.normaliseAdBreakStart(this.adBreakData.start,this.adBreakData.position));let e=new ze(this.adBreakData.start,this.adBreakData.duration,this.adBreakData.position,this.adBreakData.timelineTrackingMap,this.adBreakData.breakType,this.adBreakData.identifier,null,this.adBreakData.adTagUri);if(this.adBreakData.adverts.length>0&&e.setAdverts(this.adBreakData.adverts),e.postParse(this.broker),e.isValid())switch(ze.getBreakTypeFromString(this.adBreakData.breakType)){case We.LINEAR:this.linearAdBreaks.push(e);break;case We.NONLINEAR:this.nonLinearAdBreaks.push(e);break;case We.DISPLAY:this.displayAdBreaks.push(e)}else{let t=this.streamData.hasPlaceholder?" placeholder ":" ";C.w(`Discarding empty${t}ad break`),this.checkAdBreakForParsingErrors(e)}this.adBreakData.clear()}handleVmapAdTagURI(){this.streamData.hasPlaceholder=!0,this.adBreakData.adTagUri=this.characters.trim()}handleStartYospaceAdBreak(e){let t=e.duration;if(t&&(this.adBreakData.duration=O(t,-1)),ze.getBreakTypeFromString(this.adBreakData.breakType)===We.LINEAR&&-1===this.adBreakData.duration){let e=new pe(this.adBreakData.identifier,pe.Message.INVALID_DURATION,pe.Message.INVALID_DURATION+": "+t);this.broker.addParsingError(e)}let r=e.position;r&&(this.adBreakData.position=r);let i=e.earlyReturn;if(i){let e=O(i,-1);this.adBreakData.earlyReturn=-1!==e?e+this.adBreakData.start:-1}}handleYospaceStream(e){let t=e.urlDomain;t&&(this.streamData.hostNode=t);let r=e.urlSuffix;if(r&&(this.streamData.hostSuffix=r),e.duration){let t=O(e.duration,0);t&&(this.streamData.duration=t)}if(this.streamData.hostSuffix){let e=this.streamData.hostSuffix.match("yo.p.si=([^&]+)");e&&(this.streamData.sessionIdentifier=e[1])}this.streamData.pdtInitial=U(e.pdtinitial,null),this.streamData.pdtStart=U(e.pdtstart,null),this.streamData.pdtEnd=U(e.pdtend,null),(null===this.streamData.pdtStart||null===this.streamData.pdtEnd||this.streamData.pdtStart>this.streamData.pdtEnd)&&(this.streamData.pdtStart=null,this.streamData.pdtEnd=null,this.streamData.pdtInitial=null)}onCdata(e){this.characters=e,(this.processingAdvertExtensions||this.processingCreativeExtensions)&&this.handleTextDataForExtensions()}onOpenTag(e){let t=e.attributes;if(this.processingAdvertExtensions||this.processingCreativeExtensions)this.handleStartExtensionElement(t,e);else{if("vmap:VMAP"===e.name&&(this.isVmap=!0),"yospace:Stream"===e.name&&this.handleYospaceStream(t),e.name===ut){this.adBreakData.timeOffset=t.timeOffset,this.adBreakData.timeOffset&&(this.adBreakData.start=O(this.adBreakData.timeOffset,-1));let e=t.breakType;e&&(this.adBreakData.breakType=e);let r=t.breakId;r&&(this.adBreakData.identifier=r)}"yospace:AdBreak"===e.name&&this.handleStartYospaceAdBreak(t),e.name===dt&&(this.adBreakData.trackingEvent=t.event),"VAST"===e.name&&(this.adBreakData.vastVersion=t.version,this.checkValidVersion(this.adBreakData.vastVersion)||(C.e("Invalid or missing VAST version; is AV tag defined?"),this.isValidVAST=!1)),"Ad"===e.name&&this.handleStartAd(t),"AdWrapper"===e.name&&this.handleStartAdWrapper(t),e.name===pt&&(this.advertData.categoryAuthority=t.authority),e.name===gt&&(this.advertData.adSystemVersion=t.version),e.name===ft&&(this.advertData.advertiserId=t.id),e.name===vt&&(this.advertData.surveyType=t.type),e.name===mt&&this.handleStartPricing(t),e.name===Et&&(this.creativeData.universalAdIdRegistry=t.idRegistry),e.name===yt&&this.advertData.extensionStack.push(new ot(e.name,re(t))),e.name===Tt&&this.handleStartCreative(t),e.name===kt&&(this.advertData.currentCreativeType=2,this.creativeData.skipOffset=t.skipoffset),e.name===At&&this.populateIconPropertyList(t),e.name===bt&&this.populateIconClickFallbackImagePropertyList(t),e.name===St&&(this.creativeData.adParameters=new st(St,null,"xmlEncoded",t.xmlEncoded)),e.name===wt&&this.populateInteractiveCreativePropertyList(t),e.name===It&&(this.advertData.currentCreativeType=3),e.name===Dt&&this.populateNonLinearPropertyList(t),e.name===Ct&&(this.advertData.currentCreativeType=1,this.advertData.processingCompanionCreative=!0,this.companionAdsData.required=t.required),e.name===Rt&&this.populateCompanionPropertyList(t),e.name===Pt&&this.handleStartStaticResource(t),e.name===_t&&this.handleStartHtmlResource(t),e.name===Lt&&this.handleStartTracking(t),e.name===Nt&&(this.advertData.verificationVendor=t.vendor),e.name===Bt&&(this.advertData.verificationApiFramework=t.apiFramework,this.advertData.verificationBrowserOptional=t.browserOptional),e.name===Mt&&(this.advertData.verificationApiFramework=t.apiFramework,this.advertData.verificationResourceType=t.type),"Extension"===e.name&&this.handleStartExtension(t,e),e.name===Ut&&this.addToCreativeExtensionStack(new ot(e.name,re(t))),"CreativeExtension"===e.name&&this.handleStartCreativeExtension(t,e),e.isSelfClosing&&this.onCloseTag(e)}}onCloseTag(e){if(this.processingAdvertExtensions||this.processingCreativeExtensions)return this.handleEndExtensionElement(e),void(this.characters="");e===ut&&this.handleVmapAdBreak(),e===dt&&this.handleEndVmapTracking(),"Ad"===e&&this.handleEndAd(),e===gt&&this.advertData.properties.push(new st("AdSystem",this.characters.trim(),"version",this.advertData.adSystemVersion)),"AdTitle"===e&&this.handleEndAdTitle(),"Impression"===e&&this.handleEndImpression(e),e===ht&&this.advertData.properties.push(new st(ht,this.characters.trim())),e===pt&&this.advertData.properties.push(new st(pt,this.characters.trim(),"authority",this.advertData.categoryAuthority)),e===ct&&this.advertData.properties.push(new st(ct,this.characters.trim())),e===ft&&this.advertData.properties.push(new st(ft,this.characters.trim(),"id",this.advertData.advertiserId)),e===vt&&this.advertData.properties.push(new st(vt,this.characters.trim(),"type",this.advertData.surveyType)),"Error"===e&&this.handleEndError(e),e===mt&&this.handleEndPricing(),e===Et&&this.handleEndUniversalAdId(),e===yt&&this.pop(!0,!1),e===Ut&&this.pop(!1,!1),e===Nt&&this.handleEndVerification(),"VerificationParameters"===e&&(this.advertData.verificationParameters=this.characters.trim()),"MediaFile"===e&&this.handleEndMediaFile(),e===wt&&this.handleEndInteractiveCreativeFile(),"ClickThrough"!==e&&"NonLinearClickThrough"!==e&&"CompanionClickThrough"!==e||(this.creativeData.clickThroughUrl=this.characters.trim()),"IconClickThrough"===e&&(this.iconData.clickThroughUrl=this.characters.trim()),"ClickTracking"===e&&this.handleEndClickTracking(),"NonLinearClickTracking"===e&&this.handleEndNonLinearClickTracking(),"CompanionClickTracking"===e&&this.handleEndCompanionClickTracking(),"IconClickTracking"===e&&this.handleEndIconClickTracking(),e===bt&&this.handleEndIconClickFallbackImage(),"AltText"===e&&(this.iconClickFallbackImageData.properties.length>0?this.iconClickFallbackImageData.altText=this.characters.trim():this.creativeData.altText=this.characters.trim()),"CustomClick"===e&&this.handleEndCustomClick(),"IconViewTracking"===e&&this.handleEndIconViewTracking(),e===Tt&&this.handleEndCreative(),e===kt&&this.handleEndLinear(),e===It&&(this.advertData.nonLinearAds=new Be(this.nonLinearAdsData.trackingMap,this.nonLinearAdsData.nonLinearCreatives),this.nonLinearAdsData.clear()),e===Dt&&this.handleEndNonLinear(),e===Ct&&(this.advertData.companionAds=new Le(this.companionAdsData.required,this.companionAdsData.companions),this.companionAdsData.clear(),this.advertData.processingCompanionCreative=!1),e===Rt&&this.handleEndCompanion(),e===At&&this.handleEndIcon(),e===St&&this.creativeData.adParameters.setValue(this.characters.trim()),"Duration"===e&&(this.creativeData.duration=this.characters.trim()),"Viewable"!==e&&"NotViewable"!==e&&"ViewUndetermined"!==e||this.handleEndViewableImpression(e),e===Pt&&this.handleEndStaticResource(),e===_t&&this.handleEndHtmlResource(),"IFrameResource"===e&&this.handleEndIFrameResource(),e===Lt&&this.handleEndTracking(),e===Bt&&this.handleEndJavaScriptResource(),e===Mt&&this.handleEndExecutableResource(),"vmap:AdTagURI"===e&&this.handleVmapAdTagURI()}onText(e){this.characters=e,(this.processingAdvertExtensions||this.processingCreativeExtensions)&&this.handleTextDataForExtensions()}static parse(e,t,r){return new qt(t).parse(e,r)}parse(e,t){this.skipNormalisation=!(!t||!t.skipNormalisation)&&t.skipNormalisation;let r=!1;return new Promise(((t,i)=>{try{const i=Ze().parser(!0);i.onerror=e=>{r=!0,C.e("Failed to parse document: "+e),this.broker.addParsingError(new pe(null,pe.Message.BAD_XML,e.message)),t(null)},i.ontext=this.onText,i.onopentag=this.onOpenTag,i.onclosetag=this.onCloseTag,i.oncdata=this.onCdata,i.write(e).close();let n=null;if(r)return;if(!this.isVmap)return this.broker.addParsingError(new pe(null,pe.Message.NO_VMAP)),C.e("Failed to parse document.  VMAP not found"),void t(null);if(!this.isValidVAST)return this.broker.addParsingError(new pe(null,pe.Message.INCORRECT_VAST_VERSION,"Version is "+this.adBreakData.vastVersion+", expected >= 4.2")),C.e("Failed to parse document.  VAST not valid"),void t(null);!function(e){if(C.debugflags&E.DEBUG_PARSING){C.d(E.DEBUG_PARSING,"\n--------------- VMAP PARSING SUMMARY ---------------"),C.d(E.DEBUG_PARSING," * Number of ad breaks: "+e.linearAdBreaks.length),C.d(E.DEBUG_PARSING," * Number of nonlinear ad breaks: "+e.nonLinearAdBreaks.length),C.d(E.DEBUG_PARSING," * Number of display ad breaks: "+e.displayAdBreaks.length),C.d(E.DEBUG_PARSING," * Stream duration: "+e.streamData.duration+"ms\n");for(let t of e.linearAdBreaks){C.d(E.DEBUG_PARSING,t.toString());for(let e of t.getAdverts())C.d(E.DEBUG_PARSING,e.toString())}for(let t of e.nonLinearAdBreaks){C.d(E.DEBUG_PARSING,t.toString());for(let e of t.getAdverts())C.d(E.DEBUG_PARSING,e.toString())}for(let t of e.displayAdBreaks){C.d(E.DEBUG_PARSING,t.toString());for(let e of t.getAdverts())C.d(E.DEBUG_PARSING,e.toString())}e.streamData.getEarlyReturn()&&C.d(E.DEBUG_PARSING,"Early return: "+e.streamData.getEarlyReturn()),C.d(E.DEBUG_PARSING,"--------------- END PARSING SUMMARY ----------------\n")}}(this),n=new lt(this,e.toString()),t(n)}catch(e){this.broker.addParsingError(new pe(null,pe.Message.BAD_XML,e.message)),i(e)}}))}parseMapForOnEndTracking(e){let t=this.characters.trim(),r=e.get(this.creativeData.trackingEvent);r?r.addTrackingUrl(t):(r=-1!==this.creativeData.trackingEvent.indexOf("progress")?new V("progress",[t],this.adBreakData.identifier,this.advertData.mediaIdentifier):new V(this.creativeData.trackingEvent,[t],this.adBreakData.identifier,this.advertData.mediaIdentifier),e.set(this.creativeData.trackingEvent,r))}pop(e,t){let r=[];r=e?this.advertData.extensionStack:this.advertData.processingCompanionCreative?this.creativeData.companionExtensionStack:this.creativeData.extensionStack;let i=r.pop();t?r[r.length-1].addChild(i):e?this.advertData.extensions=i:this.advertData.processingCompanionCreative?this.creativeData.companionExtensions=i:this.creativeData.extensions=i}populateCompanionProperty(e,t){this.populateCreativeProperty(e,t)}populateCompanionPropertyList(e){this.populateCompanionProperty(e,"id"),this.populateCompanionProperty(e,"width"),this.populateCompanionProperty(e,"height"),this.populateCompanionProperty(e,"assetWidth"),this.populateCompanionProperty(e,"assetHeight"),this.populateCompanionProperty(e,"expandedWidth"),this.populateCompanionProperty(e,"expandedHeight"),this.populateCompanionProperty(e,"apiFramework"),this.populateCompanionProperty(e,"adSlotId"),this.populateCompanionProperty(e,"pxratio"),this.populateCompanionProperty(e,"renderingMode")}populateCreativeProperty(e,t){let r=e[t];B(r)||this.creativeData.properties.push(new st(t,r))}populateIconProperty(e,t){let r=e[t];B(r)||this.iconData.properties.push(new st(t,r))}populateIconPropertyList(e){for(const t in e)this.populateIconProperty(e,t)}populateIconClickFallbackImageProperty(e,t){let r=e[t];B(r)||this.iconClickFallbackImageData.properties.push(new st(t,r))}populateIconClickFallbackImagePropertyList(e){this.populateIconClickFallbackImageProperty(e,"width"),this.populateIconClickFallbackImageProperty(e,"height")}populateInteractiveCreativeProperty(e,t){this.populateCreativeProperty(e,t)}populateInteractiveCreativePropertyList(e){this.populateInteractiveCreativeProperty(e,"apiFramework"),this.populateInteractiveCreativeProperty(e,"type"),B(e.variableDuration)?this.creativeData.properties.push(new st("variableDuration","false")):this.populateInteractiveCreativeProperty(e,"variableDuration")}populateNonLinearProperty(e,t){this.populateCreativeProperty(e,t)}populateNonLinearPropertyList(e){this.populateNonLinearProperty(e,"id"),this.populateNonLinearProperty(e,"width"),this.populateNonLinearProperty(e,"height"),this.populateNonLinearProperty(e,"expandedWidth"),this.populateNonLinearProperty(e,"expandedHeight"),this.populateNonLinearProperty(e,"scalable"),this.populateNonLinearProperty(e,"maintainAspectRatio"),this.populateNonLinearProperty(e,"apiFramework"),this.populateNonLinearProperty(e,"minSuggestedDuration")}}class Wt extends Qe{constructor(e){super(e),this.streamStart=we,this.manifestData=new Map,this.windowStart=we,this.windowEnd=we,this.windowSize=we,this.pausePoller=null,this.pauseUrl="",this.targetDuration=g.DEFAULT_POLLING_DELAY,this.setPlaybackPolicyHandler(new te(fe.DVRLIVE))}static create(e,t,r){let i=new Wt(t);if(!r)return i.initialiseFromSession(e);i.initialiseFromSession(e).then((()=>{C.d(E.DEBUG_LIFECYCLE,"Session initialised")})).catch((()=>{C.d(E.DEBUG_LIFECYCLE,"Session failed to initialise")})).finally((()=>{r(new Oe(i))}))}initialiseFromSession(e){return new Promise(((t,r)=>{if(C.trace("sdk init"),!Ce(e))return this.completeWithStatus(ve.FAILED,Te),void r(this);Re.get(e,{method:"GET"},this.sessionProperties.getRequestTimeout(),this.sessionProperties.getCustomHttpHeaders()).then((i=>{if(i.ok){let e=i.headers.get("content-type");if(e&&e.toLowerCase().includes("application/json"))this.handleFallbackUrl(i.body)?t(this):r(this);else{let e=i.url,n=this.parseManifestResponse(i.body,e);this.setPlaybackUrl(e),this.initialiseFromPayload(n),this.getSessionState()!==ve.INITIALISED&&this.getSessionState()!==ve.NO_ANALYTICS&&r(this),this.getSessionState()===ve.INITIALISED&&this.initialisePoller(),t(this)}}else i.timeout?(C.e("Primary Url request failed: "+e+", reason: timeout"),this.completeWithStatus(ve.FAILED,ye)):(C.e("Primary Url request failed: "+e+", status: "+i.status+", error: "+i.statusText),this.completeWithStatus(ve.FAILED,i.status)),r(this)}))}))}getDuration(){return this.windowEnd}getPauseUrl(){return this.pauseUrl}getStreamStart(){return this.streamStart}getManifestData(e){return e?this.manifestData.get(e):this.manifestData}getWindowStart(){return this.windowStart}getWindowEnd(){return this.windowEnd}getWindowSize(){return this.windowSize}removeExpiredAdBreaks(){let e=this.streamStart===we?this.getPlayhead():this.windowStart,t=this.getAdBreakForPlayhead(this.getPlayhead());for(let r=this.linearAdBreaks.length-1;r>=0;r--){let i=this.linearAdBreaks[r];if(i.getStart()+i.getDuration()<=e){if(C.d(E.DEBUG_LIFECYCLE,"Removing ad break.  Start: "+i.getStart()+"; duration: "+i.getDuration()),i===t){C.d(E.DEBUG_LIFECYCLE,"Removing the current adbreak");let e=t.getAdvertFromPlayhead(this.getPlayhead());e&&e.setInactive(),this.onAdvertEnd(),this.onAdvertBreakEnd()}this.linearAdBreaks.splice(r,1)}}}shutdown(){super.shutdown(),this.analyticPoller&&(this.analyticPoller.shutdown(),this.analyticPoller=null),this.pausePoller&&(this.pausePoller.shutdown(),this.pausePoller=null),C.d(E.DEBUG_LIFECYCLE,"resources released")}getPlaybackMode(){return fe.DVRLIVE}initialisePoller(){this.getAnalyticsUrl()&&this.pauseUrl&&this.getSessionState()===ve.INITIALISED&&(this.analyticPoller=new at(this.getAnalyticsUrl(),this.getSessionProperties().getRequestTimeout(),((e,t)=>{400===e.status?this.onSessionError(me.TIMEOUT):e.ok&&(this.targetDuration=t,this.parseAnalyticPayload(e.body))})),this.pausePoller=new at(this.pauseUrl,this.getSessionProperties().getRequestTimeout(),null))}hasAnalyticUpdateChanged(e){return!this.getLastAnalyticUpdate()||!this.getLastAnalyticUpdate().isEqualTo(e)||(C.d(E.DEBUG_PARSING,"Content unchanged.  Analytic update not delivered"),!1)}adjustForPdtInitial(e){if(this.streamStart===we){let t=e.getPdtInitial();null!==t&&(this.streamStart=t,this.manifestData.get("availabilityStartTime")||this.manifestData.set("availabilityStartTime",new Date(t)))}}handlePdtStartEnd(e){let t=!1,r=e.getPdtStart(),i=e.getPdtEnd();if(null!==r&&null!==i){let e=r,n=i;this.streamStart===we&&(this.streamStart=e);let a=e-this.streamStart,s=n-this.streamStart;a===this.windowStart&&s===this.windowEnd||(t=!0,this.windowStart=a,this.windowEnd=s,this.windowSize=this.windowEnd-this.windowStart)}else C.w("PDT start/end value(s) invalid or missing");return t}updateAdBreaks(e){let t=e.getLinearAdBreaks(),r=e.getNonLinearAdBreaks(),i=e.getDisplayAdBreaks(),n=t.length,a=r.length,s=i.length;Array.prototype.push.apply(this.linearAdBreaks,t),Array.prototype.push.apply(this.nonLinearAdBreaks,r),this.streamStart===we?C.d(E.DEBUG_PARSING,"Received "+n+" linear, "+a+" nonlinear "+s+" display ad breaks"):C.d(E.DEBUG_PARSING,"Received: "+n+" linear, "+a+" nonlinear  "+s+" display ad breaks. New window start: "+this.windowStart+", end: "+this.windowEnd+" (total: "+this.windowSize+")"),this.removeExpiredAdBreaks()}parseAnalyticPayload(e){return this.clearParsingErrors(),qt.parse(e,this).then((e=>{if(this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this),!e)return null;if(!this.hasAnalyticUpdateChanged(e))return e;let t=e.getEarlyReturn();t&&-1!==t&&this.adjustForEarlyReturn(t),this.adjustForPdtInitial(e);let r=this.handlePdtStartEnd(e);return this.updateAdBreaks(e),(this.streamStart!==we&&r||e.hasAdBreaks())&&(C.trace("sdk analytics "+e.getLinearAdBreaks().length+" "+e.getNonLinearAdBreaks().length+" "+e.getDisplayAdBreaks().length+" "+this.getDuration()),this.setLastAnalyticUpdate(e),this.getReportsManager().raiseAnalyticUpdateCallback(this)),e})).catch((e=>{C.d(E.DEBUG_POLLING,"Analytic Poll completed with unreadable data: "+e),this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this)}))}setAdBreaksInactivePriorTo(e){for(let t of this.linearAdBreaks)if(!t.setAdvertsInactivePriorTo(e))break}setStreamStart(e){this.streamStart=e}parseManifestResponse(e,t){let r=e;return nt.isHlsManifest(r)?(C.d(E.DEBUG_PARSING,"Processing HLS master manifest: "+t),nt.parse(r)):(C.d(E.DEBUG_PARSING,"Processing DASH manifest: "+t),et.parse(r))}initialiseFromPayload(e){e?B(e.getAnalyticUrl())?(C.w("Analytics URL not found in manifest payload"),this.completeWithStatus(ve.NO_ANALYTICS,0)):Ce(e.getAnalyticUrl())?Ce(e.getPlaybackUrl())?(this.setPlaybackUrl(e.getPlaybackUrl()),B(e.getPauseUrl())?(C.e("Pause URL not found in manifest"),this.completeWithStatus(ve.NO_ANALYTICS,ke)):Ce(e.getPauseUrl())?(this.setIdentifier(e.getSessionIdentifier()),this.setAnalyticsUrl(e.getAnalyticUrl()),this.pauseUrl=e.getPauseUrl(),this.manifestData.set("availabilityStartTime",e.getAvailabilityStartTime()),this.completeWithStatus(ve.INITIALISED,0),C.d(E.DEBUG_LIFECYCLE,"Successful. Url: "+this.getPlaybackUrl())):(C.w("Malformed pause URL in manifest"),this.completeWithStatus(ve.NO_ANALYTICS,ke))):(C.w("Player URL is invalid: "+e.getPlaybackUrl()),this.completeWithStatus(ve.NO_ANALYTICS,Te)):(C.w("Malformed analytics URL in manifest"),this.completeWithStatus(ve.NO_ANALYTICS,Te)):(C.e("Unable to process master manifest"),this.completeWithStatus(ve.NO_ANALYTICS,Ae))}onPlaybackStart(e){this.isNotPlaying()?this.getSessionState()!==ve.INITIALISED?C.w("Reporting START when session is not initialised"):this.analyticPoller&&(super.onPlaybackStart(e),this.analyticPoller.start()):C.w("Reporting START when start has already been reported")}onPlaybackReady(){super.onPlaybackReady(),this.getSessionState()===ve.INITIALISED&&!0!==this.playing&&this.analyticPoller&&this.analyticPoller.request()}onPlaybackPause(){this.isNotPlaying()||this.pausePoller&&this.getSessionState()===ve.INITIALISED&&this.pausePoller.start(),super.onPlaybackPause()}onPlaybackResume(){this.isNotPlaying()&&this.pausePoller&&this.pausePoller.stop(),super.onPlaybackResume()}onPlayerEvent(e,t){e!==Q.SEEK&&e!==Q.ADVERT_SKIP&&e!==Q.ADVERT_REWIND||(this.didSeek=!0),super.onPlayerEvent(e,t)}onPlayheadUpdate(e){this.handleHeartbeat(e),super.onPlayheadUpdate(e)}canPause(){return this.streamStart!==we&&super.canPause()}canSkip(){if(this.streamStart===we)return-1;if(this.policyHandler){let e=G(this.policyHandler,this.policyHandler.canSkip,this.getPlayhead(),this.linearAdBreaks,this.getDuration());return null===e&&(e=this.defaultPolicyHandler.canSkip(this.getPlayhead(),this.linearAdBreaks,this.getDuration())),e}return 0}willSeekTo(e){return this.streamStart===we?this.getPlayhead():super.willSeekTo(e)}}const Kt=Object.freeze({PLAYED_OUT:0,NOT_PLAYED_OUT:1,NEW_ADVERT_STARTING:2});class zt extends Ie{constructor(e,t){super(e),this.advertEndWatchdog=null,this.interSegmentTimeout=g.INTERSEGMENT_TIMEOUT,this.lastTimedMetadata=null,this.pendingTimedMetadata=null,this.historicalTimedMetadata=[],this.inAdBreak=!1,this.targetDuration=g.DEFAULT_POLLING_DELAY,this.setAnalyticsUrl(t),this.setPlaybackPolicyHandler(new te(fe.LIVE))}static create(e,t,r){let i=new zt(t,null);if(!r)return i.initialiseFromSession(e);i.initialiseFromSession(e).then((()=>{C.d(E.DEBUG_LIFECYCLE,"Session initialised")})).catch((()=>{C.d(E.DEBUG_LIFECYCLE,"Session failed to initialise")})).finally((()=>{r(new Oe(i))}))}cancelScheduleWatchdog(){null!==this.advertEndWatchdog&&(clearTimeout(this.advertEndWatchdog),this.advertEndWatchdog=null,C.d(E.DEBUG_LIFECYCLE,"Cancelled watchdog timer"))}getAdBreakForAdvert(e){if(e&&this.linearAdBreaks.length>0){let t=e.getMediaIdentifier();for(let e of this.linearAdBreaks)if(e.getAdvertFromIdentifier(t))return e}return null}getFirstAdvertRemovingAllPrevious(e){if(0===this.linearAdBreaks.length)return null;let t=null,r=-1;for(let i=0;i<this.linearAdBreaks.length;++i){let n=this.linearAdBreaks[i];for(let a of n.getAdverts()){if(a.getMediaIdentifier()===e&&a.isActive()){t=a,r=i;break}a.setInactive()}if(null!==t)break}return r>0&&this.linearAdBreaks.splice(0,r),t}getMetadataTimeout(e){return e&&e.getTypeWithinSegment()===X.END?this.interSegmentTimeout:Math.max(this.targetDuration+1e3>>1,g.MIN_INTRASEGMENT_TIMEOUT)}getPlaybackMode(){return fe.LIVE}handleMetaDataInSequence(e,t){let r=this.getCurrentAdvert();if(t.isFirstInSequence())this.onAdvertStart(e,t.getPlayhead());else if(t.isLastInSequence())!r||r.isFiller()&&!this.hasAdvertExpired(r,t)||this.onAdvertEnd(Kt.PLAYED_OUT);else if(r)if(t.isLastInSegment()&&(r.isFiller()||r.isTruncated())&&this.hasAdvertExpired(r,t))C.d(E.DEBUG_STATE_MACHINE,"Filler expired or truncated advert completed.  Ending advert and ad break"),this.onAdvertEnd(Kt.PLAYED_OUT);else{let e=Math.max(t.getPlayhead()-r.getStart(),0);this.signalTimelineTrackingEvents(e)}else this.onAdvertBreakStart(e)}handleMetaDataOutOfSequence(e,t){let r=this.getCurrentAdvert();r?r.getMediaIdentifier()!==e.getMediaIdentifier()&&(this.onAdvertEnd(Kt.NOT_PLAYED_OUT),t.isFirstInSequence()?this.onAdvertStart(e,t.getPlayhead()):(t.isLastInSequence()||(e.isFiller()||e.isTruncated())&&t.isLastInSegment()&&this.hasAdvertExpired(e,t))&&(e.setInactive(),this.getCurrentAdBreak().isActive()||this.onAdvertBreakEnd())):t.isFirstInSequence()?this.onAdvertStart(e,t.getPlayhead()):this.scheduleAdvertBreakEnd(this.interSegmentTimeout)}hasAdvertExpired(e,t){let r=this.interSegmentTimeout,i=t.getPlayhead()-e.getStart()+r;return C.d(E.DEBUG_STATE_MACHINE,"("+(e.isFiller()?"FILLER":"ADVERT")+" CHECK): Ad duration: "+e.getDuration()+", elapsed: "+(t.getPlayhead()-e.getStart()+this.interSegmentTimeout)),i>=e.getDuration()}initialiseFromSession(e){return new Promise(((t,r)=>(C.trace("sdk init"),Ce(e)?Re.get(e,{method:"GET"},this.sessionProperties.getRequestTimeout(),this.sessionProperties.getCustomHttpHeaders()).then((i=>{if(i.ok){let n=i.headers.get("content-type");if(n&&n.toLowerCase().includes("application/json"))this.handleFallbackUrl(i.body)?t(this):r(this);else{let r=i.url?i.url:e;this.parseManifestResponse(i.body,r),this.getSessionState()===ve.INITIALISED&&this.initialisePoller(),t(this)}}else i.timeout?(C.e("Primary Url request failed: "+e+", reason: timeout"),this.completeWithStatus(ve.FAILED,ye)):(C.e("Primary Url request failed: "+e+", status: "+i.status+", error: "+i.statusText),this.completeWithStatus(ve.FAILED,i.status)),r(this)})):(this.completeWithStatus(ve.FAILED,Te),void r(this)))))}initialisePoller(){this.getAnalyticsUrl()&&this.getSessionState()===ve.INITIALISED&&(this.analyticPoller=new at(this.getAnalyticsUrl(),this.getSessionProperties().getRequestTimeout(),((e,t)=>{400===e.status?this.onSessionError(me.TIMEOUT):e.ok&&(this.targetDuration=t,this.parseAnalyticPayload(e.body))})))}isMetadataInSequence(e,t){return this.pendingTimedMetadata?(C.d(E.DEBUG_STATE_MACHINE,"Pending metadata"),!1):t.isInSequence(e)}onAdvertBreakEnd(){if(!this.inAdBreak)return;let e=this.getCurrentAdBreak();if(e){let t=e.getTrackingReport("breakEnd",!0);this.getReportsManager().fireBeacon(t,new W(this.getPlayhead()))}this.inAdBreak=!1,C.trace("adbreakEnd"),this.getReportsManager().raiseAdBreakCallback("end",null,this),this.trackingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.TRACKING_ERROR,this),this.linearAdBreaks.length>0&&(this.linearAdBreaks.splice(0,1),C.d(E.DEBUG_LIFECYCLE,"Removed AdBreak.  Remaining: "+this.linearAdBreaks.length)),this.pendingTimedMetadata=null,this.historicalTimedMetadata=[],this.setCurrentAdvert(null),this.setCurrentAdBreak(null)}onAdvertBreakStart(e){let t=this.getAdBreakForAdvert(e);if(this.inAdBreak){if(null!=t){let e=t.getTrackingReport("breakStart",!this.reportsManager.reportsSuppressed());this.getReportsManager().fireBeacon(e,new W(this.getPlayhead()))}}else if(this.inAdBreak=!0,this.clearTrackingErrors(),this.setCurrentAdBreak(t),C.d(E.DEBUG_LIFECYCLE,"AdBreak count: "+this.linearAdBreaks.length),C.trace("adbreakStart"),this.getReportsManager().raiseAdBreakCallback("start",t,this),t){let e=t.getTrackingReport("breakStart",!this.reportsManager.reportsSuppressed());this.getReportsManager().fireBeacon(e,new W(this.getPlayhead()))}}onAdvertEnd(e){this.getCurrentAdvert()&&(e!==Kt.NEW_ADVERT_STARTING?this.cancelScheduleWatchdog():C.d(E.DEBUG_STATE_MACHINE,"onAdvertEnd(): new ad starting, not firing adbreak watchdog timer"),e===Kt.PLAYED_OUT?this.signalTimelineTrackingEvents(this.getCurrentAdvert().getDuration()):this.getCurrentAdvert().clearTrackingSchedule(),this.getCurrentAdvert().setInactive(),C.trace("advertEnd"),this.getReportsManager().raiseAdvertCallback("end",null,this),this.setCurrentAdvert(null),this.getCurrentAdBreak().isActive()?e!==Kt.NEW_ADVERT_STARTING&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout):this.onAdvertBreakEnd())}onAdvertStart(e,t){e.setStart(t),this.onAdvertEnd(Kt.NEW_ADVERT_STARTING),this.onAdvertBreakStart(e),this.setCurrentAdBreak(this.getAdBreakForAdvert(e)),this.getCurrentAdBreak()?(this.setCurrentAdvert(e),super.onAdvertStart(e),this.reportsManager.reportsSuppressed()&&this.getCurrentAdvert().clearTrackingSchedule(),C.trace("advertStart"),this.getReportsManager().raiseAdvertCallback("start",e,this),this.fireImpressionReport(),this.signalTimelineTrackingEvents(g.ADVERT_START_TIMESLOT)):C.e("*** AdBreak is null ***")}parseAnalyticPayload(e){return this.clearParsingErrors(),qt.parse(e,this).then((e=>{if(this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this),!e)return null;if(this.getLastAnalyticUpdate()&&e.isEqualTo(this.getLastAnalyticUpdate()))return C.d(E.DEBUG_PARSING,"Content unchanged.  Analytic update not delivered"),e;let t=e.getEarlyReturn();if(t&&-1!==t&&this.adjustForEarlyReturn(t),this.setLastAnalyticUpdate(e),!e.hasAdBreaks())return C.d(E.DEBUG_PARSING,"No ad breaks in payload"),this.playing||(C.trace("sdk analytics 0 0 0"),this.reportsManager.raiseAnalyticUpdateCallback(this)),e;C.trace("sdk analytics: "+e.getLinearAdBreaks().length+" "+e.getNonLinearAdBreaks().length+" "+e.getDisplayAdBreaks().length);let r=!1;for(let t of e.getLinearAdBreaks())if(0===t.getAdverts().length){let e=new W(this.getPlayhead());this.getReportsManager().fireBeacon(t.getTrackingReport("breakStart",!0),e),this.getReportsManager().fireBeacon(t.getTrackingReport("breakEnd",!0),e)}else this.linearAdBreaks.push(t),r=!0;for(let t of e.getNonLinearAdBreaks())this.nonLinearAdBreaks.push(t),r=!0;for(let t of e.getDisplayAdBreaks())this.displayAdBreaks.push(t),r=!0;if(r&&!this.pendingTimedMetadata&&this.getReportsManager().raiseAnalyticUpdateCallback(this),this.pendingTimedMetadata){C.d(E.DEBUG_STATE_MACHINE,"Process pending metadata: "+this.pendingTimedMetadata);let e=this.pendingTimedMetadata;this.pendingTimedMetadata=null,this.onTimedMetadata(e)}return this.processHistoricalData(),e})).catch((e=>{C.d(E.DEBUG_POLLING,"Analytic Poll completed with unreadable data: "+e),this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this)}))}onPlaybackContinue(){this.isPlaybackBuffering()&&(this.getCurrentAdvert()?this.scheduleAdvertEnd():this.getCurrentAdBreak()&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout)),super.onPlaybackContinue()}onPlaybackPause(){super.onPlaybackPause(),this.cancelScheduleWatchdog()}onPlaybackReady(){super.onPlaybackReady(),this.getSessionState()===ve.INITIALISED&&!0!==this.playing&&this.analyticPoller&&this.analyticPoller.request()}onPlaybackResume(){this.isNotPlaying()&&!this.isPlaybackBuffering()&&(this.getCurrentAdvert()?this.scheduleAdvertEnd(null):this.getCurrentAdBreak()&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout)),super.onPlaybackResume()}onPlaybackStall(){super.onPlaybackStall(),this.cancelScheduleWatchdog()}onPlaybackStart(e){this.isNotPlaying()?this.getSessionState()!==ve.INITIALISED?C.w("Reporting START when session has not been initialised"):(super.onPlaybackStart(e),this.analyticPoller.start()):C.w("Reporting START when start has already been reported")}onTimedMetadata(e){if(C.trace("timedmetadata "+e.getTypeWithinSegment().key+e.getSegmentNumber()+":"+e.getSegmentCount()+" "+e.getPlayhead()),C.d(E.DEBUG_STATE_MACHINE,"Received metadata: "+e+", timestamp: "+e.getTimestamp()),this.isPlaybackBuffering())return void C.w("Playback buffering - should not be receiving timed metadata");if(this.isNotPlaying())return void C.w("Playback not playing - should not be receiving timed metadata");if(this.scheduleAdvertEnd(e),e.isDuplicate(this.lastTimedMetadata)||e.isDuplicate(this.pendingTimedMetadata))return void C.d(E.DEBUG_STATE_MACHINE,"Duplicate metadata: "+e);let t=e.getMediaId(),r=this.getFirstAdvertRemovingAllPrevious(t);return r?this.isMetadataInSequence(this.lastTimedMetadata,e)?(this.lastTimedMetadata=e,void this.handleMetaDataInSequence(r,e)):(C.d(E.DEBUG_STATE_MACHINE,"Metadata out of sequence"),this.pendingTimedMetadata=null,this.lastTimedMetadata=e,void this.handleMetaDataOutOfSequence(r,e)):(e.isFirstInSequence()?(C.d(E.DEBUG_STATE_MACHINE,"FIRST pending metadata for advert "+t),this.pendingTimedMetadata=e,this.lastTimedMetadata=null,this.analyticPoller&&this.analyticPoller.request()):e.isLastInSequence()&&this.getSessionProperties().getFireHistoricalBeacons()&&this.pendingTimedMetadata&&(C.d(E.DEBUG_STATE_MACHINE,"LAST pending metadata for advert: "+t+" .  Moving to historical list"),this.historicalTimedMetadata.push(this.pendingTimedMetadata),this.pendingTimedMetadata=null),void this.onAdvertBreakStart(null))}parseManifestResponse(e,t){let r=e,i=null;nt.isHlsManifest(r)?(C.d(E.DEBUG_PARSING,"Processing HLS master playlist: "+t),i=nt.parse(r)):(C.d(E.DEBUG_PARSING,"Processing DASH manifest: "+t),i=et.parse(r)),i?B(i.getAnalyticUrl())?(this.setPlaybackUrl(t),C.w("Analytics URL not found in manifest payload"),this.completeWithStatus(ve.NO_ANALYTICS,0)):Ce(i.getAnalyticUrl())?B(i.getPlaybackUrl())?(this.setPlaybackUrl(t),C.w("Playback URL not found in manifest payload"),this.completeWithStatus(ve.NO_ANALYTICS,Te)):(this.setPlaylistProperties(i),this.interSegmentTimeout=i.getIntersegmentTimeout(),this.completeWithStatus(ve.INITIALISED,0),C.d(E.DEBUG_LIFECYCLE,"Successful.  URL: "+this.getPlaybackUrl())):(this.setPlaybackUrl(t),C.w("Malformed analytics URL in manifest payload"),this.completeWithStatus(ve.NO_ANALYTICS,Te)):(this.setPlaybackUrl(t),C.w("Playlist/manifest processing unsuccessful"),this.completeWithStatus(ve.NO_ANALYTICS,Ae))}processHistoricalData(){let e=this.getCurrentAdBreak();if(e)for(let t of this.historicalTimedMetadata){let r=t.getMediaId(),i=e.getAdvertFromIdentifier(r);if(i){C.d(E.DEBUG_REPORTS,"Firing beacon for historical advert: "+r);let e=new W(this.getPlayhead(),i.getStart(),i.getLinearCreative().getAssetUri(),i.getMacroSubstitutions()),t=[];for(let[r,n]of i.getTrackingSchedule()){t.push(r);let a=i.getTrackingReportLinear(n);a&&(C.d(E.DEBUG_REPORTS,"Firing beacon(s) for event: "+r),this.getReportsManager().fireBeacon(a,e))}this.removeKeysFromTrackingSchedule(t)}}this.historicalTimedMetadata=[]}scheduleAdvertBreakEnd(e){this.cancelScheduleWatchdog(),this.advertEndWatchdog=setTimeout(this.metadataWatchdogEndBreak.bind(this),e),C.d(E.DEBUG_STATE_MACHINE,"Scheduled adbreak end watchdog timer: "+e+"ms")}scheduleAdvertEnd(e){this.cancelScheduleWatchdog();let t=this.getMetadataTimeout(e);this.advertEndWatchdog=setTimeout(this.metadataWatchdog.bind(this),t),C.d(E.DEBUG_STATE_MACHINE,"Scheduled advert end watchdog timer: "+t+"ms")}setTargetDuration(e){this.targetDuration=e}shutdown(){super.shutdown(),this.cancelScheduleWatchdog(),this.analyticPoller&&(this.analyticPoller.shutdown(),this.analyticPoller=null,C.d(E.DEBUG_LIFECYCLE,"Analytic poller cancelled"))}setPlaylistProperties(e){this.setIdentifier(e.getSessionIdentifier()),this.setAnalyticsUrl(e.getAnalyticUrl()),this.setPlaybackUrl(e.getPlaybackUrl())}metadataWatchdog(){C.w("Watchdog timer expired before metadata was received"),this.pendingTimedMetadata?this.onAdvertBreakEnd():this.onAdvertEnd(Kt.NOT_PLAYED_OUT)}metadataWatchdogEndBreak(){C.w("Watchdog timer expired before metadata was received"),this.onAdvertBreakEnd()}}const Xt=/(.+?:\/\/)/;class Qt extends Qe{static create(e,t,r){let i=new Qt(t);return r?i.initialiseSession(e).then((()=>{C.d(E.DEBUG_LIFECYCLE,"Session initialised")})).catch((()=>{C.d(E.DEBUG_LIFECYCLE,"Session failed to initialise")})).finally((()=>{r(new Oe(i))})):i.initialiseSession(e)}constructor(e){super(e),this.setPlaybackPolicyHandler(new te(fe.VOD))}getContentPositionForPlayhead(e){if(0===this.duration||0===e)return 0;if(0===this.linearAdBreaks.length)return e;for(let t of this.linearAdBreaks)if(t.getStart()<=e&&e<t.getStart()+t.getDuration()){e=t.getStart()+t.getDuration();break}let t=0,r=e;for(;t<this.linearAdBreaks.length&&this.linearAdBreaks[t].getStart()<e;)r-=this.linearAdBreaks[t++].getDuration();return r}getPlaybackMode(){return fe.VOD}getPlayheadForContentPosition(e){if(0===this.linearAdBreaks.length)return e;let t=0;for(;t<this.linearAdBreaks.length&&this.linearAdBreaks[t].getStart()<=e;)e+=this.linearAdBreaks[t++].getDuration();return e}initialiseSession(e){return new Promise(((t,r)=>(C.trace("sdk init"),Ce(e)?Re.get(e,{method:"GET"},this.sessionProperties.getRequestTimeout(),this.sessionProperties.getCustomHttpHeaders()).then((i=>{if(i.ok){let n=i.headers.get("content-type");if(!n||!n.toLowerCase().includes("application/json"))return qt.parse(i.body,this).then((r=>{!r||0===r.getStreamDuration()||B(r.getHostNode()||B(r.getHostSuffix()))?(this.setPlaybackUrl(e),this.logVmapParseWarning(r),r?(this.completeWithStatus(ve.NO_ANALYTICS,0),t(this)):(this.completeWithStatus(ve.NO_ANALYTICS,Ae),t(this))):r.getHasPlaceholder()?(this.handlePlaceholderBreaks(r,e),this.completeWithStatus(ve.INITIALISED,Se),t(this)):(this.initialiseFromAnalyticData(r,this.findScheme(e)),C.d(E.DEBUG_PARSING,r.toString()),this.completeWithStatus(ve.INITIALISED,0),t(this))}));this.handleFallbackUrl(i.body)?t(this):r(this)}else C.e("VMAP request failed.  URL: "+e+", status: "+i.status+", error: "+i.statusText),this.completeWithStatus(ve.FAILED,i.status),r(this)})):(this.completeWithStatus(ve.FAILED,Te),void r(this)))))}logVmapParseWarning(e){let t=`Unable to parse VMAP data.\n - Stream duration: ${e?e.getStreamDuration():"null"}\n - Host node: ${e?e.getHostNode():"null"}\n - Host suffix: ${e?e.getHostSuffix():null}`;C.d(E.DEBUG_LIFECYCLE,t)}findScheme(e){return Xt.exec(e)?Xt.exec(e)[1]:(C.w("Unable to match scheme in primary URL.  Assuming http://"),"http://")}handlePlaceholderBreaks(e,t){C.d(E.DEBUG_LIFECYCLE,"Found partial VMAP"),this.initialiseFromAnalyticData(e,this.findScheme(t),!0);let r=e.getLinearAdBreaks();if(!r.length)return C.e("Fulfilment payload contains no breaks"),void this.onSessionError(me.UNRESOLVED_BREAK);let i=r[r.length-1].getAdTagUri();return Ce(i)?Re.get(i,{method:"GET"},this.sessionProperties.getRequestTimeout(),this.sessionProperties.getCustomHttpHeaders()).then((e=>{if(e.ok)return qt.parse(e.body,this,{skipNormalisation:!0}).then((e=>{this.parsingErrors.length>0&&this.getReportsManager().raiseSessionErrorCallback(me.PARSING_ERROR,this),e?(this.mergePlaceholderBreaks(e)?this.reportsManager&&this.reportsManager.raiseAnalyticUpdateCallback(this):(C.e("Fulfilment payload could not be merged"),this.onSessionError(me.UNRESOLVED_BREAK)),C.d(E.DEBUG_PARSING,e.toString())):(C.e("Fulfilment payload could not be parsed"),this.onSessionError(me.UNRESOLVED_BREAK))}));C.e("Fulfilment payload request failed: "+e.statusText),this.onSessionError(me.UNRESOLVED_BREAK)})):(C.e("Fulfilment payload followup URL is not valid: "+i),void this.onSessionError(me.UNRESOLVED_BREAK))}onPlayerEvent(e,t){e!==Q.SEEK&&e!==Q.ADVERT_SKIP&&e!==Q.ADVERT_REWIND||(this.didSeek=!0),super.onPlayerEvent(e,t)}onPlayheadUpdate(e){this.handleHeartbeat(e),super.onPlayheadUpdate(e)}setAdBreaksInactivePriorTo(e){super.setAdBreaksInactivePriorTo(e)}setDuration(e){this.duration=e}}})(),YospaceAdManagement=i})();